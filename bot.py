import logging
import random
import json
import os
import asyncio
from datetime import datetime, time, date, timedelta
from filelock import FileLock
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
import pytz

logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler("bot.log", encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    raise ValueError("BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")

DATA_FILE = "user_data.json"
LOCK_FILE = DATA_FILE + ".lock"
MOSCOW_TZ = pytz.timezone('Europe/Moscow')

MORNING_MESSAGES = [
    "–ü—Ä–∏–≤–µ—Ç. –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥–µ–º, —Ö–æ—Ä–æ—à–æ?",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ. –ù–µ —Å–µ–≥–æ–¥–Ω—è.",
    "–ü—Ä–∏–≤–µ—Ç. –î–µ—Ä–∂–∏–º—Å—è —Å–µ–≥–æ–¥–Ω—è?",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ. –°–µ–≥–æ–¥–Ω—è –º–Ω–æ–≥–æ –¥–µ–ª, –Ω–∞–≤–µ—Ä–Ω–æ–µ –Ω–µ—Ç.",
    "–ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –æ–±–æ–π–¥—ë–º—Å—è –±–µ–∑ —ç—Ç–æ–≥–æ.",
    "–£—Ç—Ä–æ. –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏–º.",
    "–ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –ø–æ–∂–∞–ª—É–π —á—Ç–æ –Ω–µ —Å—Ç–æ–∏—Ç.",
    "–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ. –ù–∞–ø–∏—à—É –µ—â—ë —Å–µ–≥–æ–¥–Ω—è.",
    "–ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è —Ç–æ—á–Ω–æ –Ω–µ –Ω–∞–¥–æ.",
    "–î–æ–±—Ä–æ–µ! –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –±–µ–∑ —ç—Ç–æ–≥–æ."
]

EVENING_MESSAGES = [
    "–ù–µ —Å–µ–≥–æ–¥–Ω—è. –î–µ—Ä–∂–∏—Å—å.",
    "–Ø —Ç—É—Ç. –î–∞–≤–∞–π –Ω–µ —Å–µ–≥–æ–¥–Ω—è.",
    "–ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –¥–µ—Ä–∂–∏–º—Å—è, –ø–æ–º–Ω–∏—à—å?",
    "–î–µ—Ä–∂–∏—Å—å. –°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç.",
    "–ï—â—ë —á—É—Ç—å-—á—É—Ç—å. –ù–µ —Å–µ–≥–æ–¥–Ω—è.",
    "–Ø —Å —Ç–æ–±–æ–π. –°–µ–≥–æ–¥–Ω—è —Ç–æ—á–Ω–æ –Ω–µ—Ç.",
    "–ü—Ä–∏–≤–µ—Ç. –î–∞–≤–∞–π –æ–±–æ–π–¥—ë–º—Å—è.",
    "–ú—ã –∂–µ —Ä–µ—à–∏–ª–∏ ‚Äî –Ω–µ —Å–µ–≥–æ–¥–Ω—è.",
    "–î–µ—Ä–∂–∏—Å—å —Ç–∞–º. –°–µ–≥–æ–¥–Ω—è –º–∏–º–æ.",
    "–ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏–º."
]

NIGHT_MESSAGES = [
    "–¢—ã –º–æ–ª–æ–¥–µ—Ü. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "–ö—Ä–∞—Å–∞–≤—á–∏–∫. –°–ø–æ–∫–æ–π–Ω–æ–π.",
    "–î–µ—Ä–∂–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è. –£–≤–∞–∂–∞—é.",
    "–°–µ–≥–æ–¥–Ω—è —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "–ú–æ–ª–æ–¥–µ—Ü, –¥–µ—Ä–∂–∏—à—å—Å—è.",
    "–ï—â—ë –æ–¥–∏–Ω –¥–µ–Ω—å –ø–æ–∑–∞–¥–∏.",
    "–¢—ã —Å–∏–ª—å–Ω—ã–π. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "–°–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å. –û—Ç–¥—ã—Ö–∞–π.",
    "–°–ø—Ä–∞–≤–∏–ª—Å—è. –£–≤–∞–∂–µ–Ω–∏–µ.",
    "–î–µ—Ä–∂–∞–ª—Å—è –≤–µ—Å—å –¥–µ–Ω—å. –ö—Ä–∞—Å–∞–≤–∞."
]

TU_TUT_FIRST = [
    "–¢—É—Ç.", "–ü—Ä–∏–≤–µ—Ç.", "–ê –∫—É–¥–∞ —è –¥–µ–Ω—É—Å—å?", "–ó–¥–µ—Å—å.", "–¢—É—Ç, –∫–∞–∫ –≤—Å–µ–≥–¥–∞.",
    "–î–∞, –¥–∞.", "–ö–∞–∫ –¥–µ–ª–∞?", "–ê–≥–∞.", "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π.", "–¢—É—Ç, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π."
]

TU_TUT_SECOND = [
    "–î–µ—Ä–∂–∏–º—Å—è.", "–Ø —Å —Ç–æ–±–æ–π.", "–í—Å—ë –ø–æ –ø–ª–∞–Ω—É.", "–ù–µ —Ö–æ—á—É —Å–µ–≥–æ–¥–Ω—è.", "–°–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥—É.",
    "–Ø —Ä—è–¥–æ–º.", "–î–µ—Ä–∂–∏—Å—å.", "–í—Å—ë –±—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ.", "–Ø –≤ –¥–µ–ª–µ.", "–ü–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º."
]

HOLD_RESPONSES = ["–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. ‚úä", "–ú–æ–ª–æ–¥–µ—Ü. ‚úä", "–ü–æ–Ω—è–ª. ‚úä", "–¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å. ‚úä"]

MILESTONES = {
    3: "‚ú® –¢—Ä–∏ –¥–Ω—è —É–∂–µ. –°–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ –ø–æ–∑–∞–¥–∏.",
    7: "‚ú® –ù–µ–¥–µ–ª—è. –†–µ—Ü–µ–ø—Ç–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.",
    14: "‚ú® –î–≤–µ –Ω–µ–¥–µ–ª–∏! –°–æ–Ω –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è, –≥–æ–ª–æ–≤–∞ —è—Å–Ω–µ–µ.",
    21: "‚ú® –¢—Ä–∏ –Ω–µ–¥–µ–ª–∏. –¢—ã —É–∂–µ –ø–æ—á—Ç–∏ –Ω–µ –¥—É–º–∞–µ—à—å –æ–± —ç—Ç–æ–º.",
    30: "‚ú® –ú–µ—Å—è—Ü –±–µ–∑ —ç—Ç–æ–≥–æ. –ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–Ω–æ–≤–æ–º—É.",
    60: "‚ú® –î–≤–∞ –º–µ—Å—è—Ü–∞ ‚Äî —Ç—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫.",
    90: "‚ú® –¢—Ä–∏ –º–µ—Å—è—Ü–∞. –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ. –¢—ã –º–æ–ª–æ–¥–µ—Ü.",
    180: "‚ú® –ü–æ–ª–≥–æ–¥–∞. –õ–µ–≥–µ–Ω–¥–∞.",
    365: "‚ú® –ì–û–î –ß–ò–°–¢–´–ú. –¢—ã —Å–¥–µ–ª–∞–ª —ç—Ç–æ ‚ù§Ô∏è"
}

HELP_TECHNIQUES = [
    """üßä **–õ—ë–¥ –Ω–∞ –∑–∞–ø—è—Å—Ç—å—è**
30-60 —Å–µ–∫—É–Ω–¥ –ª—å–¥–∞ –Ω–∞ –∑–∞–ø—è—Å—Ç—å—è –∏–ª–∏ —à–µ—é. 
–•–æ–ª–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –±–ª—É–∂–¥–∞—é—â–∏–π –Ω–µ—Ä–≤ ‚Äî —ç—Ç–æ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É –∏ —Ç—è–≥—É. 
–ú–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ 60-90 —Å–µ–∫—É–Ω–¥.""",

    """ü´Å **–î—ã—Ö–∞–Ω–∏–µ 4-7-8**
–í–¥–æ—Ö –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 7 ‚Üí –≤—ã–¥–æ—Ö –Ω–∞ 8.
–ü–æ–≤—Ç–æ—Ä–∏ 4 —Ä–∞–∑–∞. –≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —Å–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª –Ω–∞ 20-30% –∏ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.""",

    """‚è± **–í–æ–ª–Ω–æ–≤–∞—è —Ç–µ–æ—Ä–∏—è**
–¢—è–≥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–æ–ª–Ω–∞–º–∏ ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è, –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –ø–∏–∫–∞ –∏ —Å–ø–∞–¥–∞–µ—Ç.
–ü–æ—Å—Ç–∞–≤—å —Ç–∞–π–º–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç –∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–ª—é–¥–∞–π. 90% –≤–æ–ª–Ω –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∞–º–∏ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è.""",

    """üö™ **–°–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
–í—Å—Ç–∞–Ω—å –∏ –≤—ã–π–¥–∏ –≤ –¥—Ä—É–≥—É—é –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –Ω–∞ —É–ª–∏—Ü—É.
–ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ ¬´–º–µ—Å—Ç–æ ‚Üí –∂–µ–ª–∞–Ω–∏–µ¬ª —Ä–∞–∑—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∏.""",

    """üçã **–í–∫—É—Å–æ–≤–æ–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å**
–ö—É—Å–æ–∫ –ª–∏–º–æ–Ω–∞, –∏–º–±–∏—Ä—è –∏–ª–∏ –æ—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä—Ü–∞.
–†–µ–∑–∫–∏–π –≤–∫—É—Å ¬´–ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç¬ª –¥–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –≤ –º–æ–∑–≥–µ, –¥–∞–≤–∞—è –ø–µ—Ä–µ–¥—ã—à–∫—É.""",

    """‚úä **–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–±—Ä–æ—Å**
–°–æ–∂–º–∏ –∫—É–ª–∞–∫–∏ –∏–∑–æ –≤—Å–µ—Ö —Å–∏–ª –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ ‚Üí –æ—Ç–ø—É—Å—Ç–∏. 5 —Ä–∞–∑.
–ú—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –ø–æ–≥–ª–æ—â–∞–µ—Ç –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ, –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω —É—Ö–æ–¥–∏—Ç –≤ –º—ã—à—Ü—ã.""",

    """üíß **–†–µ—Ñ–ª–µ–∫—Å –Ω—ã—Ä—è–ª—å—â–∏–∫–∞**
–£–º–æ–π –ª–∏—Ü–æ –ª–µ–¥—è–Ω–æ–π –≤–æ–¥–æ–π –∏–ª–∏ –æ–ø—É—Å—Ç–∏ –ª–∏—Ü–æ –≤ —Ç–∞–∑ —Å —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–¥–æ–π –Ω–∞ 30 —Å–µ–∫—É–Ω–¥.
–ó–∞–º–µ–¥–ª—è–µ—Ç –ø—É–ª—å—Å –Ω–∞ 10-20%, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ.""",

    """üìù **–õ–æ–≥–∏—á–µ—Å–∫–∏–π –±–∞—Ä—å–µ—Ä**
–ù–∞–ø–∏—à–∏ –Ω–∞ –±—É–º–∞–≥–µ 3 –ø—Ä–∏—á–∏–Ω—ã, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å –Ω–µ —Å—Ç–æ–∏—Ç.
–í–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–æ—Ä—É ‚Äî —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å –º–æ–∑–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è.""",

    """üåø **–ö–∏—Å–ª–æ—Ä–æ–¥–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å**
10 –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≥–ª—É–±–æ–∫–∏—Ö –≤–¥–æ—Ö–æ–≤ –∂–∏–≤–æ—Ç–æ–º.
–ö–∏—Å–ª–æ—Ä–æ–¥ —Å–Ω–∏–∂–∞–µ—Ç –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á—É–≤—Å—Ç–≤–æ –∫–æ–Ω—Ç—Ä–æ–ª—è.""",

    """üí™ **–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤**
–ü–ª–∞–Ω–∫–∞ 45-60 —Å–µ–∫—É–Ω–¥ –¥–æ –¥—Ä–æ–∂–∏ –≤ –º—ã—à—Ü–∞—Ö.
–ü–æ–∫–∞ —Ç–µ–ª–æ –±–æ—Ä–µ—Ç—Å—è ‚Äî –º–æ–∑–≥ –∑–∞–±—ã–≤–∞–µ—Ç –ø—Ä–æ —Ç—è–≥—É. –≠–Ω–¥–æ—Ä—Ñ–∏–Ω—ã –ø–æ—Å–ª–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∑–∞–º–µ–Ω—è—Ç –¥–æ—Ñ–∞–º–∏–Ω.""",

    """üö∂ **–î–≤–∏–∂–µ–Ω–∏–µ –∫–∞–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ**
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ 7-10 –º–∏–Ω—É—Ç –Ω–∞ —É–ª–∏—Ü–µ.
–í—ã—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç BDNF ‚Äî –ø—Ä–∏—Ä–æ–¥–Ω—ã–π –∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω—ã.""",

    """üëÄ **–ú–µ—Ç–æ–¥ 5-4-3-2-1**
–ù–∞–∑–æ–≤–∏: 5 –≤–µ—â–µ–π –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∏—à—å ‚Üí 4 –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–æ–≥–∞–µ—à—å ‚Üí 3 –∫–æ—Ç–æ—Ä—ã–µ —Å–ª—ã—à–∏—à—å ‚Üí 2 –∑–∞–ø–∞—Ö–∞ ‚Üí 1 –≤–∫—É—Å.
–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å, –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–ø–∏–ª–æ—Ç.""",

    """üöø **–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π —Å–±—Ä–æ—Å**
30 —Å–µ–∫ —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–¥—ã ‚Üí 1 –º–∏–Ω —Ç—ë–ø–ª–æ–π. –ü–æ–≤—Ç–æ—Ä–∏ 2 —Ä–∞–∑–∞.
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ–≥–µ—Ç–∞—Ç–∏–≤–Ω—É—é –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É, —Å–Ω–∏–º–∞–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.""",

    """ü•ú **–ë–∏–æ—Ö–∏–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è**
–ì–æ—Ä—Å—Ç—å –æ—Ä–µ—Ö–æ–≤, –∫—É—Å–æ–∫ —Å—ã—Ä–∞ –∏–ª–∏ —è–π—Ü–æ.
–ë–µ–ª–æ–∫ –∏ –∂–∏—Ä—ã —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—Ç —Å–∞—Ö–∞—Ä –≤ –∫—Ä–æ–≤–∏ ‚Äî —á–∞—Å—Ç—É—é —Å–∫—Ä—ã—Ç—É—é –ø—Ä–∏—á–∏–Ω—É —Ç—è–≥–∏.""",

    """üéæ **–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π —à–æ–∫**
–°–æ–∂–º–∏ —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π –º—è—á–∏–∫ –∏–ª–∏ —ç—Å–ø–∞–Ω–¥–µ—Ä –¥–æ –±–æ–ª–∏ 10 —Ä–∞–∑.
–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–±—Ä–æ—Å –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞ —á–µ—Ä–µ–∑ —Ä—É–∫–∏, –æ—Ç–≤–ª–µ–∫–∞–µ—Ç –º–æ–∑–≥.""",

    """ü¶∏ **–ü–æ–∑–∞ —Å–∏–ª—ã**
2 –º–∏–Ω—É—Ç—ã: –Ω–æ–≥–∏ —à–∏—Ä–æ–∫–æ, —Ä—É–∫–∏ –≤ –±–æ–∫–∏, –≥—Ä—É–¥—å –≤–ø–µ—Ä—ë–¥, –ø–æ–¥–±–æ—Ä–æ–¥–æ–∫ –≤–≤–µ—Ä—Ö.
–ü–æ–≤—ã—à–∞–µ—Ç —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω, —Å–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª, –º–µ–Ω—è–µ—Ç –±–∏–æ—Ö–∏–º–∏—é –≤ –ø–æ–ª—å–∑—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.""",

    """ü§î **–ú–µ—Ç–æ–¥ HALT**
–°–ø—Ä–æ—Å–∏ —Å–µ–±—è: –ì–æ–ª–æ–¥–µ–Ω? –ó–ª–æ–π? –û–¥–∏–Ω–æ–∫? –£—Å—Ç–∞–ª?
–ò—Å–ø—Ä–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—É–Ω–∫—Ç ‚Äî —Ç—è–≥–∞ –æ—Å–ª–∞–±–Ω–µ—Ç –Ω–∞ 50-70%.""",

    """üåä **–°–µ—Ä—Ñ–∏–Ω–≥ –ø–æ —Ç—è–≥–µ**
–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ç—è–≥—É –∫–∞–∫ –æ–∫–µ–∞–Ω—Å–∫—É—é –≤–æ–ª–Ω—É. –ù–µ –±–æ—Ä–∏—Å—å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–ª—é–¥–∞–π —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –∫–∞–∫ –æ–Ω–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å–ø–∞–¥–∞–µ—Ç.
–ú–µ—Ç–æ–¥ –ø—Ä–∏–Ω—è—Ç–∏—è –≤–º–µ—Å—Ç–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è.""",

    """üí¨ **–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —â–∏—Ç**
–ù–∞–ø–∏—à–∏ –ª—é–±–æ–º—É: ¬´–¢—è–∂–∫–æ, –±—Ä–∞—Ç. –î–µ—Ä–∂—É—Å—å¬ª.
–°—Ç—ã–¥–Ω–æ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å—Å—è? –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–º–æ–≥–∞–µ—Ç.""",

    """üî• **–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω–æ–≤—ã–π —Å–±—Ä–æ—Å**
20 –æ—Ç–∂–∏–º–∞–Ω–∏–π, –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π –∏–ª–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π –¥–æ –æ—Ç–∫–∞–∑–∞.
–ü–æ–∫–∞ —Ç–µ–ª–æ –≤ —Å—Ç—Ä–µ—Å—Å–µ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ ‚Äî –º–æ–∑–≥ –∑–∞–±—ã–≤–∞–µ—Ç –ø—Ä–æ –¥–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π –≥–æ–ª–æ–¥.""",

    """üéµ **–ê—É–¥–∏–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞**
3 –º–∏–Ω—É—Ç—ã –ª—é–±–∏–º–æ–π –º—É–∑—ã–∫–∏ –Ω–∞ –ø–æ–ª–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –≤ –Ω–∞—É—à–Ω–∏–∫–∞—Ö.
–ó–≤—É–∫ –Ω–∞–ø—Ä—è–º—É—é –≤–æ–∑–¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã –º–æ–∑–≥–∞, –º–µ–Ω—è—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ.""",

    """üßò **–ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è**
–°—è–¥—å, –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞, –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–ª—é–¥–∞–π –∑–∞ –º—ã—Å–ª—è–º–∏ –∫–∞–∫ –∑–∞ –æ–±–ª–∞–∫–∞–º–∏.
–ù–µ –≤–æ–≤–ª–µ–∫–∞–π—Å—è, –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–π. –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç —Ç—è–≥–∞ —É–π–¥—ë—Ç —Å–∞–º–∞.""",

    """üìñ **–ö–Ω–∏–∂–Ω—ã–π —à–æ–∫**
–ü—Ä–æ—á–∏—Ç–∞–π 2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–ª–æ–∂–Ω–æ–π –∫–Ω–∏–≥–∏ –∏–ª–∏ —Å—Ç–∞—Ç—å–∏.
–ù–∞–≥—Ä—É–∑–∏ –ø—Ä–µ—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–æ—Ä—É ‚Äî –æ–Ω–∞ –∑–∞–±—É–¥–µ—Ç –ø—Ä–æ –∂–µ–ª–∞–Ω–∏–µ, –∑–∞–Ω—è—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."""
]

RECOVERY_STAGES = [
    """üìÖ –î–ù–ò 1-3: –û–°–¢–†–ê–Ø –§–ê–ó–ê

–ü–∏–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤. –†–µ—Ü–µ–ø—Ç–æ—Ä—ã —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∏–≤—ã—á–Ω—ã–π –¥–æ—Ñ–∞–º–∏–Ω.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –ø–æ—Ç–ª–∏–≤–æ—Å—Ç—å
‚Ä¢ –¢—Ä–µ–≤–æ–≥–∞ 8-10/10
‚Ä¢ –†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ –ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞
‚Ä¢ –°–∏–ª—å–Ω–∞—è —Ç—è–≥–∞ –∫–∞–∂–¥—ã–µ 1-2 —á–∞—Å–∞

–≠—Ç–æ —Å–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ –≤—Ä–µ–º—è. –î–µ—Ä–∂–∏—Å—å.""",
    
    """üìÖ –î–ù–ò 4-7: –ü–û–î–û–°–¢–†–ê–Ø –§–ê–ó–ê

–°–∏–º–ø—Ç–æ–º—ã —Å–Ω–∏–∂–∞—é—Ç—Å—è –Ω–∞ 40%. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∫–∞—á–µ—Ç ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã —Å–ª–∞–±–µ—é—Ç
‚Ä¢ –ü–æ—è–≤–ª—è—é—Ç—Å—è –æ–∫–Ω–∞ —è—Å–Ω–æ—Å—Ç–∏
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è –≤—Å—ë –µ—â—ë –Ω–∏–∑–∫–∞—è
‚Ä¢ –¢—è–≥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ä–µ–∂–µ
‚Ä¢ –≠–º–æ—Ü–∏–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã

–ú–æ–∑–≥ —É—á–∏—Ç—Å—è –∂–∏—Ç—å –ø–æ-–Ω–æ–≤–æ–º—É.""",
    
    """üìÖ –î–ù–ò 8-14: –ê–î–ê–ü–¢–ê–¶–ò–Ø

–†–µ—Ü–µ–ø—Ç–æ—Ä—ã –æ–∂–∏–≤–∞—é—Ç. CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ –°–æ–Ω –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è
‚Ä¢ –ê–ø–ø–µ—Ç–∏—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ –¢—è–≥–∞ —Å–ª–∞–±–µ–µ—Ç
‚Ä¢ –ü–æ—è–≤–ª—è–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–¥–æ—Å—Ç—å
‚Ä¢ –ì–æ–ª–æ–≤–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Å–Ω–µ–µ

–¢—ã —É–∂–µ —á—É–≤—Å—Ç–≤—É–µ—à—å —Ä–∞–∑–Ω–∏—Ü—É.""",
    
    """üìÖ –î–ù–ò 15-28: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï

–ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∏—â–µ. –î–æ—Ñ–∞–º–∏–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –Ω–æ—Ä–º—É.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è
‚Ä¢ –≠–º–æ—Ü–∏–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
‚Ä¢ –†–∞–¥–æ—Å—Ç—å –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –≤–µ—â–µ–π
‚Ä¢ –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ +25%
‚Ä¢ –¢—è–≥–∞ —Ä–µ–¥–∫–∞—è –∏ —Å–ª–∞–±–∞—è

–¢—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫.""",
    
    """üìÖ –î–ù–ò 29-90: –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø

–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π. –ù–æ–≤–∞—è –Ω–æ—Ä–º–∞ –∂–∏–∑–Ω–∏.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
‚Ä¢ –î–æ—Ñ–∞–º–∏–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
‚Ä¢ –ñ–∏–∑–Ω—å –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚Ä¢ –¢—è–≥–∞ –ø–æ—á—Ç–∏ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
‚Ä¢ –¢—ã —Å–≤–æ–±–æ–¥–µ–Ω

–≠—Ç–æ —Ç–≤–æ—è –Ω–æ–≤–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å."""
]

COGNITIVE_DISTORTIONS = [
    """ü§Ø ¬´–Ø –í–°–Å –ò–°–ü–û–†–¢–ò–õ¬ª

–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è.

–§–∞–∫—Ç: –û–¥–∏–Ω —Å—Ä—ã–≤ ‚â† –∫–æ–Ω–µ—Ü –ø—É—Ç–∏.
–ú–æ–∑–≥ —É—á–∏—Ç—Å—è –º–µ—Ç–æ–¥–æ–º –ø—Ä–æ–± –∏ –æ—à–∏–±–æ–∫. –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏.

–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ —Ä–µ–º–∏—Å—Å–∏–∏ ‚Äî 3-5 —Ä–∞–∑.

–¢—ã –Ω–µ –∏—Å–ø–æ—Ä—Ç–∏–ª. –¢—ã —É—á–∏—à—å—Å—è.""",
    
    """ü§Ø ¬´–ù–ò–ß–ï–ì–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢¬ª

–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: —á—ë—Ä–Ω–æ-–±–µ–ª–æ–µ –º—ã—à–ª–µ–Ω–∏–µ.

–§–∞–∫—Ç: –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ.
–ù–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏. CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è 4-6 –Ω–µ–¥–µ–ª—å.

–ú–æ–∑–≥ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –Ω–æ —Ç—ã –Ω–µ –≤–∏–¥–∏—à—å —ç—Ç–æ–≥–æ.

–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚â† –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.""",
    
    """ü§Ø ¬´–Ø –°–õ–ê–ë–´–ô¬ª

–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è.

–§–∞–∫—Ç: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äî –±–æ–ª–µ–∑–Ω—å, –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å.
–¢—ã –±–æ—Ä–µ—à—å—Å—è —Å –Ω–µ–π—Ä–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–º –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º. –≠—Ç–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã.

85% –ª—é–¥–µ–π —Å—Ä—ã–≤–∞—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π.

–¢—ã –Ω–µ —Å–ª–∞–±—ã–π. –¢—ã –±–æ—Ä–µ—à—å—Å—è —Å —Ö–∏–º–∏–µ–π –º–æ–∑–≥–∞.""",
    
    """ü§Ø ¬´–í–°–Å –ë–ï–°–°–ú–´–°–õ–ï–ù–ù–û¬ª

–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ.

–§–∞–∫—Ç: –°–º—ã—Å–ª –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 2-3 –Ω–µ–¥–µ–ª–∏.
–°–µ–π—á–∞—Å –º–æ–∑–≥ –≤ —Ä–µ–∂–∏–º–µ –≤—ã–∂–∏–≤–∞–Ω–∏—è. –î–æ—Ñ–∞–º–∏–Ω–∞ –º–∞–ª–æ ‚Äî –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä—ã–º.

–≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.

–ß—É–≤—Å—Ç–≤–æ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî —Å–∏–º–ø—Ç–æ–º –ª–æ–º–∫–∏, –∞ –Ω–µ –ø—Ä–∞–≤–¥–∞ –æ –∂–∏–∑–Ω–∏.""",
    
    """ü§Ø ¬´–£ –î–†–£–ì–ò–• –ü–û–õ–£–ß–ê–ï–¢–°–Ø¬ª

–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ.

–§–∞–∫—Ç: –£ –≤—Å–µ—Ö —Å–≤–æ–∏ —Å—Ä–æ–∫–∏.
–¢—ã –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –Ω–µ 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –Ω–µ–≥–æ. –ù–µ 6 –º–µ—Å—è—Ü–µ–≤ –ª–æ–º–∫–∏. –ù–µ —Å—Ä—ã–≤—ã.

–ö–∞–∂–¥—ã–π –ø—É—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω.

–°—Ä–∞–≤–Ω–∏–≤–∞–π —Å–µ–±—è —Ç–æ–ª—å–∫–æ —Å —Å–æ–±–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–º.""",
    
    """ü§Ø ¬´–û–î–ò–ù –†–ê–ó –ù–ï –°–ß–ò–¢–ê–ï–¢–°–Ø¬ª

–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è.

–§–∞–∫—Ç: –ö–∞–∂–¥—ã–π ¬´–æ–¥–∏–Ω —Ä–∞–∑¬ª —Å—á–∏—Ç–∞–µ—Ç—Å—è.
–ú–æ–∑–≥ –Ω–µ –¥–µ–ª–∏—Ç –Ω–∞ ¬´—Ä–∞–∑—ã¬ª. –î–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π –≤—Å–ø–ª–µ—Å–∫ = —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–≤—è–∑–∏.

–û–¥–∏–Ω —Ä–∞–∑ = –æ—Ç–∫–∞—Ç –Ω–∞–∑–∞–¥ –Ω–∞ –Ω–µ–¥–µ–ª—é.

–ï—Å–ª–∏ ¬´–Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è¬ª ‚Äî –∑–∞—á–µ–º —Ç–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è?"""
]

TRIGGERS_INFO = [
    """‚ö†Ô∏è –ú–´–°–õ–¨ ¬´–•–û–ß–£¬ª

–ú—ã—Å–ª—å ‚â† –∫–æ–º–∞–Ω–¥–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—é.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –ù–∞–±–ª—é–¥–∞–π –∑–∞ –º—ã—Å–ª—å—é –∫–∞–∫ –∑–∞ –æ–±–ª–∞–∫–æ–º
‚Ä¢ –ù–µ —Å–ø–æ—Ä—å —Å –Ω–µ–π, –Ω–µ —É–±–µ–∂–¥–∞–π —Å–µ–±—è
‚Ä¢ –ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ—Ç—å: ¬´–û, —ç—Ç–æ —Å–Ω–æ–≤–∞ –º—ã—Å–ª—å¬ª
‚Ä¢ –ß–µ—Ä–µ–∑ 3-7 –º–∏–Ω—É—Ç –æ–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞

–¢—ã –Ω–µ –æ–±—è–∑–∞–Ω —Å–ª—É—à–∞—Ç—å—Å—è –∫–∞–∂–¥–æ–π –º—ã—Å–ª–∏.""",
    
    """‚ö†Ô∏è –°–ò–õ–¨–ù–ê–Ø –≠–ú–û–¶–ò–Ø

–ó–ª–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, —Ç—Ä–µ–≤–æ–≥–∞ ‚Äî –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –∂–µ–ª–∞–Ω–∏–µ —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –ù–∞–∑–æ–≤–∏ —ç–º–æ—Ü–∏—é –≤—Å–ª—É—Ö: ¬´–≠—Ç–æ –∑–ª–æ—Å—Ç—å¬ª
‚Ä¢ –≠–º–æ—Ü–∏–∏ –∫–∞–∫ –≤–æ–ª–Ω—ã ‚Äî –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –∏ —Å–ø–∞–¥–∞—é—Ç
‚Ä¢ –ù–µ –Ω–∞–¥–æ —É–±–µ–≥–∞—Ç—å –æ—Ç —ç–º–æ—Ü–∏–∏ –≤ –≤–µ—â–µ—Å—Ç–≤–æ
‚Ä¢ –ü—Ä–æ–∂–∏—Ç—å —ç–º–æ—Ü–∏—é = —Å—Ç–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ

–≠—Ç–æ –ø—Ä–æ–π–¥—ë—Ç. –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç.""",
    
    """‚ö†Ô∏è –°–ö–£–ö–ê / –ë–ï–ó–î–ï–õ–¨–ï

–ú–æ–∑–≥ –ø—É—Ç–∞–µ—Ç —Å–∫—É–∫—É —Å –∂–µ–ª–∞–Ω–∏–µ–º —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å. –ï–º—É –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–∞ —Å—Ç–∏–º—É–ª—è—Ü–∏—è.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –°–∫—É–∫–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç—è–≥–∞, —ç—Ç–æ —Å–∏–≥–Ω–∞–ª ¬´–∑–∞–π–º–∏—Å—å —á–µ–º-—Ç–æ¬ª
‚Ä¢ 10 –º–∏–Ω—É—Ç –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ –ü—Ä–æ–≥—É–ª–∫–∞, —É–±–æ—Ä–∫–∞, –∑–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É
‚Ä¢ –ù–æ–≤—ã–π –¥–æ—Ñ–∞–º–∏–Ω –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞

–°–∫—É–∫–∞ –ª–µ—á–∏—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ–º, –∞ –Ω–µ –≤–µ—â–µ—Å—Ç–≤–æ–º.""",
    
    """‚ö†Ô∏è –°–¢–†–ï–°–° / –¢–†–ï–í–û–ì–ê

–¢—Ä–µ–≤–æ–≥–∞ –≥–æ–≤–æ—Ä–∏—Ç: ¬´–£–±–µ–≥–∏!¬ª –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞–µ—Ç: ¬´–ó–Ω–∞—é –∫–∞–∫¬ª.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –¢—Ä–µ–≤–æ–≥–∞ –ø—Ä–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç
‚Ä¢ –î—ã—Ö–∞–Ω–∏–µ 4-7-8: –≤–¥–æ—Ö 4, –∑–∞–¥–µ—Ä–∂–∫–∞ 7, –≤—ã–¥–æ—Ö 8
‚Ä¢ –•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ –Ω–∞ –ª–∏—Ü–æ
‚Ä¢ –°–∫–∞–∂–∏ –≤—Å–ª—É—Ö: ¬´–Ø –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ–π—á–∞—Å¬ª

–¢—Ä–µ–≤–æ–≥–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è. –°—Ä—ã–≤ ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π.""",
    
    """‚ö†Ô∏è –ö–û–ú–ü–ê–ù–ò–Ø / –û–ö–†–£–ñ–ï–ù–ò–ï

–°–∞–º—ã–π —Å–∏–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä. –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ + –ø—Ä–∏–≤—ã—á–Ω–∞—è –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –ò–∑–±–µ–≥–∞–π –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π
‚Ä¢ –ï—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏–∑–±–µ–∂–∞—Ç—å ‚Äî –∑–∞—Ä–∞–Ω–µ–µ —Ä–µ–ø–µ—Ç–∏—Ä—É–π –æ—Ç–∫–∞–∑
‚Ä¢ ¬´–ó–∞–≤—è–∑–∞–ª¬ª, ¬´–ù–µ —Ö–æ—á—É¬ª, ¬´–ú–Ω–µ –Ω–µ–ª—å–∑—è¬ª
‚Ä¢ –í—ã—Ö–æ–¥–∏ –∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏

–¢–≤–æ—è —Ç—Ä–µ–∑–≤–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —á—É–∂–æ–≥–æ –º–Ω–µ–Ω–∏—è.""",
    
    """‚ö†Ô∏è –ì–û–õ–û–î / –ñ–ê–ñ–î–ê

–ú–æ–∑–≥ –ø—É—Ç–∞–µ—Ç —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å —Å —Ç—è–≥–æ–π.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –í—ã–ø–µ–π —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã
‚Ä¢ –°—ä–µ—à—å —á—Ç–æ-—Ç–æ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–µ
‚Ä¢ –ü–æ–¥–æ–∂–¥–∏ 20 –º–∏–Ω—É—Ç
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å: ¬´–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç—è–≥–∞ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≥–æ–ª–æ–¥?¬ª

–¢–µ–ª–æ –ø—Ä–æ—Å–∏—Ç –µ–¥—É, –∞ –Ω–µ –≤–µ—â–µ—Å—Ç–≤–æ.""",
    
    """‚ö†Ô∏è –ü–†–ê–ó–î–ù–ò–ö / –£–°–ü–ï–•

–ú–æ–∑–≥ —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ä–∞–¥–æ—Å—Ç—å —Å –Ω–∞–≥—Ä–∞–¥–æ–π –≤ –≤–∏–¥–µ –≤–µ—â–µ—Å—Ç–≤–∞.

–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –ü—Ä–∏–∑–Ω–∞–π —É—Å–ø–µ—Ö: ¬´–Ø —ç—Ç–æ –∑–∞—Å–ª—É–∂–∏–ª¬ª
‚Ä¢ –ù–∞–π–¥–∏ –∑–¥–æ—Ä–æ–≤—É—é –Ω–∞–≥—Ä–∞–¥—É: –≤–∫—É—Å–Ω–∞—è –µ–¥–∞, –ø–æ–¥–∞—Ä–æ–∫ —Å–µ–±–µ
‚Ä¢ –ü–æ–¥–µ–ª–∏—Å—å —Ä–∞–¥–æ—Å—Ç—å—é —Å –¥—Ä—É–≥–∏–º–∏
‚Ä¢ –ó–∞–ø–æ–º–Ω–∏: —É—Å–ø–µ—Ö –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π —É—Å–ø–µ—Ö

–¢—ã –¥–æ—Å—Ç–æ–∏–Ω –ø—Ä–∞–∑–¥–Ω–∏–∫–∞, –∞ –Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏."""
]

SCIENCE_FACTS = [
    """üî¨ CB1-–†–ï–¶–ï–ü–¢–û–†–´

–ö–∞–Ω–Ω–∞–±–∏–Ω–æ–∏–¥–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤ –º–æ–∑–≥–µ. –¢–ì–ö –∏—Ö –±–ª–æ–∫–∏—Ä—É–µ—Ç.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è: +28% –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
‚Ä¢ –î–≤–µ –Ω–µ–¥–µ–ª–∏: +50%
‚Ä¢ 4 –Ω–µ–¥–µ–ª–∏: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚Ä¢ 6 –Ω–µ–¥–µ–ª–∏: 100% –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ ‚Äî —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.""",
    
    """üî¨ –î–û–§–ê–ú–ò–ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê

–¢–ì–ö –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω –≤ 2-3 —Ä–∞–∑–∞. –ú–æ–∑–≥ —Å–Ω–∏–∂–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –ù–µ–¥–µ–ª—è: –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤—Å—ë –µ—â—ë –Ω–∏–∑–∫–æ–µ
‚Ä¢ –î–≤–µ –Ω–µ–¥–µ–ª–∏: –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
‚Ä¢ –ú–µ—Å—è—Ü: –¥–æ—Ñ–∞–º–∏–Ω –ø–æ—á—Ç–∏ –≤ –Ω–æ—Ä–º–µ
‚Ä¢ 2-4 –º–µ—Å—è—Ü–∞: –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

–ú–æ–∑–≥ —É—á–∏—Ç—Å—è —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è —Å–∞–º.""",
    
    """üî¨ –°–û–ù –ò –ú–ï–õ–ê–¢–û–ù–ò–ù

–¢–ì–ö –Ω–∞—Ä—É—à–∞–µ—Ç REM-—Ñ–∞–∑—É —Å–Ω–∞. –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è: –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –∫–æ—à–º–∞—Ä—ã
‚Ä¢ 10-14 –¥–Ω–µ–π: —Å–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–ª—É–±–∂–µ
‚Ä¢ 21 –¥–µ–Ω—å: REM-—Ñ–∞–∑–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü: —Å–æ–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π

–ì–ª—É–±–æ–∫–∏–π —Å–æ–Ω = –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∑–≥–∞.""",
    
    """üî¨ –ü–ê–ú–Ø–¢–¨ –ò –ì–ò–ü–ü–û–ö–ê–ú–ü

–¢–ì–ö –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç –≥–∏–ø–ø–æ–∫–∞–º–ø ‚Äî —Ü–µ–Ω—Ç—Ä –ø–∞–º—è—Ç–∏ –∏ –æ–±—É—á–µ–Ω–∏—è.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –î–≤–µ –Ω–µ–¥–µ–ª–∏: –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å —É–ª—É—á—à–∞–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü: –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ +25%
‚Ä¢ –¢—Ä–∏ –º–µ—Å—è—Ü–∞: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚Ä¢ 6-12 –º–µ—Å—è—Ü–µ–≤: –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤—ã–π

–¢—ã —Å—Ç–∞–Ω–µ—à—å —É–º–Ω–µ–µ. –ë—É–∫–≤–∞–ª—å–Ω–æ.""",
    
    """üî¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–†–´–í–û–í

–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã:
‚Ä¢ 85% —Å—Ä—ã–≤–∞—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π
‚Ä¢ 60% ‚Äî –≤ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫: 3-5 —Ä–∞–∑
‚Ä¢ –ü–æ—Å–ª–µ 90 –¥–Ω–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—Ä—ã–≤–∞ –ø–∞–¥–∞–µ—Ç –¥–æ 15%

–ï—Å–ª–∏ —Å–æ—Ä–≤–∞–ª—Å—è ‚Äî —Ç—ã –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è.""",
    
    """üî¨ –ü–†–ï–§–†–û–ù–¢–ê–õ–¨–ù–ê–Ø –ö–û–†–ê

–¶–µ–Ω—Ç—Ä –≤–æ–ª–∏ –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π. –¢–ì–ö –µ—ë —É–≥–Ω–µ—Ç–∞–µ—Ç.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è: –Ω–æ–ª—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏
‚Ä¢ –î–≤–µ –Ω–µ–¥–µ–ª–∏: –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤—Å–ø–ª–µ—Å–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ú–µ—Å—è—Ü: –≤–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ –¢—Ä–∏ –º–µ—Å—è—Ü–∞: —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è

–ê–ø–∞—Ç–∏—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è. –≠—Ç–æ –Ω–µ —Ç—ã ‚Äî —ç—Ç–æ —Ö–∏–º–∏—è.""",
    
    """üî¨ BDNF (Brain-Derived Neurotrophic Factor)

–ë–µ–ª–æ–∫ —Ä–æ—Å—Ç–∞ –º–æ–∑–≥–∞. –¢–ì–ö —Å–Ω–∏–∂–∞–µ—Ç –µ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –ü–µ—Ä–≤—ã–µ –¥–Ω–∏: BDNF –Ω–∞ –º–∏–Ω–∏–º—É–º–µ
‚Ä¢ 1-2 –Ω–µ–¥–µ–ª–∏: –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏
‚Ä¢ –ú–µ—Å—è—Ü: —É—Ä–æ–≤–µ–Ω—å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: –º–æ–∑–≥ —Å—Ç—Ä–æ–∏—Ç –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏

–≠—Ç–æ—Ç –±–µ–ª–æ–∫ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —É–º–Ω–µ–µ –∏ —É—Å—Ç–æ–π—á–∏–≤–µ–µ.""",
    
    """üî¨ –°–ï–†–î–ï–ß–ù–û-–°–û–°–£–î–ò–°–¢–ê–Ø –°–ò–°–¢–ï–ú–ê

–¢–ì–ö —É—Å–∫–æ—Ä—è–µ—Ç –ø—É–ª—å—Å –Ω–∞ 20-50%.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –ü–µ—Ä–≤—ã–µ 72 —á–∞—Å–∞: –ø—É–ª—å—Å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è
‚Ä¢ –ù–µ–¥–µ–ª—è: –¥–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü: —Å–µ—Ä–¥–µ—á–Ω—ã–π —Ä–∏—Ç–º –∑–¥–æ—Ä–æ–≤—ã–π
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

–¢–≤–æ—ë —Å–µ—Ä–¥—Ü–µ —Å–∫–∞–∂–µ—Ç —Å–ø–∞—Å–∏–±–æ.""",
    
    """üî¨ –ú–û–¢–ò–í–ê–¶–ò–Ø –ò –ê–ù–ì–ï–î–û–ù–ò–Ø

–ê–Ω–≥–µ–¥–æ–Ω–∏—è ‚Äî –Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ.

–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚Ä¢ –î–Ω–∏ 1-7: –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä—ã–º
‚Ä¢ –ù–µ–¥–µ–ª—è 2: –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏
‚Ä¢ –ú–µ—Å—è—Ü: –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
‚Ä¢ 2-3 –º–µ—Å—è—Ü–∞: –∂–∏–∑–Ω—å —Å–Ω–æ–≤–∞ —è—Ä–∫–∞—è

–≠—Ç–æ –Ω–µ –¥–µ–ø—Ä–µ—Å—Å–∏—è. –≠—Ç–æ –º–æ–∑–≥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è.""",
    
    """üî¨ –ù–ï–ô–†–û–ü–õ–ê–°–¢–ò–ß–ù–û–°–¢–¨

–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ –º–µ–Ω—è—Ç—å—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.

–§–∞–∫—Ç—ã:
‚Ä¢ –í –ª—é–±–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ –º–æ–∑–≥ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
‚Ä¢ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø—É—Ç–∏
‚Ä¢ –ú–æ–∑–≥ –ø–æ–º–Ω–∏—Ç —Å—Ç–∞—Ä—ã–µ —Å–≤—è–∑–∏ 6-12 –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –ù–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∑–∞ 21-90 –¥–Ω–µ–π

–¢–≤–æ–π –º–æ–∑–≥ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —Ç—ã –¥—É–º–∞–µ—à—å.""",
    
    """üî¨ –ì–û–†–ú–û–ù–ê–õ–¨–ù–´–ô –ë–ê–õ–ê–ù–°

–ö–∞–Ω–Ω–∞–±–∏—Å –Ω–∞—Ä—É—à–∞–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É –≥–æ—Ä–º–æ–Ω–æ–≤.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ –¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω: 2-4 –Ω–µ–¥–µ–ª–∏ –¥–æ –Ω–æ—Ä–º—ã
‚Ä¢ –ö–æ—Ä—Ç–∏–∑–æ–ª (—Å—Ç—Ä–µ—Å—Å): 3-6 –Ω–µ–¥–µ–ª—å
‚Ä¢ –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω (—Å–æ–Ω): 2-3 –Ω–µ–¥–µ–ª–∏
‚Ä¢ –°–µ—Ä–æ—Ç–æ–Ω–∏–Ω (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ): 4-8 –Ω–µ–¥–µ–ª—å

–ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é.""",
    
    """üî¨ –ö–û–ì–ù–ò–¢–ò–í–ù–´–ï –§–£–ù–ö–¶–ò–ò

–ß—Ç–æ —É–ª—É—á—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫–∞–∑–∞:

–ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏:
‚Ä¢ –í–Ω–∏–º–∞–Ω–∏–µ +15%
‚Ä¢ –ü–∞–º—è—Ç—å +20%
‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏ +10%

–ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü:
‚Ä¢ –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ —Ä–∞–Ω—å—à–µ
‚Ä¢ –Ø—Å–Ω–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è

–ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –±–µ–∑ –¢–ì–ö.""",
    
    """üî¨ –°–û–¶–ò–ê–õ–¨–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï

–ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ –æ–±—â–µ–Ω–∏–∏:

‚Ä¢ 1 –Ω–µ–¥–µ–ª—è: –º–µ–Ω—å—à–µ —Ç—Ä–µ–≤–æ–≥–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—è—Ö
‚Ä¢ 2 –Ω–µ–¥–µ–ª–∏: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏—Å–∫—Ä–µ–Ω–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å
‚Ä¢ –ú–µ—Å—è—Ü: –æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ö–∏–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∏–º—É–ª—è—Ü–∏–∏
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: –Ω–∞—Å—Ç–æ—è—â–∏–µ —ç–º–æ—Ü–∏–∏, –Ω–∞—Å—Ç–æ—è—â–∏–µ —Å–≤—è–∑–∏

–¢—ã —Å–Ω–æ–≤–∞ —É—á–∏—à—å—Å—è –æ–±—â–∞—Ç—å—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É.""",
    
    """üî¨ –§–ò–ó–ò–ß–ï–°–ö–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï

–¢–µ–ª–æ –±–µ–∑ –¢–ì–ö:

‚Ä¢ –õ–µ–≥–∫–∏–µ: –æ—á–∏—â–∞—é—Ç—Å—è –∑–∞ 3-9 –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: +40% —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü
‚Ä¢ –ê–ø–ø–µ—Ç–∏—Ç: –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∑–∞ 2-3 –Ω–µ–¥–µ–ª–∏
‚Ä¢ –ò–º–º—É–Ω–∏—Ç–µ—Ç: —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 4-6 –Ω–µ–¥–µ–ª—å

–¢–µ–ª–æ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.""",
    
    """üî¨ –≠–ö–û–ù–û–ú–ò–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

–¶–∏—Ñ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –∑–∞–¥—É–º–∞—Ç—å—Å—è:

–°—Ä–µ–¥–Ω–∏–µ —Ç—Ä–∞—Ç—ã –≤ –º–µ—Å—è—Ü:
‚Ä¢ –¢—Ä–∞–≤–∞: 10,000-30,000 ‚ÇΩ
‚Ä¢ –í–µ–π–ø—ã/–∫–∞—Ä—Ç—Ä–∏–¥–∂–∏: 15,000-50,000 ‚ÇΩ
‚Ä¢ –ü–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫: 20,000-50,000 ‚ÇΩ
‚Ä¢ –ó–¥–æ—Ä–æ–≤—å–µ (–∫–æ—Å–≤–µ–Ω–Ω–æ): –±–µ—Å—Ü–µ–Ω–Ω–æ

–ó–∞ –≥–æ–¥ –º–æ–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–∞ –æ—Ç–ø—É—Å–∫, –º–∞—à–∏–Ω—É, –æ–±—É—á–µ–Ω–∏–µ.""",
    
    """üî¨ –¢–û–õ–ï–†–ê–ù–¢–ù–û–°–¢–¨ –ò –°–ï–ù–°–ò–¢–ò–ó–ê–¶–ò–Ø

–ß–µ–º –±–æ–ª—å—à–µ —É–ø–æ—Ç—Ä–µ–±–ª—è–µ—à—å ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ —ç—Ñ—Ñ–µ–∫—Ç–∞.

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
‚Ä¢ 1 –º–µ—Å—è—Ü: —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è –Ω–∞ 50%
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ 6 –º–µ—Å—è—Ü–µ–≤: –º–æ–∑–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é ¬´–∑–∞–±—ã–≤–∞–µ—Ç¬ª —Å—Ç–∞—Ä—ã–µ –¥–æ–∑—ã

–ß–µ–º –¥–æ–ª—å—à–µ —á–∏—Å—Ç–æ—Ç–∞ ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ —Ö–æ—á–µ—Ç—Å—è."""
]

_user_data_cache = None
_data_lock = asyncio.Lock()

def get_main_keyboard():
    return ReplyKeyboardMarkup([
        [KeyboardButton("‚úä –î–µ—Ä–∂—É—Å—å"), KeyboardButton("üòî –¢—è–∂–µ–ª–æ")],
        [KeyboardButton("üëã –¢—ã —Ç—É—Ç?"), KeyboardButton("üìä –î–Ω–∏")],
        [KeyboardButton("‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ"), KeyboardButton("‚è∏ –ü–æ–º–æ–ª—á–∏")]
    ], resize_keyboard=True)

def get_start_keyboard():
    return ReplyKeyboardMarkup([[KeyboardButton("‚ñ∂ –ù–∞—á–∞—Ç—å")]], resize_keyboard=True)

def get_heavy_keyboard():
    return ReplyKeyboardMarkup([
        [KeyboardButton("üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ"), KeyboardButton("üß† –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")],
        [KeyboardButton("üíî –°—Ä—ã–≤"), KeyboardButton("‚Ü© –ù–∞–∑–∞–¥")]
    ], resize_keyboard=True)

def get_info_keyboard():
    return ReplyKeyboardMarkup([
        [KeyboardButton("üìÖ –°—Ç–∞–¥–∏–∏"), KeyboardButton("‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã")],
        [KeyboardButton("ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è"), KeyboardButton("üî¨ –§–∞–∫—Ç—ã")],
        [KeyboardButton("‚Ü© –ù–∞–∑–∞–¥")]
    ], resize_keyboard=True)

def load_data():
    global _user_data_cache
    if _user_data_cache is not None:
        return _user_data_cache
    
    with FileLock(LOCK_FILE):
        if not os.path.exists(DATA_FILE):
            _user_data_cache = {}
            return _user_data_cache
        
        try:
            with open(DATA_FILE, "r", encoding="utf-8") as f:
                data = json.load(f)
                _user_data_cache = data
                return data
        except json.JSONDecodeError:
            logger.warning("–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤—Ä–µ–∂–¥—ë–Ω, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π")
            _user_data_cache = {}
            return {}
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
            _user_data_cache = {}
            return {}

async def save_data():
    global _user_data_cache
    if _user_data_cache is None:
        return
    
    async with _data_lock:
        with FileLock(LOCK_FILE):
            try:
                with open(DATA_FILE, "w", encoding="utf-8") as f:
                    json.dump(_user_data_cache, f, ensure_ascii=False, indent=2)
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {e}")

def get_user(user_id):
    data = load_data()
    uid = str(user_id)
    
    if uid not in data:
        data[uid] = {
            "start_date": None,
            "active": False,
            "best_streak": 0,
            "hold_count_today": 0,
            "last_hold_date": None,
            "last_hold_time": None,
            "last_stage_index": 0,
            "used_tips": [],
            "used_triggers": [],
            "used_distortions": [],
            "used_facts": []
        }
        asyncio.create_task(save_data())
    
    return data[uid]

async def save_user(user_id, updates=None):
    data = load_data()
    uid = str(user_id)
    
    if updates:
        if uid not in data:
            data[uid] = {}
        data[uid].update(updates)
    
    await save_data()

def get_active_users():
    data = load_data()
    return [int(uid) for uid, user in data.items() if user.get("active", False)]

def get_current_time():
    return datetime.now(MOSCOW_TZ)

def get_current_date():
    return get_current_time().date()

def get_days_since_start(user_id):
    user = get_user(user_id)
    if not user["start_date"]:
        return 0
    
    try:
        start = date.fromisoformat(user["start_date"])
        current = get_current_date()
        days = (current - start).days
        return max(days, 0)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –¥–Ω–µ–π –¥–ª—è {user_id}: {e}")
        return 0

def format_days(days):
    if 11 <= days % 100 <= 19:
        return f"{days} –¥–Ω–µ–π"
    if days % 10 == 1:
        return f"{days} –¥–µ–Ω—å"
    if days % 10 in [2, 3, 4]:
        return f"{days} –¥–Ω—è"
    return f"{days} –¥–Ω–µ–π"

def get_next_exercise(user_id):
    user = get_user(user_id)
    used = user.get("used_tips", [])
    
    if len(used) >= len(HELP_TECHNIQUES):
        used = []
    
    available = [i for i in range(len(HELP_TECHNIQUES)) if i not in used]
    if not available:
        available = list(range(len(HELP_TECHNIQUES)))
        used = []
    
    choice = random.choice(available)
    used.append(choice)
    
    asyncio.create_task(save_user(user_id, {"used_tips": used}))
    
    return HELP_TECHNIQUES[choice]

def get_next_stage(user_id):
    user = get_user(user_id)
    last_index = user.get("last_stage_index", 0)
    
    stage_text = RECOVERY_STAGES[last_index]
    next_index = (last_index + 1) % len(RECOVERY_STAGES)
    
    asyncio.create_task(save_user(user_id, {"last_stage_index": next_index}))
    
    return stage_text

def get_next_item(user_id, items_list, used_key):
    user = get_user(user_id)
    used = user.get(used_key, [])
    
    if len(used) >= len(items_list):
        used = []
    
    available = [i for i in range(len(items_list)) if i not in used]
    if not available:
        available = list(range(len(items_list)))
        used = []
    
    choice = random.choice(available)
    used.append(choice)
    
    asyncio.create_task(save_user(user_id, {used_key: used}))
    
    return items_list[choice]

async def reset_streak(user_id):
    current = get_days_since_start(user_id)
    user = get_user(user_id)
    
    if current > user.get("best_streak", 0):
        await save_user(user_id, {"best_streak": current})
    
    await save_user(user_id, {
        "start_date": get_current_date().isoformat(),
        "last_stage_index": 0,
        "hold_count_today": 0,
        "last_hold_date": None,
        "last_hold_time": None,
        "used_tips": [],
        "used_triggers": [],
        "used_distortions": [],
        "used_facts": []
    })
    
    return current

def remove_user_jobs(chat_id, job_queue):
    removed = 0
    for name in [f"morning_{chat_id}", f"evening_{chat_id}", f"night_{chat_id}"]:
        jobs = job_queue.get_jobs_by_name(name)
        for job in jobs:
            job.schedule_removal()
            removed += 1
    return removed

def schedule_jobs(chat_id, job_queue):
    existing_jobs = []
    for name in [f"morning_{chat_id}", f"evening_{chat_id}", f"night_{chat_id}"]:
        if job_queue.get_jobs_by_name(name):
            existing_jobs.extend(job_queue.get_jobs_by_name(name))
    
    if existing_jobs:
        remove_user_jobs(chat_id, job_queue)
    
    job_queue.run_daily(
        send_morning,
        time(9, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"morning_{chat_id}"
    )
    job_queue.run_daily(
        send_evening,
        time(18, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"evening_{chat_id}"
    )
    job_queue.run_daily(
        send_night,
        time(23, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"night_{chat_id}"
    )

async def send_morning(context: ContextTypes.DEFAULT_TYPE):
    chat_id = context.job.data['chat_id']
    user = get_user(chat_id)
    
    if not user.get("active"):
        return
    
    days = get_days_since_start(chat_id)
    msg = random.choice(MORNING_MESSAGES)
    
    if days in MILESTONES:
        msg += f"\n\n{MILESTONES[days]}"
    
    await context.bot.send_message(chat_id, msg, reply_markup=get_main_keyboard())

async def send_evening(context: ContextTypes.DEFAULT_TYPE):
    chat_id = context.job.data['chat_id']
    user = get_user(chat_id)
    
    if not user.get("active"):
        return
    
    await context.bot.send_message(
        chat_id,
        random.choice(EVENING_MESSAGES),
        reply_markup=get_main_keyboard()
    )

async def send_night(context: ContextTypes.DEFAULT_TYPE):
    chat_id = context.job.data['chat_id']
    user = get_user(chat_id)
    
    if not user.get("active"):
        return
    
    await context.bot.send_message(
        chat_id,
        random.choice(NIGHT_MESSAGES),
        reply_markup=get_main_keyboard()
    )

async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    user = get_user(chat_id)
    
    was_active = user.get("active", False)
    
    await save_user(chat_id, {
        "active": True,
        "start_date": get_current_date().isoformat(),
        "last_stage_index": 0,
        "used_tips": [],
        "used_triggers": [],
        "used_distortions": [],
        "used_facts": [],
        "hold_count_today": 0,
        "last_hold_date": None,
        "last_hold_time": None
    })
    
    if not was_active:
        schedule_jobs(chat_id, context.application.job_queue)
    
    days = get_days_since_start(chat_id)
    
    if days == 0:
        msg = (
            "–ü—Ä–∏–≤–µ—Ç, –±—Ä–∞—Ç! üëã\n\n"
            "–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å —Ç—Ä–∏ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å: —Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å—Ç–æ–∏—Ç.\n\n"
            "–ö–æ–≥–¥–∞ —Ç—è–∂–µ–ª–æ ‚Äî –∂–º–∏ ¬´‚úä –î–µ—Ä–∂—É—Å—å¬ª.\n"
            "–í—Å–µ –ø–æ–ª—É—á–∞—Ç –ø—É—à. –¢–∞–∫ —Ç—ã –ø–æ–∫–∞–∂–µ—à—å, —á—Ç–æ –µ—â—ë –∑–¥–µ—Å—å.\n"
            "–ú–æ–∂–Ω–æ –∂–∞—Ç—å –¥–æ 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º —Ç—è–∂–µ–ª–æ.\n\n"
            "–î–µ—Ä–∂–∏—Å—å, —è —Ä—è–¥–æ–º. üí™"
        )
    else:
        msg = (
            f"–ü—Ä–∏–≤–µ—Ç. –¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è {format_days(days)}. –Ø —Ä—è–¥–æ–º.\n\n"
            "–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å —Ç—Ä–∏ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å: —Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å—Ç–æ–∏—Ç.\n\n"
            "–ö–æ–≥–¥–∞ —Ç—è–∂–µ–ª–æ ‚Äî –∂–º–∏ ¬´‚úä –î–µ—Ä–∂—É—Å—å¬ª.\n"
            "–í—Å–µ –ø–æ–ª—É—á–∞—Ç –ø—É—à. –¢–∞–∫ —Ç—ã –ø–æ–∫–∞–∂–µ—à—å, —á—Ç–æ –µ—â—ë –∑–¥–µ—Å—å.\n"
            "–ú–æ–∂–Ω–æ –∂–∞—Ç—å –¥–æ 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º —Ç—è–∂–µ–ª–æ.\n\n"
            "–î–µ—Ä–∂–∏—Å—å, —è —Ä—è–¥–æ–º. üí™"
        )
    
    await update.message.reply_text(msg, reply_markup=get_main_keyboard())

async def stop_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    
    await save_user(chat_id, {"active": False})
    removed = remove_user_jobs(chat_id, context.application.job_queue)
    
    await update.message.reply_text(
        "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.\n–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ ‚Äî –∂–º–∏ ‚ñ∂ –ù–∞—á–∞—Ç—å",
        reply_markup=get_start_keyboard()
    )

async def handle_hold(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    user = get_user(chat_id)
    
    if not user.get("active"):
        await update.message.reply_text(
            "–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ ‚ñ∂ –ù–∞—á–∞—Ç—å",
            reply_markup=get_start_keyboard()
        )
        return
    
    current_time = get_current_time()
    today_str = current_time.date().isoformat()
    
    if user.get("last_hold_date") != today_str:
        await save_user(chat_id, {
            "hold_count_today": 0,
            "last_hold_date": today_str
        })
    
    if user.get("last_hold_time"):
        try:
            last_time_str = user["last_hold_time"]
            
            try:
                if 'T' in last_time_str:
                    last_time = datetime.fromisoformat(last_time_str)
                else:
                    last_time = datetime.strptime(last_time_str, "%Y-%m-%d %H:%M:%S").replace(tzinfo=MOSCOW_TZ)
            except ValueError:
                last_time = current_time - timedelta(minutes=31)
            
            if last_time.tzinfo is None:
                last_time = last_time.replace(tzinfo=MOSCOW_TZ)
            
            diff = (current_time - last_time).total_seconds()
            if diff < 1800:
                mins = int((1800 - diff) / 60) + 1
                await update.message.reply_text(
                    f"–ü–æ–¥–æ–∂–¥–∏ –µ—â—ë {mins} {'–º–∏–Ω—É—Ç—É' if mins == 1 else '–º–∏–Ω—É—Ç'}.\n\n"
                    f"–¢—ã —É–∂–µ –Ω–∞–∂–∏–º–∞–ª –Ω–µ–¥–∞–≤–Ω–æ. –î–∞–π –≤—Ä–µ–º–µ–Ω–∏.\n"
                    f"–¢—è–≥–∞ –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏.",
                    reply_markup=get_main_keyboard()
                )
                return
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–∞—É—Ç–∞: {e}")
    
    if user.get("hold_count_today", 0) >= 5:
        await update.message.reply_text(
            "–°–µ–≥–æ–¥–Ω—è —É–∂–µ 5 —Ä–∞–∑.\n–ó–∞–≤—Ç—Ä–∞ —Å–Ω–æ–≤–∞ —Å–º–æ–∂–µ—à—å.",
            reply_markup=get_main_keyboard()
        )
        return
    
    await save_user(chat_id, {
        "last_hold_time": current_time.isoformat(),
        "last_hold_date": today_str,
        "hold_count_today": user.get("hold_count_today", 0) + 1
    })
    
    await update.message.reply_text(
        random.choice(HOLD_RESPONSES),
        reply_markup=get_main_keyboard()
    )
    
    active = get_active_users()
    for uid in active:
        if uid != chat_id:
            try:
                await context.bot.send_message(uid, "‚úä")
                await asyncio.sleep(0.05)
            except Exception as e:
                error_str = str(e).lower()
                if "blocked" in error_str or "chat not found" in error_str or "forbidden" in error_str:
                    await save_user(uid, {"active": False})
                    remove_user_jobs(uid, context.application.job_queue)

async def handle_heavy(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–ü–æ–Ω–∏–º–∞—é, –±—ã–≤–∞–µ—Ç —Ç—è–∂–µ–ª–æ.\n\n"
        "–í—ã–±–µ—Ä–∏, —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:\n\n"
        "üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è —Å–Ω—è—Ç–∏—è —Ç—è–≥–∏\n"
        "üß† –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Äî –Ω–∞—É—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏ –º–µ—Ç–æ–¥—ã\n"
        "üíî –°—Ä—ã–≤ ‚Äî –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à—ë–ª —Å—Ä—ã–≤\n\n"
        "–ü–æ–º–Ω–∏: –¢—è–≥–∞ –ø—Ä–æ–π–¥—ë—Ç. –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç.",
        reply_markup=get_heavy_keyboard()
    )

async def handle_exercise(update: Update, context: ContextTypes.DEFAULT_TYPE):
    tip = get_next_exercise(update.effective_chat.id)
    await update.message.reply_text(tip, reply_markup=get_heavy_keyboard())

async def handle_info_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª:\n\n"
        "üìÖ –°—Ç–∞–¥–∏–∏ ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Ç–æ–±–æ–π\n"
        "‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã ‚Äî —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—è–≥—É –∏ –∫–∞–∫ –±–æ—Ä–æ—Ç—å—Å—è\n"
        "ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è ‚Äî –æ—à–∏–±–∫–∏ –º—ã—à–ª–µ–Ω–∏—è –ø—Ä–∏ –ª–æ–º–∫–µ\n"
        "üî¨ –§–∞–∫—Ç—ã ‚Äî –Ω–∞—É—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏",
        reply_markup=get_info_keyboard()
    )

async def handle_stages(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    stage_text = get_next_stage(chat_id)
    await update.message.reply_text(stage_text, reply_markup=get_info_keyboard())

async def handle_triggers(update: Update, context: ContextTypes.DEFAULT_TYPE):
    trigger = get_next_item(update.effective_chat.id, TRIGGERS_INFO, "used_triggers")
    await update.message.reply_text(trigger, reply_markup=get_info_keyboard())

async def handle_distortions(update: Update, context: ContextTypes.DEFAULT_TYPE):
    distortion = get_next_item(update.effective_chat.id, COGNITIVE_DISTORTIONS, "used_distortions")
    await update.message.reply_text(distortion, reply_markup=get_info_keyboard())

async def handle_facts(update: Update, context: ContextTypes.DEFAULT_TYPE):
    fact = get_next_item(update.effective_chat.id, SCIENCE_FACTS, "used_facts")
    await update.message.reply_text(fact, reply_markup=get_info_keyboard())

async def handle_breakdown(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    days_lost = await reset_streak(chat_id)
    
    msg = f"–°—á—ë—Ç—á–∏–∫ —Å–±—Ä–æ—à–µ–Ω. –¢—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª—Å—è {format_days(days_lost)}.\n\n"
    msg += "–≠—Ç–æ –Ω–µ –ø—Ä–æ–≤–∞–ª. –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏.\n\n"
    msg += "–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞ ‚Äî –∂–º–∏ ‚ñ∂ –ù–∞—á–∞—Ç—å"
    
    await update.message.reply_text(msg, reply_markup=get_start_keyboard())

async def handle_days(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    user = get_user(chat_id)
    days = get_days_since_start(chat_id)
    best = user.get("best_streak", 0)
    
    if days == 0:
        msg = "–¢—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å. –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π."
    else:
        msg = f"–¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è {format_days(days)}."
        if best > days:
            msg += f"\n\n–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {format_days(best)}"
        elif best > 0 and best == days:
            msg += f"\n\n–≠—Ç–æ —Ç–≤–æ–π –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!"
    
    await update.message.reply_text(msg, reply_markup=get_main_keyboard())
    
    if days in MILESTONES:
        await update.message.reply_text(MILESTONES[days], reply_markup=get_main_keyboard())

async def handle_are_you_here(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await asyncio.sleep(random.randint(2, 6))
    await update.message.reply_text(
        random.choice(TU_TUT_FIRST),
        reply_markup=get_main_keyboard()
    )
    await asyncio.sleep(random.randint(2, 5))
    await update.message.reply_text(
        random.choice(TU_TUT_SECOND),
        reply_markup=get_main_keyboard()
    )

async def handle_thank_you(update: Update, context: ContextTypes.DEFAULT_TYPE):
    msg = (
        "–°–ø–∞—Å–∏–±–æ —Ç–µ–±–µ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å. ‚ù§Ô∏è\n\n"
        "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:\n"
        "–°–±–µ—Ä: 2202 2084 3481 5313\n\n"
        "–õ—é–±–∞—è —Å—É–º–º–∞ –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –±–æ—Ç–∞ –¥–∞–ª—å—à–µ.\n\n"
        "–ì–ª–∞–≤–Ω–æ–µ ‚Äî –¥–µ—Ä–∂–∏—Å—å."
    )
    await update.message.reply_text(msg, reply_markup=get_main_keyboard())

async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–û–∫–µ–π", reply_markup=get_main_keyboard())

async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    
    if text == "‚ñ∂ –ù–∞—á–∞—Ç—å":
        await start_command(update, context)

async def restore_jobs(application):
    active = get_active_users()
    
    existing_jobs = list(application.job_queue.jobs())
    
    for user_id in active:
        user_has_jobs = False
        for job in existing_jobs:
            if (hasattr(job, 'name') and str(user_id) in job.name) or \
               (job.data and job.data.get('chat_id') == user_id):
                user_has_jobs = True
                break
        
        if not user_has_jobs:
            schedule_jobs(user_id, application.job_queue)

def main():
    application = Application.builder().token(TOKEN).build()
    
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("stop", stop_command))
    
    application.add_handler(MessageHandler(filters.Regex("^‚úä –î–µ—Ä–∂—É—Å—å$"), handle_hold))
    application.add_handler(MessageHandler(filters.Regex("^üìä –î–Ω–∏$"), handle_days))
    application.add_handler(MessageHandler(filters.Regex("^üòî –¢—è–∂–µ–ª–æ$"), handle_heavy))
    application.add_handler(MessageHandler(filters.Regex("^üëã –¢—ã —Ç—É—Ç\?$"), handle_are_you_here))
    application.add_handler(MessageHandler(filters.Regex("^‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ$"), handle_thank_you))
    application.add_handler(MessageHandler(filters.Regex("^‚è∏ –ü–æ–º–æ–ª—á–∏$"), stop_command))
    
    application.add_handler(MessageHandler(filters.Regex("^üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ$"), handle_exercise))
    application.add_handler(MessageHandler(filters.Regex("^üß† –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è$"), handle_info_menu))
    application.add_handler(MessageHandler(filters.Regex("^üíî –°—Ä—ã–≤$"), handle_breakdown))
    
    application.add_handler(MessageHandler(filters.Regex("^üìÖ –°—Ç–∞–¥–∏–∏$"), handle_stages))
    application.add_handler(MessageHandler(filters.Regex("^‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã$"), handle_triggers))
    application.add_handler(MessageHandler(filters.Regex("^ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è$"), handle_distortions))
    application.add_handler(MessageHandler(filters.Regex("^üî¨ –§–∞–∫—Ç—ã$"), handle_facts))
    
    application.add_handler(MessageHandler(filters.Regex("^‚Ü© –ù–∞–∑–∞–¥$"), handle_back))
    application.add_handler(MessageHandler(filters.Regex("^‚ñ∂ –ù–∞—á–∞—Ç—å$"), handle_text))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))
    
    application.post_init = restore_jobs
    
    logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω")
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == "__main__":
    main()

import logging
import random
import json
import os
import asyncio
from datetime import datetime, time, date, timedelta
from typing import Dict, Any, List, Optional
from filelock import FileLock
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
import pytz

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ====================
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler("bot_debug.log", encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    raise ValueError("‚ùå BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")

DATA_FILE = "user_data.json"
LOCK_FILE = DATA_FILE + ".lock"
MOSCOW_TZ = pytz.timezone('Europe/Moscow')

# ==================== –°–ò–°–¢–ï–ú–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø ====================
MORNING_MESSAGES = [
    "üåÖ –ü—Ä–∏–≤–µ—Ç. –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥–µ–º, —Ö–æ—Ä–æ—à–æ?",
    "üåÑ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ. –ù–µ —Å–µ–≥–æ–¥–Ω—è.",
    "‚òÄÔ∏è –ü—Ä–∏–≤–µ—Ç. –î–µ—Ä–∂–∏–º—Å—è —Å–µ–≥–æ–¥–Ω—è?",
    "üå§ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ. –°–µ–≥–æ–¥–Ω—è –º–Ω–æ–≥–æ –¥–µ–ª, –Ω–∞–≤–µ—Ä–Ω–æ–µ –Ω–µ—Ç.",
    "üåû –ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –æ–±–æ–π–¥—ë–º—Å—è –±–µ–∑ —ç—Ç–æ–≥–æ.",
    "üåá –£—Ç—Ä–æ. –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏–º.",
    "üå• –ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –ø–æ–∂–∞–ª—É–π —á—Ç–æ –Ω–µ —Å—Ç–æ–∏—Ç.",
    "üåÑ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ. –ù–∞–ø–∏—à—É –µ—â—ë —Å–µ–≥–æ–¥–Ω—è.",
    "üåÖ –ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è —Ç–æ—á–Ω–æ –Ω–µ –Ω–∞–¥–æ.",
    "üå§ –î–æ–±—Ä–æ–µ! –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –±–µ–∑ —ç—Ç–æ–≥–æ."
]

EVENING_MESSAGES = [
    "üåÜ –ù–µ —Å–µ–≥–æ–¥–Ω—è. –î–µ—Ä–∂–∏—Å—å.",
    "üåÉ –Ø —Ç—É—Ç. –î–∞–≤–∞–π –Ω–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåô –ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –¥–µ—Ä–∂–∏–º—Å—è, –ø–æ–º–Ω–∏—à—å?",
    "üåÜ –î–µ—Ä–∂–∏—Å—å. –°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç.",
    "üåâ –ï—â—ë —á—É—Ç—å-—á—É—Ç—å. –ù–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåÉ –Ø —Å —Ç–æ–±–æ–π. –°–µ–≥–æ–¥–Ω—è —Ç–æ—á–Ω–æ –Ω–µ—Ç.",
    "üåô –ü—Ä–∏–≤–µ—Ç. –î–∞–≤–∞–π –æ–±–æ–π–¥—ë–º—Å—è.",
    "üåÜ –ú—ã –∂–µ —Ä–µ—à–∏–ª–∏ ‚Äî –Ω–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåâ –î–µ—Ä–∂–∏—Å—å —Ç–∞–º. –°–µ–≥–æ–¥–Ω—è –º–∏–º–æ.",
    "üåÉ –ü—Ä–∏–≤–µ—Ç. –°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏–º."
]

NIGHT_MESSAGES = [
    "üåå –¢—ã –º–æ–ª–æ–¥–µ—Ü. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "üå† –ö—Ä–∞—Å–∞–≤—á–∏–∫. –°–ø–æ–∫–æ–π–Ω–æ–π.",
    "‚ú® –î–µ—Ä–∂–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è. –£–≤–∞–∂–∞—é.",
    "üåô –°–µ–≥–æ–¥–Ω—è —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "‚≠êÔ∏è –ú–æ–ª–æ–¥–µ—Ü, –¥–µ—Ä–∂–∏—à—å—Å—è.",
    "üåü –ï—â—ë –æ–¥–∏–Ω –¥–µ–Ω—å –ø–æ–∑–∞–¥–∏.",
    "üí´ –¢—ã —Å–∏–ª—å–Ω—ã–π. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "‚ú® –°–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å. –û—Ç–¥—ã—Ö–∞–π.",
    "‚≠êÔ∏è –°–ø—Ä–∞–≤–∏–ª—Å—è. –£–≤–∞–∂–µ–Ω–∏–µ.",
    "üåü –î–µ—Ä–∂–∞–ª—Å—è –≤–µ—Å—å –¥–µ–Ω—å. –ö—Ä–∞—Å–∞–≤–∞."
]

TU_TUT_FIRST = [
    "üìç –¢—É—Ç.", "üëã –ü—Ä–∏–≤–µ—Ç.", "ü§∑ –ê –∫—É–¥–∞ —è –¥–µ–Ω—É—Å—å?", "üìç –ó–¥–µ—Å—å.", "üìç –¢—É—Ç, –∫–∞–∫ –≤—Å–µ–≥–¥–∞.",
    "‚úÖ –î–∞, –¥–∞.", "ü§î –ö–∞–∫ –¥–µ–ª–∞?", "üëç –ê–≥–∞.", "üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π.", "üìç –¢—É—Ç, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π."
]

TU_TUT_SECOND = [
    "üí™ –î–µ—Ä–∂–∏–º—Å—è.", "ü§ù –Ø —Å —Ç–æ–±–æ–π.", "üìã –í—Å—ë –ø–æ –ø–ª–∞–Ω—É.", "üôÖ –ù–µ —Ö–æ—á—É —Å–µ–≥–æ–¥–Ω—è.", "üö´ –°–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥—É.",
    "ü§ó –Ø —Ä—è–¥–æ–º.", "üí™ –î–µ—Ä–∂–∏—Å—å.", "‚úÖ –í—Å—ë –±—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ.", "üéØ –Ø –≤ –¥–µ–ª–µ.", "‚úÖ –ü–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º."
]

HOLD_RESPONSES = ["‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. ‚úä", "üí™ –ú–æ–ª–æ–¥–µ—Ü. ‚úä", "üëå –ü–æ–Ω—è–ª. ‚úä", "üî• –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å. ‚úä"]

# ==================== –í–ï–•–ò –ü–†–û–ì–†–ï–°–°–ê ====================
MILESTONES = {
    1: "üéØ **–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å** ‚Äî —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π. –¢—ã —É–∂–µ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–≤—ã–π —à–∞–≥!",
    3: "‚ú® **–¢—Ä–∏ –¥–Ω—è** ‚Äî —Å–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ –ø–æ–∑–∞–¥–∏. –†–µ—Ü–µ–ø—Ç–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.",
    7: "üåü **–ù–µ–¥–µ–ª—è** ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã —Å–ª–∞–±–µ—é—Ç. –¢—ã —É–∂–µ —á—É–≤—Å—Ç–≤—É–µ—à—å —Ä–∞–∑–Ω–∏—Ü—É!",
    14: "üí´ **–î–≤–µ –Ω–µ–¥–µ–ª–∏** ‚Äî —Å–æ–Ω –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è, –≥–æ–ª–æ–≤–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Å–Ω–µ–µ.",
    21: "üî• **–¢—Ä–∏ –Ω–µ–¥–µ–ª–∏** ‚Äî —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏. –¢—ã –ø–æ—á—Ç–∏ –Ω–µ –¥—É–º–∞–µ—à—å –æ–± —ç—Ç–æ–º.",
    30: "üèÜ **–ú–µ—Å—è—Ü** ‚Äî –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–Ω–æ–≤–æ–º—É. –¢—ã —É–∂–µ –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫.",
    60: "üöÄ **–î–≤–∞ –º–µ—Å—è—Ü–∞** ‚Äî –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.",
    90: "üéñ **–¢—Ä–∏ –º–µ—Å—è—Ü–∞** ‚Äî –º–æ–∑–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏–ª—Å—è. –¢—ã —Å–≤–æ–±–æ–¥–µ–Ω.",
    180: "üëë **–ü–æ–ª–≥–æ–¥–∞** ‚Äî —Ç—ã –ª–µ–≥–µ–Ω–¥–∞. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º.",
    365: "üèÖ **–ì–û–î –ß–ò–°–¢–´–ú** ‚Äî —Ç—ã –¥–æ–∫–∞–∑–∞–ª, —á—Ç–æ –º–æ–∂–µ—à—å –≤—Å—ë! ‚ù§Ô∏è"
}

# ==================== –¢–ï–•–ù–ò–ö–ò –ü–û–ú–û–©–ò ====================
HELP_TECHNIQUES = [
    """üßä **–õ–µ–¥—è–Ω–æ–π –º–µ—Ç–æ–¥**
30-60 —Å–µ–∫—É–Ω–¥ –ª—å–¥–∞ –Ω–∞ –∑–∞–ø—è—Å—Ç—å—è –∏–ª–∏ –ª–∏—Ü–æ.
–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –±–ª—É–∂–¥–∞—é—â–∏–π –Ω–µ—Ä–≤ ‚Äî —Ç—è–≥–∞ –ø–∞–¥–∞–µ—Ç –∑–∞ –º–∏–Ω—É—Ç—É.""",

    """üå¨ **–î—ã—Ö–∞–Ω–∏–µ 4-7-8**
–í–¥–æ—Ö –Ω–∞ 4 ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 7 ‚Üí –≤—ã–¥–æ—Ö –Ω–∞ 8.
–ü–æ–≤—Ç–æ—Ä–∏ 4 —Ä–∞–∑–∞. –°–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª –Ω–∞ 20%.""",

    """‚è± **–í–æ–ª–Ω–æ–≤–∞—è —Ç–µ–æ—Ä–∏—è**
–¢—è–≥–∞ –∫–∞–∫ –≤–æ–ª–Ω–∞ ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ —Å–ø–∞–¥–∞–µ—Ç.
–ü—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏ 5 –º–∏–Ω—É—Ç ‚Äî –æ–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞.""",

    """üö™ **–°–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
–í—Å—Ç–∞–Ω—å –∏ –≤—ã–π–¥–∏ –≤ –¥—Ä—É–≥—É—é –∫–æ–º–Ω–∞—Ç—É.
–†–∞–∑—Ä—ã–≤–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–≤—è–∑—å ¬´–º–µ—Å—Ç–æ ‚Üí –∂–µ–ª–∞–Ω–∏–µ¬ª.""",

    """üçã **–í–∫—É—Å–æ–≤–æ–π —à–æ–∫**
–ö—É—Å–æ–∫ –ª–∏–º–æ–Ω–∞, –∏–º–±–∏—Ä—è –∏–ª–∏ –æ—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä—Ü–∞.
–†–µ–∑–∫–∏–π –≤–∫—É—Å –ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª.""",

    """‚úä **–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–±—Ä–æ—Å**
–°–æ–∂–º–∏ –∫—É–ª–∞–∫–∏ 10 —Å–µ–∫ ‚Üí –æ—Ç–ø—É—Å—Ç–∏. 5 —Ä–∞–∑.
–ú—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –ø–æ–≥–ª–æ—â–∞–µ—Ç –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ.""",

    """üíß **–†–µ—Ñ–ª–µ–∫—Å –Ω—ã—Ä—è–ª—å—â–∏–∫–∞**
–£–º–æ–π –ª–∏—Ü–æ –ª–µ–¥—è–Ω–æ–π –≤–æ–¥–æ–π 30 —Å–µ–∫—É–Ω–¥.
–ó–∞–º–µ–¥–ª—è–µ—Ç –ø—É–ª—å—Å, –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ.""",

    """üìù **–õ–æ–≥–∏—á–µ—Å–∫–∏–π –±–∞—Ä—å–µ—Ä**
–ù–∞–ø–∏—à–∏ 3 –ø—Ä–∏—á–∏–Ω—ã, –ø–æ—á–µ–º—É —Å–µ–π—á–∞—Å –Ω–µ –Ω–∞–¥–æ.
–í–∫–ª—é—á–∏ –ø—Ä–µ—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–æ—Ä—É ‚Äî —Ü–µ–Ω—Ç—Ä –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π.""",

    """üåø **–ö–∏—Å–ª–æ—Ä–æ–¥–Ω—ã–π –∫–æ–∫—Ç–µ–π–ª—å**
10 –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≥–ª—É–±–æ–∫–∏—Ö –≤–¥–æ—Ö–æ–≤.
–ö–∏—Å–ª–æ—Ä–æ–¥ —Å–Ω–∏–∂–∞–µ—Ç –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å.""",

    """üí™ **–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤**
–ü–ª–∞–Ω–∫–∞ 45-60 —Å–µ–∫—É–Ω–¥ –¥–æ –¥—Ä–æ–∂–∏.
–ü–æ–∫–∞ –º—ã—à—Ü—ã –≥–æ—Ä—è—Ç ‚Äî –º–æ–∑–≥ –∑–∞–±—ã–≤–∞–µ—Ç –ø—Ä–æ —Ç—è–≥—É.""",

    """üö∂ **–î–≤–∏–∂–µ–Ω–∏–µ –∫–∞–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ**
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ 7-10 –º–∏–Ω—É—Ç.
–í—ã—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç BDNF ‚Äî –ø—Ä–∏—Ä–æ–¥–Ω—ã–π –∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç.""",

    """üëÄ **–ú–µ—Ç–æ–¥ 5-4-3-2-1**
5 –≤–µ—â–µ–π (–≤–∏–∂—É) ‚Üí 4 (—Ç—Ä–æ–≥–∞—é) ‚Üí 3 (—Å–ª—ã—à—É) ‚Üí 2 (–∑–∞–ø–∞—Ö) ‚Üí 1 (–≤–∫—É—Å).
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ.""",

    """üöø **–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π —Å–±—Ä–æ—Å**
30 —Å–µ–∫ —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–¥—ã ‚Üí 1 –º–∏–Ω —Ç—ë–ø–ª–æ–π.
–ü–æ–≤—Ç–æ—Ä–∏ 2 —Ä–∞–∑–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.""",

    """ü•ú **–ë–∏–æ—Ö–∏–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è**
–ì–æ—Ä—Å—Ç—å –æ—Ä–µ—Ö–æ–≤ –∏–ª–∏ –∫—É—Å–æ–∫ —Å—ã—Ä–∞.
–ë–µ–ª–æ–∫ –∏ –∂–∏—Ä—ã —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—Ç —Å–∞—Ö–∞—Ä –≤ –∫—Ä–æ–≤–∏.""",

    """üéæ **–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π —à–æ–∫**
–°–æ–∂–º–∏ —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π –º—è—á–∏–∫ –¥–æ –±–æ–ª–∏ 10 —Ä–∞–∑.
–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–±—Ä–æ—Å –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞ —á–µ—Ä–µ–∑ —Ä—É–∫–∏.""",

    """ü¶∏ **–ü–æ–∑–∞ —Å–∏–ª—ã**
2 –º–∏–Ω—É—Ç—ã: –Ω–æ–≥–∏ —à–∏—Ä–æ–∫–æ, —Ä—É–∫–∏ –≤ –±–æ–∫–∏, –≥—Ä—É–¥—å –≤–ø–µ—Ä—ë–¥.
–ü–æ–≤—ã—à–∞–µ—Ç —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω, —Å–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª.""",

    """ü§î **–ú–µ—Ç–æ–¥ HALT**
–ì–æ–ª–æ–¥–µ–Ω? –ó–ª–æ–π? –û–¥–∏–Ω–æ–∫? –£—Å—Ç–∞–ª?
–ò—Å–ø—Ä–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—É–Ω–∫—Ç ‚Äî —Ç—è–≥–∞ –æ—Å–ª–∞–±–Ω–µ—Ç.""",

    """üåä **–°–µ—Ä—Ñ–∏–Ω–≥ –ø–æ —Ç—è–≥–µ**
–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ç—è–≥—É –∫–∞–∫ –æ–∫–µ–∞–Ω—Å–∫—É—é –≤–æ–ª–Ω—É.
–ù–µ –±–æ—Ä–∏—Å—å ‚Äî –Ω–∞–±–ª—é–¥–∞–π —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã. –û–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç.""",

    """üí¨ **–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —â–∏—Ç**
–ù–∞–ø–∏—à–∏ –ª—é–±–æ–º—É: ¬´–¢—è–∂–∫–æ, –±—Ä–∞—Ç. –î–µ—Ä–∂—É—Å—å¬ª.
–°—Ç—ã–¥–Ω–æ? –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.""",

    """üî• **–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω–æ–≤—ã–π —Å–±—Ä–æ—Å**
20 –æ—Ç–∂–∏–º–∞–Ω–∏–π –¥–æ –æ—Ç–∫–∞–∑–∞.
–ü–æ–∫–∞ —Ç–µ–ª–æ –≤ —à–æ–∫–µ ‚Äî –º–æ–∑–≥ –∑–∞–±—ã–≤–∞–µ—Ç –ø—Ä–æ –¥–æ—Ñ–∞–º–∏–Ω.""",

    """üéµ **–ê—É–¥–∏–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞**
3 –º–∏–Ω—É—Ç—ã –ª—é–±–∏–º–æ–π –º—É–∑—ã–∫–∏ –Ω–∞ –ø–æ–ª–Ω–æ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏.
–ó–≤—É–∫ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã –º–æ–∑–≥–∞.""",

    """üßò **–ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è**
–°—è–¥—å, –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞, –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–ª—é–¥–∞–π –∑–∞ –º—ã—Å–ª—è–º–∏.
–ù–µ –≤–æ–≤–ª–µ–∫–∞–π—Å—è. –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç —Ç—è–≥–∞ —É–π–¥—ë—Ç.""",

    """üìñ **–ö–Ω–∏–∂–Ω—ã–π —à–æ–∫**
–ü—Ä–æ—á–∏—Ç–∞–π 2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–ª–æ–∂–Ω–æ–π –∫–Ω–∏–≥–∏.
–ù–∞–≥—Ä—É–∑–∏ –º–æ–∑–≥ ‚Äî –æ–Ω –∑–∞–±—É–¥–µ—Ç –ø—Ä–æ –∂–µ–ª–∞–Ω–∏–µ."""
]

# ==================== –°–¢–ê–î–ò–ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø ====================
RECOVERY_STAGES = [
    """üî• **–î–ù–ò 1-3: –û–°–¢–†–ê–Ø –§–ê–ó–ê**

‚ö°Ô∏è **–ü–∏–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤.** –†–µ—Ü–µ–ø—Ç–æ—Ä—ã —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∏–≤—ã—á–Ω—ã–π –¥–æ—Ñ–∞–º–∏–Ω.

üìä **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –ø–æ—Ç–ª–∏–≤–æ—Å—Ç—å, –æ–∑–Ω–æ–±
‚Ä¢ –¢—Ä–µ–≤–æ–≥–∞ 8-10/10, –ø–∞–Ω–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏
‚Ä¢ –°–∏–ª—å–Ω–∞—è —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞–≥—Ä–µ—Å—Å–∏—è
‚Ä¢ –ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –∫–æ—à–º–∞—Ä—ã
‚Ä¢ –¢—è–≥–∞ –∫–∞–∂–¥—ã–µ 1-2 —á–∞—Å–∞, –æ—á–µ–Ω—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è

üí° **–≠—Ç–æ —Å–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ –≤—Ä–µ–º—è.** –ö–∞–∂–¥—ã–π —á–∞—Å ‚Äî –ø–æ–±–µ–¥–∞. –î–µ—Ä–∂–∏—Å—å.""",

    """üåß **–î–ù–ò 4-7: –ü–û–î–û–°–¢–†–ê–Ø –§–ê–ó–ê**

üìâ **–°–∏–º–ø—Ç–æ–º—ã —Å–Ω–∏–∂–∞—é—Ç—Å—è –Ω–∞ 40%.** –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∫–∞—á–µ—Ç ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

üìä **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã —Å–ª–∞–±–µ—é—Ç
‚Ä¢ –ü–æ—è–≤–ª—è—é—Ç—Å—è ¬´–æ–∫–Ω–∞ —è—Å–Ω–æ—Å—Ç–∏¬ª –Ω–∞ 1-2 —á–∞—Å–∞
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è –≤—Å—ë –µ—â—ë –Ω–∏–∑–∫–∞—è, –∞–ø–∞—Ç–∏—è
‚Ä¢ –¢—è–≥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ä–µ–∂–µ (–∫–∞–∂–¥—ã–µ 3-4 —á–∞—Å–∞)
‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–∞—á–µ–ª–∏: –æ—Ç —ç–π—Ñ–æ—Ä–∏–∏ –¥–æ –¥–µ–ø—Ä–µ—Å—Å–∏–∏

üí° **–ú–æ–∑–≥ —É—á–∏—Ç—Å—è –∂–∏—Ç—å –ø–æ-–Ω–æ–≤–æ–º—É.** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å.""",

    """üå§ **–î–ù–ò 8-14: –ê–î–ê–ü–¢–ê–¶–ò–Ø**

üîÑ **–†–µ—Ü–µ–ø—Ç–æ—Ä—ã –æ–∂–∏–≤–∞—é—Ç.** CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.

üìä **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ –°–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–ª—É–±–∂–µ, –º–µ–Ω—å—à–µ –∫–æ—à–º–∞—Ä–æ–≤
‚Ä¢ –ê–ø–ø–µ—Ç–∏—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ –¢—è–≥–∞ —Å–ª–∞–±–µ–µ—Ç, –ª–µ–≥—á–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å
‚Ä¢ –ü–æ—è–≤–ª—è–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–¥–æ—Å—Ç—å –æ—Ç –º–µ–ª–æ—á–µ–π
‚Ä¢ –ì–æ–ª–æ–≤–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Å–Ω–µ–µ, –º–µ–Ω—å—à–µ —Ç—É–º–∞–Ω–∞

üí° **–¢—ã —É–∂–µ —á—É–≤—Å—Ç–≤—É–µ—à—å —Ä–∞–∑–Ω–∏—Ü—É.** –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!""",

    """‚òÄÔ∏è **–î–ù–ò 15-28: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï**

üß† **–ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∏—â–µ.** –î–æ—Ñ–∞–º–∏–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –Ω–æ—Ä–º—É.

üìä **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
‚Ä¢ –≠–º–æ—Ü–∏–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
‚Ä¢ –†–∞–¥–æ—Å—Ç—å –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –≤–µ—â–µ–π: –µ–¥–∞, –æ–±—â–µ–Ω–∏–µ, –ø—Ä–∏—Ä–æ–¥–∞
‚Ä¢ –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ +25%: –ø–∞–º—è—Ç—å, –≤–Ω–∏–º–∞–Ω–∏–µ, —Ä–µ–∞–∫—Ü–∏—è
‚Ä¢ –¢—è–≥–∞ —Ä–µ–¥–∫–∞—è (1-2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å) –∏ —Å–ª–∞–±–∞—è

üí° **–¢—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫.** –°—Ç–∞—Ä–∞—è –∂–∏–∑–Ω—å —É—Ö–æ–¥–∏—Ç.""",

    """üåà **–î–ù–ò 29-90: –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø**

üöÄ **–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π.** –ù–æ–≤–∞—è –Ω–æ—Ä–º–∞ –∂–∏–∑–Ω–∏.

üìä **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ 90%
‚Ä¢ –î–æ—Ñ–∞–º–∏–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
‚Ä¢ –ñ–∏–∑–Ω—å –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π
‚Ä¢ –¢—è–≥–∞ –ø–æ—á—Ç–∏ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –ª–µ–≥–∫–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
‚Ä¢ –¢—ã —Å–≤–æ–±–æ–¥–µ–Ω –≤—ã–±–∏—Ä–∞—Ç—å, –∫–∞–∫ –∂–∏—Ç—å

üí° **–≠—Ç–æ —Ç–≤–æ—è –Ω–æ–≤–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.** –¢—ã –ø–æ–±–µ–¥–∏–ª."""
]

# ==================== –ö–û–ì–ù–ò–¢–ò–í–ù–´–ï –ò–°–ö–ê–ñ–ï–ù–ò–Ø ====================
COGNITIVE_DISTORTIONS = [
    """üí• **¬´–Ø –í–°–Å –ò–°–ü–û–†–¢–ò–õ¬ª**

üß† **–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è:** –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è.

üìä **–§–∞–∫—Ç:** –û–¥–∏–Ω —Å—Ä—ã–≤ ‚â† –∫–æ–Ω–µ—Ü –ø—É—Ç–∏.
–ú–æ–∑–≥ —É—á–∏—Ç—Å—è –º–µ—Ç–æ–¥–æ–º –ø—Ä–æ–± –∏ –æ—à–∏–±–æ–∫. –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏.

üìà **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ —Ä–µ–º–∏—Å—Å–∏–∏ ‚Äî 3-5 —Ä–∞–∑.

üí° **–¢—ã –Ω–µ –∏—Å–ø–æ—Ä—Ç–∏–ª. –¢—ã —É—á–∏—à—å—Å—è.** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —á–∏—Å—Ç–æ—Ç—ã ‚Äî –ø–æ–±–µ–¥–∞.""",

    """‚ö´Ô∏è‚ö™Ô∏è **¬´–ù–ò–ß–ï–ì–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢¬ª**

üß† **–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è:** –ß—ë—Ä–Ω–æ-–±–µ–ª–æ–µ –º—ã—à–ª–µ–Ω–∏–µ.

üìä **–§–∞–∫—Ç:** –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ.
–ù–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏. CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è 4-6 –Ω–µ–¥–µ–ª—å.

üîÑ **–ü—Ä–æ—Ü–µ—Å—Å:** –ú–æ–∑–≥ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –Ω–æ —Ç—ã –Ω–µ –≤–∏–¥–∏—à—å —ç—Ç–æ–≥–æ.

üí° **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚â† –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.**""",

    """üòî **¬´–Ø –°–õ–ê–ë–´–ô¬ª**

üß† **–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è:** –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è.

üìä **–§–∞–∫—Ç:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äî –±–æ–ª–µ–∑–Ω—å, –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å.
–¢—ã –±–æ—Ä–µ—à—å—Å—è —Å –Ω–µ–π—Ä–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–º –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º.

üìà **85% –ª—é–¥–µ–π** —Å—Ä—ã–≤–∞—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π.

üí° **–¢—ã –Ω–µ —Å–ª–∞–±—ã–π. –¢—ã –±–æ—Ä–µ—à—å—Å—è —Å —Ö–∏–º–∏–µ–π –º–æ–∑–≥–∞.**""",

    """üåÄ **¬´–í–°–Å –ë–ï–°–°–ú–´–°–õ–ï–ù–ù–û¬ª**

üß† **–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è:** –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ.

üìä **–§–∞–∫—Ç:** –°–º—ã—Å–ª –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 2-3 –Ω–µ–¥–µ–ª–∏.
–°–µ–π—á–∞—Å –º–æ–∑–≥ –≤ —Ä–µ–∂–∏–º–µ –≤—ã–∂–∏–≤–∞–Ω–∏—è. –î–æ—Ñ–∞–º–∏–Ω–∞ –º–∞–ª–æ ‚Äî –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä—ã–º.

üåÖ **–≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ,** –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.

üí° **–ß—É–≤—Å—Ç–≤–æ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî —Å–∏–º–ø—Ç–æ–º –ª–æ–º–∫–∏, –∞ –Ω–µ –ø—Ä–∞–≤–¥–∞ –æ –∂–∏–∑–Ω–∏.**""",

    """üë• **¬´–£ –î–†–£–ì–ò–• –ü–û–õ–£–ß–ê–ï–¢–°–Ø¬ª**

üß† **–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ.

üìä **–§–∞–∫—Ç:** –£ –≤—Å–µ—Ö —Å–≤–æ–∏ —Å—Ä–æ–∫–∏.
–¢—ã –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –Ω–µ 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –Ω–µ–≥–æ.

üéØ **–ö–∞–∂–¥—ã–π –ø—É—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω.**

üí° **–°—Ä–∞–≤–Ω–∏–≤–∞–π —Å–µ–±—è —Ç–æ–ª—å–∫–æ —Å —Å–æ–±–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–º.**""",

    """üîÅ **¬´–û–î–ò–ù –†–ê–ó –ù–ï –°–ß–ò–¢–ê–ï–¢–°–Ø¬ª**

üß† **–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è:** –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è.

üìä **–§–∞–∫—Ç:** –ö–∞–∂–¥—ã–π ¬´–æ–¥–∏–Ω —Ä–∞–∑¬ª —Å—á–∏—Ç–∞–µ—Ç—Å—è.
–ú–æ–∑–≥ –Ω–µ –¥–µ–ª–∏—Ç –Ω–∞ ¬´—Ä–∞–∑—ã¬ª. –î–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π –≤—Å–ø–ª–µ—Å–∫ = —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–≤—è–∑–∏.

üìâ **–û–¥–∏–Ω —Ä–∞–∑ = –æ—Ç–∫–∞—Ç –Ω–∞–∑–∞–¥ –Ω–∞ –Ω–µ–¥–µ–ª—é.**

üí° **–ï—Å–ª–∏ ¬´–Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è¬ª ‚Äî –∑–∞—á–µ–º —Ç–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è?**"""
]

# ==================== –¢–†–ò–ì–ì–ï–†–´ –ò –†–ï–ê–ö–¶–ò–ò ====================
TRIGGERS_INFO = [
    """ü§Ø **–¢–†–ò–ì–ì–ï–†: –ú–´–°–õ–¨ ¬´–•–û–ß–£¬ª**

üí≠ **–ß—Ç–æ —ç—Ç–æ:** –ú—ã—Å–ª—å ‚â† –∫–æ–º–∞–Ω–¥–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—é.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –ù–∞–±–ª—é–¥–∞–π –∑–∞ –º—ã—Å–ª—å—é –∫–∞–∫ –∑–∞ –æ–±–ª–∞–∫–æ–º
‚Ä¢ –ù–µ —Å–ø–æ—Ä—å —Å –Ω–µ–π, –Ω–µ —É–±–µ–∂–¥–∞–π —Å–µ–±—è
‚Ä¢ –ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ—Ç—å: ¬´–û, —ç—Ç–æ —Å–Ω–æ–≤–∞ –º—ã—Å–ª—å¬ª
‚Ä¢ –ß–µ—Ä–µ–∑ 3-7 –º–∏–Ω—É—Ç –æ–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞

üí° **–¢—ã –Ω–µ –æ–±—è–∑–∞–Ω —Å–ª—É—à–∞—Ç—å—Å—è –∫–∞–∂–¥–æ–π –º—ã—Å–ª–∏.**""",

    """üò° **–¢–†–ò–ì–ì–ï–†: –°–ò–õ–¨–ù–ê–Ø –≠–ú–û–¶–ò–Ø**

üíî **–ß—Ç–æ —ç—Ç–æ:** –ó–ª–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, —Ç—Ä–µ–≤–æ–≥–∞ –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –∂–µ–ª–∞–Ω–∏–µ —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –ù–∞–∑–æ–≤–∏ —ç–º–æ—Ü–∏—é –≤—Å–ª—É—Ö: ¬´–≠—Ç–æ –∑–ª–æ—Å—Ç—å¬ª
‚Ä¢ –≠–º–æ—Ü–∏–∏ –∫–∞–∫ –≤–æ–ª–Ω—ã ‚Äî –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –∏ —Å–ø–∞–¥–∞—é—Ç
‚Ä¢ –ù–µ –Ω–∞–¥–æ —É–±–µ–≥–∞—Ç—å –æ—Ç —ç–º–æ—Ü–∏–∏ –≤ –≤–µ—â–µ—Å—Ç–≤–æ
‚Ä¢ –ü—Ä–æ–∂–∏—Ç—å —ç–º–æ—Ü–∏—é = —Å—Ç–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ

üí° **–≠—Ç–æ –ø—Ä–æ–π–¥—ë—Ç. –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç.**""",

    """üò¥ **–¢–†–ò–ì–ì–ï–†: –°–ö–£–ö–ê / –ë–ï–ó–î–ï–õ–¨–ï**

ü§∑ **–ß—Ç–æ —ç—Ç–æ:** –ú–æ–∑–≥ –ø—É—Ç–∞–µ—Ç —Å–∫—É–∫—É —Å –∂–µ–ª–∞–Ω–∏–µ–º —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –°–∫—É–∫–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç—è–≥–∞, —ç—Ç–æ —Å–∏–≥–Ω–∞–ª ¬´–∑–∞–π–º–∏—Å—å —á–µ–º-—Ç–æ¬ª
‚Ä¢ 10 –º–∏–Ω—É—Ç –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ –ü—Ä–æ–≥—É–ª–∫–∞, —É–±–æ—Ä–∫–∞, –∑–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É
‚Ä¢ –ù–æ–≤—ã–π –¥–æ—Ñ–∞–º–∏–Ω –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞

üí° **–°–∫—É–∫–∞ –ª–µ—á–∏—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ–º, –∞ –Ω–µ –≤–µ—â–µ—Å—Ç–≤–æ–º.**""",

    """üò∞ **–¢–†–ò–ì–ì–ï–†: –°–¢–†–ï–°–° / –¢–†–ï–í–û–ì–ê**

‚ö†Ô∏è **–ß—Ç–æ —ç—Ç–æ:** –¢—Ä–µ–≤–æ–≥–∞ –≥–æ–≤–æ—Ä–∏—Ç: ¬´–£–±–µ–≥–∏!¬ª –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞–µ—Ç: ¬´–ó–Ω–∞—é –∫–∞–∫¬ª.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –¢—Ä–µ–≤–æ–≥–∞ –ø—Ä–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç
‚Ä¢ –î—ã—Ö–∞–Ω–∏–µ 4-7-8: –≤–¥–æ—Ö 4, –∑–∞–¥–µ—Ä–∂–∫–∞ 7, –≤—ã–¥–æ—Ö 8
‚Ä¢ –•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ –Ω–∞ –ª–∏—Ü–æ
‚Ä¢ –°–∫–∞–∂–∏ –≤—Å–ª—É—Ö: ¬´–Ø –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ–π—á–∞—Å¬ª

üí° **–¢—Ä–µ–≤–æ–≥–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è. –°—Ä—ã–≤ ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π.**""",

    """üë• **–¢–†–ò–ì–ì–ï–†: –ö–û–ú–ü–ê–ù–ò–Ø / –û–ö–†–£–ñ–ï–ù–ò–ï**

üèô **–ß—Ç–æ —ç—Ç–æ:** –°–∞–º—ã–π —Å–∏–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä. –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ + –ø—Ä–∏–≤—ã—á–Ω–∞—è –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –ò–∑–±–µ–≥–∞–π –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π
‚Ä¢ –ï—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏–∑–±–µ–∂–∞—Ç—å ‚Äî –∑–∞—Ä–∞–Ω–µ–µ —Ä–µ–ø–µ—Ç–∏—Ä—É–π –æ—Ç–∫–∞–∑
‚Ä¢ ¬´–ó–∞–≤—è–∑–∞–ª¬ª, ¬´–ù–µ —Ö–æ—á—É¬ª, ¬´–ú–Ω–µ –Ω–µ–ª—å–∑—è¬ª
‚Ä¢ –í—ã—Ö–æ–¥–∏ –∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏

üí° **–¢–≤–æ—è —Ç—Ä–µ–∑–≤–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —á—É–∂–æ–≥–æ –º–Ω–µ–Ω–∏—è.**""",

    """üçΩ **–¢–†–ò–ì–ì–ï–†: –ì–û–õ–û–î / –ñ–ê–ñ–î–ê**

ü•§ **–ß—Ç–æ —ç—Ç–æ:** –ú–æ–∑–≥ –ø—É—Ç–∞–µ—Ç —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å —Å —Ç—è–≥–æ–π.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –í—ã–ø–µ–π —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã
‚Ä¢ –°—ä–µ—à—å —á—Ç–æ-—Ç–æ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–µ
‚Ä¢ –ü–æ–¥–æ–∂–¥–∏ 20 –º–∏–Ω—É—Ç
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å: ¬´–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç—è–≥–∞ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≥–æ–ª–æ–¥?¬ª

üí° **–¢–µ–ª–æ –ø—Ä–æ—Å–∏—Ç –µ–¥—É, –∞ –Ω–µ –≤–µ—â–µ—Å—Ç–≤–æ.**""",

    """üéâ **–¢–†–ò–ì–ì–ï–†: –ü–†–ê–ó–î–ù–ò–ö / –£–°–ü–ï–•**

üèÜ **–ß—Ç–æ —ç—Ç–æ:** –ú–æ–∑–≥ —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ä–∞–¥–æ—Å—Ç—å —Å –Ω–∞–≥—Ä–∞–¥–æ–π –≤ –≤–∏–¥–µ –≤–µ—â–µ—Å—Ç–≤–∞.

üõ° **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**
‚Ä¢ –ü—Ä–∏–∑–Ω–∞–π —É—Å–ø–µ—Ö: ¬´–Ø —ç—Ç–æ –∑–∞—Å–ª—É–∂–∏–ª¬ª
‚Ä¢ –ù–∞–π–¥–∏ –∑–¥–æ—Ä–æ–≤—É—é –Ω–∞–≥—Ä–∞–¥—É: –≤–∫—É—Å–Ω–∞—è –µ–¥–∞, –ø–æ–¥–∞—Ä–æ–∫ —Å–µ–±–µ
‚Ä¢ –ü–æ–¥–µ–ª–∏—Å—å —Ä–∞–¥–æ—Å—Ç—å—é —Å –¥—Ä—É–≥–∏–º–∏
‚Ä¢ –ó–∞–ø–æ–º–Ω–∏: —É—Å–ø–µ—Ö –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π —É—Å–ø–µ—Ö

üí° **–¢—ã –¥–æ—Å—Ç–æ–∏–Ω –ø—Ä–∞–∑–¥–Ω–∏–∫–∞, –∞ –Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.**"""
]

# ==================== –ù–ê–£–ß–ù–´–ï –§–ê–ö–¢–´ ====================
SCIENCE_FACTS = [
    """üß¨ **CB1-–†–ï–¶–ï–ü–¢–û–†–´**

üî¨ **–ß—Ç–æ —ç—Ç–æ:** –ö–∞–Ω–Ω–∞–±–∏–Ω–æ–∏–¥–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤ –º–æ–∑–≥–µ. –¢–ì–ö –∏—Ö –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏ –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ –î–µ–Ω—å 7: +28% –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
‚Ä¢ –î–µ–Ω—å 14: +50% 
‚Ä¢ –î–µ–Ω—å 28: +80%
‚Ä¢ –î–µ–Ω—å 42: 100% –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

üí° **–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ ‚Äî —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.**""",

    """‚ö°Ô∏è **–î–û–§–ê–ú–ò–ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê**

üß† **–ß—Ç–æ —ç—Ç–æ:** –¢–ì–ö –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω –≤ 2-3 —Ä–∞–∑–∞. –ú–æ–∑–≥ —Å–Ω–∏–∂–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ –ù–µ–¥–µ–ª—è 1: –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤—Å—ë –µ—â—ë –Ω–∏–∑–∫–æ–µ
‚Ä¢ –ù–µ–¥–µ–ª—è 2: –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
‚Ä¢ –ú–µ—Å—è—Ü 1: –¥–æ—Ñ–∞–º–∏–Ω –ø–æ—á—Ç–∏ –≤ –Ω–æ—Ä–º–µ
‚Ä¢ –ú–µ—Å—è—Ü 2-4: –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

üí° **–ú–æ–∑–≥ —É—á–∏—Ç—Å—è —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è —Å–∞–º, –±–µ–∑ —Ö–∏–º–∏–∏.**""",

    """üò¥ **–°–û–ù –ò –ú–ï–õ–ê–¢–û–ù–ò–ù**

üåô **–ß—Ç–æ —ç—Ç–æ:** –¢–ì–ö –Ω–∞—Ä—É—à–∞–µ—Ç REM-—Ñ–∞–∑—É —Å–Ω–∞. –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ –î–Ω–∏ 1-7: –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –∫–æ—à–º–∞—Ä—ã
‚Ä¢ –î–Ω–∏ 8-14: —Å–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–ª—É–±–∂–µ
‚Ä¢ –î–µ–Ω—å 21: REM-—Ñ–∞–∑–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü 1: –≥–ª—É–±–æ–∫–∏–π –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–π —Å–æ–Ω

üí° **–ì–ª—É–±–æ–∫–∏–π —Å–æ–Ω = –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∑–≥–∞.**""",

    """üéØ **–ü–ê–ú–Ø–¢–¨ –ò –ì–ò–ü–ü–û–ö–ê–ú–ü**

üß© **–ß—Ç–æ —ç—Ç–æ:** –¢–ì–ö –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç –≥–∏–ø–ø–æ–∫–∞–º–ø ‚Äî —Ü–µ–Ω—Ç—Ä –ø–∞–º—è—Ç–∏ –∏ –æ–±—É—á–µ–Ω–∏—è.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ 2 –Ω–µ–¥–µ–ª–∏: –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å —É–ª—É—á—à–∞–µ—Ç—Å—è
‚Ä¢ 1 –º–µ—Å—è—Ü: –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ +25%
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚Ä¢ 6-12 –º–µ—Å—è—Ü–µ–≤: –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤—ã–π

üí° **–¢—ã —Å—Ç–∞–Ω–µ—à—å —É–º–Ω–µ–µ. –ë—É–∫–≤–∞–ª—å–Ω–æ.**""",

    """üìä **–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–†–´–í–û–í**

üìà **–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã:**
‚Ä¢ 85% —Å—Ä—ã–≤–∞—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π
‚Ä¢ 60% ‚Äî –≤ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫: 3-5 —Ä–∞–∑
‚Ä¢ –ü–æ—Å–ª–µ 90 –¥–Ω–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—Ä—ã–≤–∞ –ø–∞–¥–∞–µ—Ç –¥–æ 15%

üí° **–ï—Å–ª–∏ —Å–æ—Ä–≤–∞–ª—Å—è ‚Äî —Ç—ã –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è.**""",

    """üéÆ **–ü–†–ï–§–†–û–ù–¢–ê–õ–¨–ù–ê–Ø –ö–û–†–ê**

üß≠ **–ß—Ç–æ —ç—Ç–æ:** –¶–µ–Ω—Ç—Ä –≤–æ–ª–∏ –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π. –¢–ì–ö –µ—ë —É–≥–Ω–µ—Ç–∞–µ—Ç.

üìà **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ –ù–µ–¥–µ–ª—è 1: –Ω–æ–ª—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏, –∞–ø–∞—Ç–∏—è
‚Ä¢ –ù–µ–¥–µ–ª—è 2: –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤—Å–ø–ª–µ—Å–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ú–µ—Å—è—Ü 1: –≤–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü 3: —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è

üí° **–ê–ø–∞—Ç–∏—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è. –≠—Ç–æ –Ω–µ —Ç—ã ‚Äî —ç—Ç–æ —Ö–∏–º–∏—è.**""",

    """üå± **BDNF (–§–∞–∫—Ç–æ—Ä —Ä–æ—Å—Ç–∞ –º–æ–∑–≥–∞)**

üß™ **–ß—Ç–æ —ç—Ç–æ:** –ë–µ–ª–æ–∫ —Ä–æ—Å—Ç–∞ –º–æ–∑–≥–∞. –¢–ì–ö —Å–Ω–∏–∂–∞–µ—Ç –µ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ –î–Ω–∏ 1-3: BDNF –Ω–∞ –º–∏–Ω–∏–º—É–º–µ
‚Ä¢ –ù–µ–¥–µ–ª—è 1-2: –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏
‚Ä¢ –ú–µ—Å—è—Ü 1: —É—Ä–æ–≤–µ–Ω—å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü 3: –º–æ–∑–≥ —Å—Ç—Ä–æ–∏—Ç –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏

üí° **–≠—Ç–æ—Ç –±–µ–ª–æ–∫ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —É–º–Ω–µ–µ –∏ —É—Å—Ç–æ–π—á–∏–≤–µ–µ.**""",

    """‚ù§Ô∏è **–°–ï–†–î–ï–ß–ù–û-–°–û–°–£–î–ò–°–¢–ê–Ø –°–ò–°–¢–ï–ú–ê**

ü´Ä **–ß—Ç–æ —ç—Ç–æ:** –¢–ì–ö —É—Å–∫–æ—Ä—è–µ—Ç –ø—É–ª—å—Å –Ω–∞ 20-50%, –ø–æ–≤—ã—à–∞–µ—Ç –¥–∞–≤–ª–µ–Ω–∏–µ.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ 72 —á–∞—Å–∞: –ø—É–ª—å—Å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è
‚Ä¢ –ù–µ–¥–µ–ª—è: –¥–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
‚Ä¢ –ú–µ—Å—è—Ü: —Å–µ—Ä–¥–µ—á–Ω—ã–π —Ä–∏—Ç–º –∑–¥–æ—Ä–æ–≤—ã–π
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

üí° **–¢–≤–æ—ë —Å–µ—Ä–¥—Ü–µ —Å–∫–∞–∂–µ—Ç —Å–ø–∞—Å–∏–±–æ.**""",

    """üòä **–ú–û–¢–ò–í–ê–¶–ò–Ø –ò –ê–ù–ì–ï–î–û–ù–ò–Ø**

üåà **–ß—Ç–æ —ç—Ç–æ:** –ê–Ω–≥–µ–¥–æ–Ω–∏—è ‚Äî –Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ.

üìà **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
‚Ä¢ –î–Ω–∏ 1-7: –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä—ã–º, –±–µ–∑—Ä–∞–¥–æ—Å—Ç–Ω—ã–º
‚Ä¢ –ù–µ–¥–µ–ª—è 2: –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏
‚Ä¢ –ú–µ—Å—è—Ü 1: –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
‚Ä¢ 2-3 –º–µ—Å—è—Ü–∞: –∂–∏–∑–Ω—å —Å–Ω–æ–≤–∞ —è—Ä–∫–∞—è, –∫—Ä–∞—Å–æ—á–Ω–∞—è

üí° **–≠—Ç–æ –Ω–µ –¥–µ–ø—Ä–µ—Å—Å–∏—è. –≠—Ç–æ –º–æ–∑–≥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è.**""",

    """üîÑ **–ù–ï–ô–†–û–ü–õ–ê–°–¢–ò–ß–ù–û–°–¢–¨**

üß† **–ß—Ç–æ —ç—Ç–æ:** –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ –º–µ–Ω—è—Ç—å—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.

üìä **–§–∞–∫—Ç—ã:**
‚Ä¢ –í –ª—é–±–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ –º–æ–∑–≥ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
‚Ä¢ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø—É—Ç–∏
‚Ä¢ –ú–æ–∑–≥ –ø–æ–º–Ω–∏—Ç —Å—Ç–∞—Ä—ã–µ —Å–≤—è–∑–∏ 6-12 –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –ù–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∑–∞ 21-90 –¥–Ω–µ–π

üí° **–¢–≤–æ–π –º–æ–∑–≥ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —Ç—ã –¥—É–º–∞–µ—à—å.**""",

    """‚öñÔ∏è **–ì–û–†–ú–û–ù–ê–õ–¨–ù–´–ô –ë–ê–õ–ê–ù–°**

üß¨ **–ß—Ç–æ —ç—Ç–æ:** –ö–∞–Ω–Ω–∞–±–∏—Å –Ω–∞—Ä—É—à–∞–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É –≥–æ—Ä–º–æ–Ω–æ–≤.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ –¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω: 2-4 –Ω–µ–¥–µ–ª–∏ –¥–æ –Ω–æ—Ä–º—ã
‚Ä¢ –ö–æ—Ä—Ç–∏–∑–æ–ª (—Å—Ç—Ä–µ—Å—Å): 3-6 –Ω–µ–¥–µ–ª—å
‚Ä¢ –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω (—Å–æ–Ω): 2-3 –Ω–µ–¥–µ–ª–∏
‚Ä¢ –°–µ—Ä–æ—Ç–æ–Ω–∏–Ω (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ): 4-8 –Ω–µ–¥–µ–ª—å

üí° **–ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é.**""",

    """üéì **–ö–û–ì–ù–ò–¢–ò–í–ù–´–ï –§–£–ù–ö–¶–ò–ò**

üßÆ **–ß—Ç–æ —É–ª—É—á—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫–∞–∑–∞:**

üìä **–ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏:**
‚Ä¢ –í–Ω–∏–º–∞–Ω–∏–µ +15%
‚Ä¢ –ü–∞–º—è—Ç—å +20%
‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏ +10%

üìà **–ß–µ—Ä–µ–∑ –º–µ—Å—è—Ü:**
‚Ä¢ –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –∫–∞–∫ —Ä–∞–Ω—å—à–µ
‚Ä¢ –Ø—Å–Ω–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è

üí° **–ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –±–µ–∑ –¢–ì–ö.**""",

    """ü§ù **–°–û–¶–ò–ê–õ–¨–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï**

üë• **–ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ –æ–±—â–µ–Ω–∏–∏:**
‚Ä¢ 1 –Ω–µ–¥–µ–ª—è: –º–µ–Ω—å—à–µ —Ç—Ä–µ–≤–æ–≥–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—è—Ö
‚Ä¢ 2 –Ω–µ–¥–µ–ª–∏: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏—Å–∫—Ä–µ–Ω–Ω–∏–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ª—é–¥—è–º
‚Ä¢ 1 –º–µ—Å—è—Ü: –æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ö–∏–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∏–º—É–ª—è—Ü–∏–∏
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: –Ω–∞—Å—Ç–æ—è—â–∏–µ —ç–º–æ—Ü–∏–∏, –Ω–∞—Å—Ç–æ—è—â–∏–µ —Å–≤—è–∑–∏

üí° **–¢—ã —Å–Ω–æ–≤–∞ —É—á–∏—à—å—Å—è –æ–±—â–∞—Ç—å—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É.**""",

    """üí™ **–§–ò–ó–ò–ß–ï–°–ö–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï**

üèÉ **–¢–µ–ª–æ –±–µ–∑ –¢–ì–ö:**
‚Ä¢ –õ–µ–≥–∫–∏–µ: –æ—á–∏—â–∞—é—Ç—Å—è –∑–∞ 3-9 –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: +40% —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü
‚Ä¢ –ê–ø–ø–µ—Ç–∏—Ç: –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∑–∞ 2-3 –Ω–µ–¥–µ–ª–∏
‚Ä¢ –ò–º–º—É–Ω–∏—Ç–µ—Ç: —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ 4-6 –Ω–µ–¥–µ–ª—å
‚Ä¢ –ö–æ–∂–∞: —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∏—â–µ —á–µ—Ä–µ–∑ 2-4 –Ω–µ–¥–µ–ª–∏

üí° **–¢–µ–ª–æ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.**""",

    """üí∞ **–≠–ö–û–ù–û–ú–ò–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ò**

üí∏ **–¶–∏—Ñ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –∑–∞–¥—É–º–∞—Ç—å—Å—è:**

üìä **–°—Ä–µ–¥–Ω–∏–µ —Ç—Ä–∞—Ç—ã –≤ –º–µ—Å—è—Ü:**
‚Ä¢ –¢—Ä–∞–≤–∞: 10,000-30,000 ‚ÇΩ
‚Ä¢ –í–µ–π–ø—ã/–∫–∞—Ä—Ç—Ä–∏–¥–∂–∏: 15,000-50,000 ‚ÇΩ
‚Ä¢ –ü–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫: 20,000-50,000 ‚ÇΩ
‚Ä¢ –ó–¥–æ—Ä–æ–≤—å–µ: –±–µ—Å—Ü–µ–Ω–Ω–æ

üí° **–ó–∞ –≥–æ–¥ —á–∏—Å—Ç–æ—Ç—ã –º–æ–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–∞ –º–∞—à–∏–Ω—É, –æ—Ç–ø—É—Å–∫ –∏–ª–∏ –æ–±—É—á–µ–Ω–∏–µ.**""",

    """üß™ **–¢–û–õ–ï–†–ê–ù–¢–ù–û–°–¢–¨ –ò –°–ï–ù–°–ò–¢–ò–ó–ê–¶–ò–Ø**

üìâ **–ß—Ç–æ —ç—Ç–æ:** –ß–µ–º –±–æ–ª—å—à–µ —É–ø–æ—Ç—Ä–µ–±–ª—è–µ—à—å ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ —ç—Ñ—Ñ–µ–∫—Ç–∞.

üìà **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
‚Ä¢ 1 –º–µ—Å—è—Ü: —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è –Ω–∞ 50%
‚Ä¢ 3 –º–µ—Å—è—Ü–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ 6 –º–µ—Å—è—Ü–µ–≤: –º–æ–∑–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é ¬´–∑–∞–±—ã–≤–∞–µ—Ç¬ª —Å—Ç–∞—Ä—ã–µ –¥–æ–∑—ã

üí° **–ß–µ–º –¥–æ–ª—å—à–µ —á–∏—Å—Ç–æ—Ç–∞ ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ —Ö–æ—á–µ—Ç—Å—è.**"""
]

# ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
_user_data_cache: Optional[Dict[str, Any]] = None
_data_lock = asyncio.Lock()

# ==================== –ö–õ–ê–í–ò–ê–¢–£–†–´ ====================
def get_main_keyboard() -> ReplyKeyboardMarkup:
    """–ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞"""
    return ReplyKeyboardMarkup([
        [KeyboardButton("‚úä –î–µ—Ä–∂—É—Å—å"), KeyboardButton("üòî –¢—è–∂–µ–ª–æ")],
        [KeyboardButton("üëã –¢—ã —Ç—É—Ç?"), KeyboardButton("üìä –ú–æ–∏ –¥–Ω–∏")],
        [KeyboardButton("‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ"), KeyboardButton("‚è∏ –ü–∞—É–∑–∞")]
    ], resize_keyboard=True, input_field_placeholder="–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ...")

def get_start_keyboard() -> ReplyKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞"""
    return ReplyKeyboardMarkup([[KeyboardButton("üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å")]], 
                              resize_keyboard=True)

def get_heavy_keyboard() -> ReplyKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤"""
    return ReplyKeyboardMarkup([
        [KeyboardButton("üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ"), KeyboardButton("üß† –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π")],
        [KeyboardButton("üíî –°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç"), KeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥")]
    ], resize_keyboard=True)

def get_info_keyboard() -> ReplyKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    return ReplyKeyboardMarkup([
        [KeyboardButton("üìÖ –°—Ç–∞–¥–∏–∏ –æ—Ç–∫–∞–∑–∞"), KeyboardButton("‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã")],
        [KeyboardButton("ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è"), KeyboardButton("üî¨ –ù–∞—É–∫–∞")],
        [KeyboardButton("‚Ü©Ô∏è –ù–∞–∑–∞–¥")]
    ], resize_keyboard=True)

# ==================== –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò ====================
def load_data() -> Dict[str, Any]:
    """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    global _user_data_cache
    if _user_data_cache is not None:
        return _user_data_cache
    
    with FileLock(LOCK_FILE):
        if not os.path.exists(DATA_FILE):
            _user_data_cache = {}
            logger.info("–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª –¥–∞–Ω–Ω—ã—Ö")
            return _user_data_cache
        
        try:
            with open(DATA_FILE, "r", encoding="utf-8") as f:
                data = json.load(f)
                _user_data_cache = data
                logger.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ {len(data)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
                return data
        except json.JSONDecodeError:
            logger.warning("–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤—Ä–µ–∂–¥—ë–Ω, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π")
            _user_data_cache = {}
            return {}
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
            _user_data_cache = {}
            return {}

async def save_data() -> None:
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    global _user_data_cache
    if _user_data_cache is None:
        return
    
    async with _data_lock:
        with FileLock(LOCK_FILE):
            try:
                with open(DATA_FILE, "w", encoding="utf-8") as f:
                    json.dump(_user_data_cache, f, ensure_ascii=False, indent=2)
                logger.debug("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã")
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {e}")

def get_user(user_id: int) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    data = load_data()
    uid = str(user_id)
    
    if uid not in data:
        data[uid] = {
            "start_date": None,
            "active": False,
            "best_streak": 0,
            "hold_count_today": 0,
            "last_hold_date": None,
            "last_hold_time": None,
            "last_stage_index": 0,
            "used_tips": [],
            "used_triggers": [],
            "used_distortions": [],
            "used_facts": [],
            "created_at": datetime.now(MOSCOW_TZ).isoformat()
        }
        asyncio.create_task(save_data())
        logger.info(f"–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_id}")
    
    return data[uid]

async def save_user(user_id: int, updates: Optional[Dict[str, Any]] = None) -> None:
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    data = load_data()
    uid = str(user_id)
    
    if updates:
        if uid not in data:
            data[uid] = {}
        data[uid].update(updates)
    
    await save_data()

def get_active_users() -> List[int]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    data = load_data()
    return [int(uid) for uid, user in data.items() if user.get("active", False)]

def get_current_time() -> datetime:
    """–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π —Ç–∞–π–º–∑–æ–Ω–µ"""
    return datetime.now(MOSCOW_TZ)

def get_current_date() -> date:
    """–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞"""
    return get_current_time().date()

def get_days_since_start(user_id: int) -> int:
    """–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Å –Ω–∞—á–∞–ª–∞ –ø—É—Ç–∏"""
    user = get_user(user_id)
    if not user["start_date"]:
        return 0
    
    try:
        start = date.fromisoformat(user["start_date"])
        current = get_current_date()
        days = (current - start).days
        return max(days, 0)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –¥–Ω–µ–π –¥–ª—è {user_id}: {e}")
        return 0

def format_days(days: int) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω–µ–π"""
    if 11 <= days % 100 <= 19:
        return f"{days} –¥–Ω–µ–π"
    if days % 10 == 1:
        return f"{days} –¥–µ–Ω—å"
    if days % 10 in [2, 3, 4]:
        return f"{days} –¥–Ω—è"
    return f"{days} –¥–Ω–µ–π"

def get_next_exercise(user_id: int) -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è"""
    user = get_user(user_id)
    used = user.get("used_tips", [])
    
    if len(used) >= len(HELP_TECHNIQUES):
        used = []
    
    available = [i for i in range(len(HELP_TECHNIQUES)) if i not in used]
    if not available:
        available = list(range(len(HELP_TECHNIQUES)))
        used = []
    
    choice = random.choice(available)
    used.append(choice)
    
    asyncio.create_task(save_user(user_id, {"used_tips": used}))
    
    return HELP_TECHNIQUES[choice]

def get_next_stage(user_id: int) -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–∞–¥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"""
    user = get_user(user_id)
    last_index = user.get("last_stage_index", 0)
    
    stage_text = RECOVERY_STAGES[last_index]
    next_index = (last_index + 1) % len(RECOVERY_STAGES)
    
    if next_index == 0:
        stage_text += "\n\n‚ú® **–≠—Ç–æ –±—ã–ª–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–¥–∏—è.** –ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞."
    else:
        stage_num = next_index + 1
        stage_text += f"\n\nüìå **–°—Ç–∞–¥–∏—è {stage_num}/{len(RECOVERY_STAGES)}.** –ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π."
    
    asyncio.create_task(save_user(user_id, {"last_stage_index": next_index}))
    
    return stage_text

def get_next_item(user_id: int, items_list: List[str], used_key: str) -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞"""
    user = get_user(user_id)
    used = user.get(used_key, [])
    
    if len(used) >= len(items_list):
        used = []
    
    available = [i for i in range(len(items_list)) if i not in used]
    if not available:
        available = list(range(len(items_list)))
        used = []
    
    choice = random.choice(available)
    used.append(choice)
    
    asyncio.create_task(save_user(user_id, {used_key: used}))
    
    return items_list[choice]

async def reset_streak(user_id: int) -> int:
    """–°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞ –¥–Ω–µ–π"""
    current = get_days_since_start(user_id)
    user = get_user(user_id)
    
    if current > user.get("best_streak", 0):
        await save_user(user_id, {"best_streak": current})
    
    await save_user(user_id, {
        "start_date": get_current_date().isoformat(),
        "last_stage_index": 0,
        "hold_count_today": 0,
        "last_hold_date": None,
        "last_hold_time": None,
        "used_tips": [],
        "used_triggers": [],
        "used_distortions": [],
        "used_facts": []
    })
    
    logger.info(f"–°–±—Ä–æ—à–µ–Ω —Å—á—ë—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}. –ë—ã–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç: {current} –¥–Ω–µ–π")
    
    return current

# ==================== –ó–ê–î–ê–ù–ò–Ø –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
def remove_user_jobs(chat_id: int, job_queue) -> int:
    """–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    removed = 0
    for name in [f"morning_{chat_id}", f"evening_{chat_id}", f"night_{chat_id}"]:
        jobs = job_queue.get_jobs_by_name(name)
        for job in jobs:
            job.schedule_removal()
            removed += 1
    logger.info(f"–£–¥–∞–ª–µ–Ω–æ {removed} –∑–∞–¥–∞—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {chat_id}")
    return removed

def schedule_jobs(chat_id: int, job_queue) -> None:
    """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    existing_jobs = []
    for name in [f"morning_{chat_id}", f"evening_{chat_id}", f"night_{chat_id}"]:
        if job_queue.get_jobs_by_name(name):
            existing_jobs.extend(job_queue.get_jobs_by_name(name))
    
    if existing_jobs:
        remove_user_jobs(chat_id, job_queue)
    
    # –£—Ç—Ä–µ–Ω–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (9:00)
    job_queue.run_daily(
        send_morning,
        time(9, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"morning_{chat_id}",
        job_kwargs={'misfire_grace_time': 300}
    )
    
    # –í–µ—á–µ—Ä–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (18:00)
    job_queue.run_daily(
        send_evening,
        time(18, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"evening_{chat_id}",
        job_kwargs={'misfire_grace_time': 300}
    )
    
    # –ù–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (23:00)
    job_queue.run_daily(
        send_night,
        time(23, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"night_{chat_id}",
        job_kwargs={'misfire_grace_time': 300}
    )
    
    logger.info(f"–°–æ–∑–¥–∞–Ω—ã –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {chat_id}")

async def send_morning(context: ContextTypes.DEFAULT_TYPE) -> None:
    """–£—Ç—Ä–µ–Ω–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"""
    chat_id = context.job.data['chat_id']
    user = get_user(chat_id)
    
    if not user.get("active"):
        return
    
    days = get_days_since_start(chat_id)
    msg = random.choice(MORNING_MESSAGES)
    
    if days in MILESTONES:
        msg += f"\n\n{MILESTONES[days]}"
    elif days > 0:
        msg += f"\n\nüìÖ **–î–µ–Ω—å {days}** ‚Äî —Ç—ã –º–æ–ª–æ–¥–µ—Ü!"
    
    try:
        await context.bot.send_message(chat_id, msg, reply_markup=get_main_keyboard())
        logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Ç—Ä–µ–Ω–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {chat_id}")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è {chat_id}: {e}")

async def send_evening(context: ContextTypes.DEFAULT_TYPE) -> None:
    """–í–µ—á–µ—Ä–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"""
    chat_id = context.job.data['chat_id']
    user = get_user(chat_id)
    
    if not user.get("active"):
        return
    
    try:
        await context.bot.send_message(
            chat_id,
            random.choice(EVENING_MESSAGES),
            reply_markup=get_main_keyboard()
        )
        logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–µ—á–µ—Ä–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {chat_id}")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ—á–µ—Ä–Ω–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è {chat_id}: {e}")

async def send_night(context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ù–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"""
    chat_id = context.job.data['chat_id']
    user = get_user(chat_id)
    
    if not user.get("active"):
        return
    
    days = get_days_since_start(chat_id)
    msg = random.choice(NIGHT_MESSAGES)
    
    if days > 0:
        msg += f"\n\nüìä –°–µ–≥–æ–¥–Ω—è —Ç—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª—Å—è –≤–µ—Å—å –¥–µ–Ω—å. –≠—Ç–æ {format_days(days)} —Ç–≤–æ–µ–π —Å–∏–ª—ã."
    
    try:
        await context.bot.send_message(
            chat_id,
            msg,
            reply_markup=get_main_keyboard()
        )
        logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {chat_id}")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ—á–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è {chat_id}: {e}")

# ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î ====================
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    chat_id = update.effective_chat.id
    user = get_user(chat_id)
    
    was_active = user.get("active", False)
    
    await save_user(chat_id, {
        "active": True,
        "start_date": get_current_date().isoformat(),
        "last_stage_index": 0,
        "used_tips": [],
        "used_triggers": [],
        "used_distortions": [],
        "used_facts": [],
        "hold_count_today": 0,
        "last_hold_date": None,
        "last_hold_time": None,
        "last_active": datetime.now(MOSCOW_TZ).isoformat()
    })
    
    if not was_active:
        schedule_jobs(chat_id, context.application.job_queue)
        logger.info(f"–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {chat_id}")
    
    days = get_days_since_start(chat_id)
    
    if days == 0:
        msg = (
            "üëã **–ü—Ä–∏–≤–µ—Ç, –±—Ä–∞—Ç!**\n\n"
            "–Ø –±—É–¥—É —Å —Ç–æ–±–æ–π –Ω–∞ —ç—Ç–æ–º –ø—É—Ç–∏. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –º–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–±–µ–¥–∞.\n\n"
            "üì± **–ß—Ç–æ —è –¥–µ–ª–∞—é:**\n"
            "‚Ä¢ –ü–∏—à—É —É—Ç—Ä–æ–º, –≤–µ—á–µ—Ä–æ–º –∏ –Ω–æ—á—å—é\n"
            "‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞—é: —Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å—Ç–æ–∏—Ç\n"
            "‚Ä¢ –ü–æ–º–æ–≥–∞—é, –∫–æ–≥–¥–∞ —Ç—è–∂–µ–ª–æ\n\n"
            "üí™ **–ö–Ω–æ–ø–∫–∞ ¬´–î–µ—Ä–∂—É—Å—å¬ª:**\n"
            "–ö–æ–≥–¥–∞ —Å–æ–≤—Å–µ–º –Ω–µ–≤–º–æ–≥–æ—Ç—É ‚Äî –Ω–∞–∂–º–∏ –µ—ë.\n"
            "–í—Å–µ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ –ø–æ–ª—É—á–∞—Ç –ø—É—à –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n"
            "–ú–æ–∂–Ω–æ 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å, –µ—Å–ª–∏ –æ—á–µ–Ω—å –Ω—É–∂–Ω–æ.\n\n"
            "üöÄ **–î–∞–≤–∞–π –Ω–∞—á–Ω—ë–º. –¢—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –¥—É–º–∞–µ—à—å.**"
        )
    else:
        msg = (
            f"üëã **–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!**\n\n"
            f"–¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è **{format_days(days)}**. –≠—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ!\n\n"
            "–Ø –ø—Ä–æ–¥–æ–ª–∂–∞—é –±—ã—Ç—å —Ä—è–¥–æ–º. –ü–æ–º–Ω–∏:\n"
            "‚Ä¢ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —á–∏—Å—Ç–æ—Ç—ã ‚Äî –ø–æ–±–µ–¥–∞\n"
            "‚Ä¢ –¢—è–≥–∞ –ø—Ä–æ–π–¥—ë—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –Ω–µ—Ç\n"
            "‚Ä¢ –¢—ã –Ω–µ –æ–¥–∏–Ω, –º—ã –≤—Å–µ –∑–¥–µ—Å—å\n\n"
            "üí™ **–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—É—Ç—å.**"
        )
    
    await update.message.reply_text(msg, reply_markup=get_main_keyboard())

async def stop_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /stop"""
    chat_id = update.effective_chat.id
    
    await save_user(chat_id, {"active": False})
    removed = remove_user_jobs(chat_id, context.application.job_queue)
    
    msg = (
        "‚è∏ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.**\n\n"
        "–Ø –ø–µ—Ä–µ—Å—Ç–∞–Ω—É –ø–∏—Å–∞—Ç—å —Ç–µ–±–µ —É—Ç—Ä–æ–º, –≤–µ—á–µ—Ä–æ–º –∏ –Ω–æ—á—å—é.\n"
        "–ù–æ –∫–Ω–æ–ø–∫–∞ ¬´–î–µ—Ä–∂—É—Å—å¬ª –≤—Å—ë –µ—â—ë –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.\n\n"
        "–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ –≤–µ—Ä–Ω—É—Ç—å—Å—è ‚Äî –Ω–∞–∂–º–∏ üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å\n\n"
        "üí™ **–î–µ—Ä–∂–∏—Å—å, –±—Ä–∞—Ç. –Ø –≤–µ—Ä—é –≤ —Ç–µ–±—è.**"
    )
    
    await update.message.reply_text(msg, reply_markup=get_start_keyboard())

async def handle_hold(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–î–µ—Ä–∂—É—Å—å¬ª"""
    chat_id = update.effective_chat.id
    user = get_user(chat_id)
    
    if not user.get("active"):
        await update.message.reply_text(
            "‚è∏ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã.**\n\n"
            "–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∏—Ö.",
            reply_markup=get_start_keyboard()
        )
        return
    
    current_time = get_current_time()
    today_str = current_time.date().isoformat()
    
    # –°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞, –µ—Å–ª–∏ –Ω–æ–≤—ã–π –¥–µ–Ω—å
    if user.get("last_hold_date") != today_str:
        await save_user(chat_id, {
            "hold_count_today": 0,
            "last_hold_date": today_str
        })
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞ (30 –º–∏–Ω—É—Ç)
    if user.get("last_hold_time"):
        try:
            last_time_str = user["last_hold_time"]
            
            try:
                if 'T' in last_time_str:
                    last_time = datetime.fromisoformat(last_time_str)
                else:
                    last_time = datetime.strptime(last_time_str, "%Y-%m-%d %H:%M:%S").replace(tzinfo=MOSCOW_TZ)
            except ValueError:
                last_time = current_time - timedelta(minutes=31)
            
            if last_time.tzinfo is None:
                last_time = last_time.replace(tzinfo=MOSCOW_TZ)
            
            diff = (current_time - last_time).total_seconds()
            if diff < 1800:  # 30 –º–∏–Ω—É—Ç
                mins = int((1800 - diff) / 60) + 1
                await update.message.reply_text(
                    f"‚è≥ **–ü–æ–¥–æ–∂–¥–∏ –µ—â—ë {mins} {'–º–∏–Ω—É—Ç—É' if mins == 1 else '–º–∏–Ω—É—Ç'}.**\n\n"
                    f"–¢—ã —É–∂–µ –Ω–∞–∂–∏–º–∞–ª –Ω–µ–¥–∞–≤–Ω–æ. –î–∞–π –≤—Ä–µ–º–µ–Ω–∏.\n"
                    f"–¢—è–≥–∞ –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏.",
                    reply_markup=get_main_keyboard()
                )
                return
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–∞—É—Ç–∞: {e}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (5 —Ä–∞–∑ –≤ –¥–µ–Ω—å)
    if user.get("hold_count_today", 0) >= 5:
        await update.message.reply_text(
            "üéØ **–°–µ–≥–æ–¥–Ω—è —É–∂–µ 5 —Ä–∞–∑.**\n\n"
            "–¢—ã –±–æ–ª—å—à–æ–π –º–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –¥–µ—Ä–∂–∏—à—å—Å—è!\n"
            "–ó–∞–≤—Ç—Ä–∞ —Å–Ω–æ–≤–∞ —Å–º–æ–∂–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç—Ç–æ–π –∫–Ω–æ–ø–∫–æ–π.\n\n"
            "üí™ **–¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è. –Ø –≤–µ—Ä—é.**",
            reply_markup=get_main_keyboard()
        )
        return
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è
    await save_user(chat_id, {
        "last_hold_time": current_time.isoformat(),
        "last_hold_date": today_str,
        "hold_count_today": user.get("hold_count_today", 0) + 1
    })
    
    # –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await update.message.reply_text(
        random.choice(HOLD_RESPONSES),
        reply_markup=get_main_keyboard()
    )
    
    # –†–∞—Å—Å—ã–ª–∫–∞ –ø—É—à–∞ –¥—Ä—É–≥–∏–º –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    active_users = get_active_users()
    push_count = 0
    
    for uid in active_users:
        if uid != chat_id:
            try:
                await context.bot.send_message(uid, "‚úä **–ö—Ç–æ-—Ç–æ –¥–µ—Ä–∂–∏—Ç—Å—è. –¢—ã –Ω–µ –æ–¥–∏–Ω.**")
                push_count += 1
                await asyncio.sleep(0.05)  # –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–∏–º–∏—Ç–æ–≤ Telegram
            except Exception as e:
                error_str = str(e).lower()
                if "blocked" in error_str or "chat not found" in error_str or "forbidden" in error_str:
                    await save_user(uid, {"active": False})
                    remove_user_jobs(uid, context.application.job_queue)
                    logger.info(f"–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω {uid}: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞")
    
    logger.info(f"–ü—É—à –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω {push_count} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä: {chat_id}")

async def handle_heavy(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–¢—è–∂–µ–ª–æ¬ª"""
    msg = (
        "üòî **–ü–æ–Ω–∏–º–∞—é, –±—ã–≤–∞–µ—Ç —Ç—è–∂–µ–ª–æ.**\n\n"
        "–í—ã–±–µ—Ä–∏, —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:\n\n"
        "üí™ **–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ** ‚Äî –±—ã—Å—Ç—Ä–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è —Å–Ω—è—Ç–∏—è —Ç—è–≥–∏\n"
        "üß† **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** ‚Äî –Ω–∞—É—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏ –º–µ—Ç–æ–¥—ã\n"
        "üíî **–°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç** ‚Äî –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à—ë–ª —Å—Ä—ã–≤\n\n"
        "üí° **–ü–æ–º–Ω–∏:** –¢—è–≥–∞ –ø—Ä–æ–π–¥—ë—Ç. –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç."
    )
    await update.message.reply_text(msg, reply_markup=get_heavy_keyboard())

async def handle_exercise(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ¬ª"""
    tip = get_next_exercise(update.effective_chat.id)
    msg = f"üí™ **–í–æ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è —Ç–µ–±—è:**\n\n{tip}\n\nüí° **–ü—Ä–∏–º–µ–Ω–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.**"
    await update.message.reply_text(msg, reply_markup=get_heavy_keyboard())

async def handle_info_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π¬ª"""
    msg = (
        "üß† **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π**\n\n"
        "–ó–¥–µ—Å—å —Å–æ–±—Ä–∞–Ω–∞ –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–±–µ–¥—ã:\n\n"
        "üìÖ **–°—Ç–∞–¥–∏–∏ –æ—Ç–∫–∞–∑–∞** ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Ç–æ–±–æ–π\n"
        "‚ö†Ô∏è **–¢—Ä–∏–≥–≥–µ—Ä—ã** ‚Äî —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—è–≥—É –∏ –∫–∞–∫ –±–æ—Ä–æ—Ç—å—Å—è\n"
        "ü§Ø **–ò—Å–∫–∞–∂–µ–Ω–∏—è** ‚Äî –æ—à–∏–±–∫–∏ –º—ã—à–ª–µ–Ω–∏—è –ø—Ä–∏ –ª–æ–º–∫–µ\n"
        "üî¨ **–ù–∞—É–∫–∞** ‚Äî —Ñ–∞–∫—Ç—ã –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–∑–≥–∞\n\n"
        "üí° **–ó–Ω–∞–Ω–∏–µ ‚Äî —Å–∏–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π –µ—ë.**"
    )
    await update.message.reply_text(msg, reply_markup=get_info_keyboard())

async def handle_stages(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–°—Ç–∞–¥–∏–∏ –æ—Ç–∫–∞–∑–∞¬ª"""
    chat_id = update.effective_chat.id
    stage_text = get_next_stage(chat_id)
    await update.message.reply_text(stage_text, reply_markup=get_info_keyboard())

async def handle_triggers(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–¢—Ä–∏–≥–≥–µ—Ä—ã¬ª"""
    trigger = get_next_item(update.effective_chat.id, TRIGGERS_INFO, "used_triggers")
    await update.message.reply_text(trigger, reply_markup=get_info_keyboard())

async def handle_distortions(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–ò—Å–∫–∞–∂–µ–Ω–∏—è¬ª"""
    distortion = get_next_item(update.effective_chat.id, COGNITIVE_DISTORTIONS, "used_distortions")
    await update.message.reply_text(distortion, reply_markup=get_info_keyboard())

async def handle_facts(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–ù–∞—É–∫–∞¬ª"""
    fact = get_next_item(update.effective_chat.id, SCIENCE_FACTS, "used_facts")
    await update.message.reply_text(fact, reply_markup=get_info_keyboard())

async def handle_breakdown(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç¬ª"""
    chat_id = update.effective_chat.id
    days_lost = await reset_streak(chat_id)
    
    msg = (
        f"üîÑ **–°—á—ë—Ç—á–∏–∫ —Å–±—Ä–æ—à–µ–Ω.**\n\n"
        f"–¢—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª—Å—è **{format_days(days_lost)}**.\n\n"
        "üí° **–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å:**\n"
        "‚Ä¢ –≠—Ç–æ –Ω–µ –ø—Ä–æ–≤–∞–ª, –∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏\n"
        "‚Ä¢ –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏\n"
        "‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –ø–æ–±–µ–¥—ã ‚Äî 3-5 —Ä–∞–∑\n\n"
        "üåü **–¢—ã –Ω–∞ —à–∞–≥ –±–ª–∏–∂–µ –∫ –ø–æ–±–µ–¥–µ.**\n"
        "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ —Å—Ä—ã–≤—É, –∏ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Å—è –ª—É—á—à–µ.\n\n"
        "–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞ ‚Äî –Ω–∞–∂–º–∏ üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å"
    )
    
    await update.message.reply_text(msg, reply_markup=get_start_keyboard())

async def handle_days(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–ú–æ–∏ –¥–Ω–∏¬ª"""
    chat_id = update.effective_chat.id
    user = get_user(chat_id)
    days = get_days_since_start(chat_id)
    best = user.get("best_streak", 0)
    
    if days == 0:
        msg = (
            "üéØ **–¢—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å.**\n\n"
            "–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –∏ —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π.\n"
            "–ù–æ –∏–º–µ–Ω–Ω–æ —Å –Ω–µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—É—Ç—å –∫ —Å–≤–æ–±–æ–¥–µ.\n\n"
            "üí™ **–ù–∞–∂–º–∏ üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å –∏ –¥–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ.**"
        )
    else:
        msg = (
            f"üìä **–¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è {format_days(days)}!**\n\n"
            f"üéñ **–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è:** {days} {('–¥–µ–Ω—å' if days % 10 == 1 and days % 100 != 11 else '–¥–Ω—è' if days % 10 in [2,3,4] and days % 100 not in [12,13,14] else '–¥–Ω–µ–π')}\n"
        )
        
        if best > days:
            msg += f"üèÜ **–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** {format_days(best)}\n\n"
            msg += "üí° **–¢—ã —É–∂–µ –±—ã–ª –Ω–∞ {best} –¥–Ω–µ. –ó–Ω–∞—á–∏—Ç, —Å–º–æ–∂–µ—à—å –∏ –¥–∞–ª—å—à–µ!**"
        elif best > 0 and best == days:
            msg += f"üî• **–≠—Ç–æ —Ç–≤–æ–π –Ω–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!**\n\n"
            msg += "üåü **–¢—ã –ø–æ–±–∏–ª —Å–≤–æ–π –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!**"
        else:
            msg += "\nüí™ **–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤–∞—è –ø–æ–±–µ–¥–∞. –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!**"
    
    await update.message.reply_text(msg, reply_markup=get_main_keyboard())
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ—Ö–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞
    if days in MILESTONES:
        await update.message.reply_text(MILESTONES[days], reply_markup=get_main_keyboard())

async def handle_are_you_here(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–¢—ã —Ç—É—Ç?¬ª"""
    await asyncio.sleep(random.randint(2, 6))
    await update.message.reply_text(
        random.choice(TU_TUT_FIRST),
        reply_markup=get_main_keyboard()
    )
    await asyncio.sleep(random.randint(2, 5))
    await update.message.reply_text(
        random.choice(TU_TUT_SECOND),
        reply_markup=get_main_keyboard()
    )

async def handle_thank_you(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–°–ø–∞—Å–∏–±–æ¬ª"""
    msg = (
        "‚ù§Ô∏è **–°–ø–∞—Å–∏–±–æ —Ç–µ–±–µ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.**\n\n"
        "–¢–≤–æ—è –±–æ—Ä—å–±–∞ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –¥—Ä—É–≥–∏—Ö.\n"
        "–¢–≤–æ—è —Å–∏–ª–∞ –¥–∞—ë—Ç –Ω–∞–¥–µ–∂–¥—É.\n\n"
        "üíù **–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:**\n"
        "–°–±–µ—Ä: `2202 2084 3481 5313`\n\n"
        "–õ—é–±–∞—è —Å—É–º–º–∞ –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –±–æ—Ç–∞ –¥–∞–ª—å—à–µ,\n"
        "–¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–æ–º–æ–≥–∞—Ç—å –±–æ–ª—å—à–µ–º—É\n"
        "–∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ª—é–¥–µ–π.\n\n"
        "üí™ **–ù–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–π –¥–µ—Ä–∂–∞—Ç—å—Å—è.**\n"
        "–¢—ã –¥–µ–ª–∞–µ—à—å –±–æ–ª—å—à–æ–µ –¥–µ–ª–æ. –î–ª—è —Å–µ–±—è. –î–ª—è –≤—Å–µ—Ö –Ω–∞—Å."
    )
    await update.message.reply_text(msg, reply_markup=get_main_keyboard())

async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ ¬´–ù–∞–∑–∞–¥¬ª"""
    await update.message.reply_text("üëå **–û–∫–µ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è.**", reply_markup=get_main_keyboard())

async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    text = update.message.text
    
    if text == "üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å":
        await start_command(update, context)
    else:
        # –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –Ω–∞ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        await update.message.reply_text(
            "ü§î **–ù–µ –ø–æ–Ω—è–ª —Ç–µ–±—è.**\n\n"
            "–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ –º–Ω–æ–π.\n"
            "–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å —Ç–µ–±–µ –Ω–∞ —ç—Ç–æ–º –ø—É—Ç–∏.",
            reply_markup=get_main_keyboard()
        )

# ==================== –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ó–ê–î–ê–ß ====================
async def restore_jobs(application) -> None:
    """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞"""
    active_users = get_active_users()
    logger.info(f"üöÄ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è {len(active_users)} –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    
    existing_jobs = list(application.job_queue.jobs())
    
    for user_id in active_users:
        user_has_jobs = False
        for job in existing_jobs:
            if (hasattr(job, 'name') and str(user_id) in job.name) or \
               (job.data and job.data.get('chat_id') == user_id):
                user_has_jobs = True
                break
        
        if not user_has_jobs:
            schedule_jobs(user_id, application.job_queue)
            logger.info(f"‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
    
    logger.info(f"üéØ –í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á: {len(application.job_queue.jobs())}")

# ==================== –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ====================
def main() -> None:
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    application = Application.builder().token(TOKEN).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("stop", stop_command))
    application.add_handler(CommandHandler("help", start_command))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫
    application.add_handler(MessageHandler(filters.Regex("^‚úä –î–µ—Ä–∂—É—Å—å$"), handle_hold))
    application.add_handler(MessageHandler(filters.Regex("^üìä –ú–æ–∏ –¥–Ω–∏$"), handle_days))
    application.add_handler(MessageHandler(filters.Regex("^üòî –¢—è–∂–µ–ª–æ$"), handle_heavy))
    application.add_handler(MessageHandler(filters.Regex("^üëã –¢—ã —Ç—É—Ç\?$"), handle_are_you_here))
    application.add_handler(MessageHandler(filters.Regex("^‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ$"), handle_thank_you))
    application.add_handler(MessageHandler(filters.Regex("^‚è∏ –ü–∞—É–∑–∞$"), stop_command))
    
    application.add_handler(MessageHandler(filters.Regex("^üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ$"), handle_exercise))
    application.add_handler(MessageHandler(filters.Regex("^üß† –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π$"), handle_info_menu))
    application.add_handler(MessageHandler(filters.Regex("^üíî –°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç$"), handle_breakdown))
    
    application.add_handler(MessageHandler(filters.Regex("^üìÖ –°—Ç–∞–¥–∏–∏ –æ—Ç–∫–∞–∑–∞$"), handle_stages))
    application.add_handler(MessageHandler(filters.Regex("^‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã$"), handle_triggers))
    application.add_handler(MessageHandler(filters.Regex("^ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è$"), handle_distortions))
    application.add_handler(MessageHandler(filters.Regex("^üî¨ –ù–∞—É–∫–∞$"), handle_facts))
    
    application.add_handler(MessageHandler(filters.Regex("^‚Ü©Ô∏è –ù–∞–∑–∞–¥$"), handle_back))
    application.add_handler(MessageHandler(filters.Regex("^üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å$"), handle_text))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))
    
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    application.post_init = restore_jobs
    
    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    logger.info("=" * 50)
    logger.info("üöÄ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    logger.info(f"üìä –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(get_active_users())}")
    logger.info(f"üíæ –§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö: {DATA_FILE}")
    logger.info("=" * 50)
    
    application.run_polling(
        allowed_updates=Update.ALL_TYPES,
        drop_pending_updates=True,
        close_loop=False
    )

if __name__ == "__main__":
    main()

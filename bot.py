import logging
import random
import json
import os
import asyncio
from datetime import datetime, time, date, timedelta
from filelock import FileLock
from typing import Dict, Any, Optional
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
from telegram.constants import ParseMode
import pytz

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ====================
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO,
    handlers=[
        logging.FileHandler("bot.log", encoding='utf-8'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
TOKEN = os.getenv("BOT_TOKEN")
if not TOKEN:
    raise ValueError("‚ùå BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")

DATA_FILE = "user_data.json"
LOCK_FILE = DATA_FILE + ".lock"
MOSCOW_TZ = pytz.timezone('Europe/Moscow')

# ==================== –°–û–û–ë–©–ï–ù–ò–Ø ====================
MORNING_MESSAGES = [
    "üåÖ <b>–ü—Ä–∏–≤–µ—Ç</b>. –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥–µ–º, —Ö–æ—Ä–æ—à–æ?",
    "üåÖ <b>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ</b>. –ù–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåÖ <b>–ü—Ä–∏–≤–µ—Ç</b>. –î–µ—Ä–∂–∏–º—Å—è —Å–µ–≥–æ–¥–Ω—è?",
    "üåÖ <b>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ</b>. –°–µ–≥–æ–¥–Ω—è –º–Ω–æ–≥–æ –¥–µ–ª, –Ω–∞–≤–µ—Ä–Ω–æ–µ –Ω–µ—Ç.",
    "üåÖ <b>–ü—Ä–∏–≤–µ—Ç</b>. –°–µ–≥–æ–¥–Ω—è –æ–±–æ–π–¥—ë–º—Å—è –±–µ–∑ —ç—Ç–æ–≥–æ.",
    "üåÖ <b>–£—Ç—Ä–æ</b>. –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏–º.",
    "üåÖ <b>–ü—Ä–∏–≤–µ—Ç</b>. –°–µ–≥–æ–¥–Ω—è –ø–æ–∂–∞–ª—É–π —á—Ç–æ –Ω–µ —Å—Ç–æ–∏—Ç.",
    "üåÖ <b>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ</b>. –ù–∞–ø–∏—à—É –µ—â—ë —Å–µ–≥–æ–¥–Ω—è.",
    "üåÖ <b>–ü—Ä–∏–≤–µ—Ç</b>. –°–µ–≥–æ–¥–Ω—è —Ç–æ—á–Ω–æ –Ω–µ –Ω–∞–¥–æ.",
    "üåÖ <b>–î–æ–±—Ä–æ–µ!</b> –î–∞–≤–∞–π —Å–µ–≥–æ–¥–Ω—è –±–µ–∑ —ç—Ç–æ–≥–æ."
]

EVENING_MESSAGES = [
    "üåÜ <b>–ù–µ —Å–µ–≥–æ–¥–Ω—è</b>. –î–µ—Ä–∂–∏—Å—å.",
    "üåÜ <b>–Ø —Ç—É—Ç</b>. –î–∞–≤–∞–π –Ω–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåÜ <b>–ü—Ä–∏–≤–µ—Ç</b>. –°–µ–≥–æ–¥–Ω—è –¥–µ—Ä–∂–∏–º—Å—è, –ø–æ–º–Ω–∏—à—å?",
    "üåÜ <b>–î–µ—Ä–∂–∏—Å—å</b>. –°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç.",
    "üåÜ <b>–ï—â—ë —á—É—Ç—å-—á—É—Ç—å</b>. –ù–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåÜ <b>–Ø —Å —Ç–æ–±–æ–π</b>. –°–µ–≥–æ–¥–Ω—è —Ç–æ—á–Ω–æ –Ω–µ—Ç.",
    "üåÜ <b>–ü—Ä–∏–≤–µ—Ç</b>. –î–∞–≤–∞–π –æ–±–æ–π–¥—ë–º—Å—è.",
    "üåÜ <b>–ú—ã –∂–µ —Ä–µ—à–∏–ª–∏</b> ‚Äî –Ω–µ —Å–µ–≥–æ–¥–Ω—è.",
    "üåÜ <b>–î–µ—Ä–∂–∏—Å—å —Ç–∞–º</b>. –°–µ–≥–æ–¥–Ω—è –º–∏–º–æ.",
    "üåÜ <b>–ü—Ä–∏–≤–µ—Ç</b>. –°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–ø—É—Å—Ç–∏–º."
]

NIGHT_MESSAGES = [
    "üåô <b>–¢—ã –º–æ–ª–æ–¥–µ—Ü</b>. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "üåô <b>–ö—Ä–∞—Å–∞–≤—á–∏–∫</b>. –°–ø–æ–∫–æ–π–Ω–æ–π.",
    "üåô <b>–î–µ—Ä–∂–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è</b>. –£–≤–∞–∂–∞—é.",
    "üåô <b>–°–µ–≥–æ–¥–Ω—è —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å</b>. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "üåô <b>–ú–æ–ª–æ–¥–µ—Ü, –¥–µ—Ä–∂–∏—à—å—Å—è</b>.",
    "üåô <b>–ï—â—ë –æ–¥–∏–Ω –¥–µ–Ω—å –ø–æ–∑–∞–¥–∏</b>.",
    "üåô <b>–¢—ã —Å–∏–ª—å–Ω—ã–π</b>. –î–æ –∑–∞–≤—Ç—Ä–∞.",
    "üåô <b>–°–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–∏–ª–æ—Å—å</b>. –û—Ç–¥—ã—Ö–∞–π.",
    "üåô <b>–°–ø—Ä–∞–≤–∏–ª—Å—è</b>. –£–≤–∞–∂–µ–Ω–∏–µ.",
    "üåô <b>–î–µ—Ä–∂–∞–ª—Å—è –≤–µ—Å—å –¥–µ–Ω—å</b>. –ö—Ä–∞—Å–∞–≤–∞."
]

TU_TUT_FIRST = [
    "ü§ñ <b>–¢—É—Ç.</b>", "ü§ñ <b>–ü—Ä–∏–≤–µ—Ç.</b>", "ü§ñ <b>–ê –∫—É–¥–∞ —è –¥–µ–Ω—É—Å—å?</b>",
    "ü§ñ <b>–ó–¥–µ—Å—å.</b>", "ü§ñ <b>–¢—É—Ç, –∫–∞–∫ –≤—Å–µ–≥–¥–∞.</b>",
    "ü§ñ <b>–î–∞, –¥–∞.</b>", "ü§ñ <b>–ö–∞–∫ –¥–µ–ª–∞?</b>", "ü§ñ <b>–ê–≥–∞.</b>",
    "ü§ñ <b>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π.</b>", "ü§ñ <b>–¢—É—Ç, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π.</b>"
]

TU_TUT_SECOND = [
    "üí™ <b>–î–µ—Ä–∂–∏–º—Å—è.</b>", "üí™ <b>–Ø —Å —Ç–æ–±–æ–π.</b>", "üí™ <b>–í—Å—ë –ø–æ –ø–ª–∞–Ω—É.</b>",
    "üí™ <b>–ù–µ —Ö–æ—á—É —Å–µ–≥–æ–¥–Ω—è.</b>", "üí™ <b>–°–µ–≥–æ–¥–Ω—è –Ω–µ –±—É–¥—É.</b>",
    "üí™ <b>–Ø —Ä—è–¥–æ–º.</b>", "üí™ <b>–î–µ—Ä–∂–∏—Å—å.</b>", "üí™ <b>–í—Å—ë –±—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ.</b>",
    "üí™ <b>–Ø –≤ –¥–µ–ª–µ.</b>", "üí™ <b>–ü–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.</b>"
]

HOLD_RESPONSES = [
    "‚úÖ <b>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.</b> ‚úä",
    "‚úÖ <b>–ú–æ–ª–æ–¥–µ—Ü.</b> ‚úä",
    "‚úÖ <b>–ü–æ–Ω—è–ª.</b> ‚úä",
    "‚úÖ <b>–¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å.</b> ‚úä"
]

# ==================== –í–ï–•–ò ====================
MILESTONES = {
    3: "üéØ <b>–¢—Ä–∏ –¥–Ω—è —É–∂–µ</b>. –°–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ –ø–æ–∑–∞–¥–∏.",
    7: "üéØ <b>–ù–µ–¥–µ–ª—è</b>. –†–µ—Ü–µ–ø—Ç–æ—Ä—ã –Ω–∞—á–∏–Ω–∞—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è.",
    14: "üéØ <b>–î–≤–µ –Ω–µ–¥–µ–ª–∏!</b> –°–æ–Ω –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è, –≥–æ–ª–æ–≤–∞ —è—Å–Ω–µ–µ.",
    21: "üéØ <b>–¢—Ä–∏ –Ω–µ–¥–µ–ª–∏</b>. –¢—ã —É–∂–µ –ø–æ—á—Ç–∏ –Ω–µ –¥—É–º–∞–µ—à—å –æ–± —ç—Ç–æ–º.",
    30: "üéØ <b>–ú–µ—Å—è—Ü –±–µ–∑ —ç—Ç–æ–≥–æ</b>. –ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–Ω–æ–≤–æ–º—É.",
    60: "üéØ <b>–î–≤–∞ –º–µ—Å—è—Ü–∞</b> ‚Äî —Ç—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫.",
    90: "üéØ <b>–¢—Ä–∏ –º–µ—Å—è—Ü–∞</b>. –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ. –¢—ã –º–æ–ª–æ–¥–µ—Ü.",
    180: "üéØ <b>–ü–æ–ª–≥–æ–¥–∞</b>. –õ–µ–≥–µ–Ω–¥–∞.",
    365: "üéØ <b>–ì–û–î –ß–ò–°–¢–´–ú</b>. –¢—ã —Å–¥–µ–ª–∞–ª —ç—Ç–æ ‚ù§Ô∏è"
}

# ==================== –¢–ï–•–ù–ò–ö–ò –ü–û–ú–û–©–ò ====================
HELP_TECHNIQUES = [
    """üßä <b>–ú–µ—Ç–æ–¥ –ª—å–¥–∞</b>
<i>–õ—ë–¥ –Ω–∞ –∑–∞–ø—è—Å—Ç—å—è 30-60 —Å–µ–∫—É–Ω–¥.</i>
–•–æ–ª–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –±–ª—É–∂–¥–∞—é—â–∏–π –Ω–µ—Ä–≤ ‚Äî —Ç—è–≥–∞ –ø–∞–¥–∞–µ—Ç –∑–∞ –º–∏–Ω—É—Ç—É.""",
    
    """üå¨Ô∏è <b>–î—ã—Ö–∞–Ω–∏–µ 4-7-8</b>
<i>–í–¥–æ—Ö –Ω–∞ 4 ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 7 ‚Üí –≤—ã–¥–æ—Ö –Ω–∞ 8. 4 —Ü–∏–∫–ª–∞.</i>
–°–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª, —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.""",
    
    """‚è±Ô∏è <b>–ü—Ä–∞–≤–∏–ª–æ 5 –º–∏–Ω—É—Ç</b>
<i>–ü–æ—Å—Ç–∞–≤—å —Ç–∞–π–º–µ—Ä: ¬´–ü—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏ 5 –º–∏–Ω—É—Ç¬ª.</i>
–¢—è–≥–∞ –∫–∞–∫ –≤–æ–ª–Ω–∞ ‚Äî –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞ –∑–∞ 3-7 –º–∏–Ω—É—Ç.""",
    
    """üö™ <b>–°–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞</b>
<i>–í—Å—Ç–∞–Ω—å –∏ –≤—ã–π–¥–∏ –≤ –¥—Ä—É–≥—É—é –∫–æ–º–Ω–∞—Ç—É.</i>
–†–∞–∑—Ä—ã–≤–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–≤—è–∑—å —Å –ø—Ä–∏–≤—ã—á–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–æ–π.""",
    
    """üçã <b>–í–∫—É—Å–æ–≤–æ–π —à–æ–∫</b>
<i>–ö—É—Å–æ–∫ –ª–∏–º–æ–Ω–∞, –∏–º–±–∏—Ä—è –∏–ª–∏ –æ—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä—Ü–∞.</i>
–†–µ–∑–∫–∏–π –≤–∫—É—Å –ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª.""",
    
    """‚úä <b>–ú—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ</b>
<i>–°–æ–∂–º–∏ –∫—É–ª–∞–∫–∏ 10 —Å–µ–∫—É–Ω–¥ ‚Üí –æ—Ç–ø—É—Å—Ç–∏. –ü–æ–≤—Ç–æ—Ä–∏ 5 —Ä–∞–∑.</i>
–§–∏–∑–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç —Å–Ω—è—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ.""",
    
    """üíß <b>–•–æ–ª–æ–¥–Ω—ã–π —à–æ–∫</b>
<i>–£–º–æ–π –ª–∏—Ü–æ –ª–µ–¥—è–Ω–æ–π –≤–æ–¥–æ–π 30 —Å–µ–∫—É–Ω–¥.</i>
–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —É—Å–ø–æ–∫–æ–µ–Ω–∏–µ.""",
    
    """üìù <b>–ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è</b>
<i>–ù–∞–ø–∏—à–∏ 3 –ø—Ä–∏—á–∏–Ω—ã, –ø–æ—á–µ–º—É —Å–µ–π—á–∞—Å –Ω–µ –Ω–∞–¥–æ.</i>
–ü–æ–º–æ–≥–∞–µ—Ç –º–æ–∑–≥—É –≤—Å–ø–æ–º–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É, –∞ –Ω–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å —ç–º–æ—Ü–∏—è–º.""",
    
    """üå¨Ô∏è <b>–ö–∏—Å–ª–æ—Ä–æ–¥–Ω—ã–π —É–¥–∞—Ä</b>
<i>10 –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≥–ª—É–±–æ–∫–∏—Ö –≤–¥–æ—Ö–æ–≤ –∂–∏–≤–æ—Ç–æ–º.</i>
–ö–∏—Å–ª–æ—Ä–æ–¥ —Å–Ω–∏–∂–∞–µ—Ç –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å.""",
    
    """üí™ <b>–§–∏–∑–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞</b>
<i>–ü–ª–∞–Ω–∫–∞ 45-60 —Å–µ–∫—É–Ω–¥ –∏–ª–∏ 20 –æ—Ç–∂–∏–º–∞–Ω–∏–π.</i>
–ü–æ–∫–∞ –º—ã—à—Ü—ã –≥–æ—Ä—è—Ç ‚Äî –º–æ–∑–≥ –Ω–µ –¥—É–º–∞–µ—Ç –æ —Ç—è–≥–µ.""",
    
    """üö∂ <b>–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≥—É–ª–∫–∞</b>
<i>7-10 –º–∏–Ω—É—Ç –±—ã—Å—Ç—Ä–æ–π —Ö–æ–¥—å–±—ã.</i>
–î–≤–∏–∂–µ–Ω–∏–µ –≤—ã—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç BDNF ‚Äî –ø—Ä–∏—Ä–æ–¥–Ω—ã–π –∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç.""",
    
    """üëÄ <b>–ú–µ—Ç–æ–¥ 5-4-3-2-1</b>
<i>–ù–∞–∑–æ–≤–∏: 5 –≤–µ—â–µ–π (–≤–∏–∂—É), 4 (—Ç—Ä–æ–≥–∞—é), 3 (—Å–ª—ã—à—É), 2 (–∑–∞–ø–∞—Ö), 1 (–≤–∫—É—Å).</i>
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç.""",
    
    """üöø <b>–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π –¥—É—à</b>
<i>30 —Å–µ–∫ —Ö–æ–ª–æ–¥–Ω–æ–π ‚Üí 1 –º–∏–Ω —Ç—ë–ø–ª–æ–π. –ü–æ–≤—Ç–æ—Ä–∏ 2 —Ä–∞–∑–∞.</i>
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.""",
    
    """ü•ú <b>–ü–∏—â–µ–≤–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è</b>
<i>–ì–æ—Ä—Å—Ç—å –æ—Ä–µ—Ö–æ–≤, —Å—ã—Ä–∞ –∏–ª–∏ –∫—É—Å–æ—á–µ–∫ –º—è—Å–∞.</i>
–ë–µ–ª–æ–∫ –∏ –∂–∏—Ä—ã —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É—é—Ç —Å–∞—Ö–∞—Ä –≤ –∫—Ä–æ–≤–∏.""",
    
    """üéæ <b>–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π —à–æ–∫</b>
<i>–°–æ–∂–º–∏ —Ç–µ–Ω–Ω–∏—Å–Ω—ã–π –º—è—á–∏–∫ –¥–æ –±–æ–ª–∏ 10 —Ä–∞–∑.</i>
–§–∏–∑–∏—á–µ—Å–∫–∏–π –≤—ã–±—Ä–æ—Å –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞ —á–µ—Ä–µ–∑ —Ä—É–∫–∏.""",
    
    """üí™ <b>–ü–æ–∑–∞ —Å–∏–ª—ã</b>
<i>–ù–æ–≥–∏ —à–∏—Ä–æ–∫–æ, —Ä—É–∫–∏ –≤ –±–æ–∫–∏, –≥—Ä—É–¥—å –≤–ø–µ—Ä—ë–¥ –Ω–∞ 2 –º–∏–Ω—É—Ç—ã.</i>
–ü–æ–≤—ã—à–∞–µ—Ç —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω, —Å–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª.""",
    
    """ü§î <b>–ú–µ—Ç–æ–¥ HALT</b>
<i>–°–ø—Ä–æ—Å–∏ —Å–µ–±—è: –≥–æ–ª–æ–¥–µ–Ω? –∑–ª–æ–π? –æ–¥–∏–Ω–æ–∫? —É—Å—Ç–∞–ª?</i>
–ò—Å–ø—Ä–∞–≤—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.""",
    
    """üåä <b>Urge Surfing</b>
<i>–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Ç—è–≥—É –∫–∞–∫ –≤–æ–ª–Ω—É. –ù–µ –±–æ—Ä–∏—Å—å ‚Äî –Ω–∞–±–ª—é–¥–∞–π.</i>
–¢—ã –Ω–µ –≤–æ–ª–Ω–∞, —Ç—ã —Å–µ—Ä—Ñ–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –µ—ë –ø—Ä–æ–µ–∑–∂–∞–µ—Ç.""",
    
    """üí¨ <b>–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç</b>
<i>–ù–∞–ø–∏—à–∏ –ª—é–±–æ–º—É: ¬´–¢—è–∂–∫–æ, –±—Ä–∞—Ç¬ª.</i>
–°—Ç—ã–¥–Ω–æ? –ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.""",
    
    """üßò <b>–ú–µ–¥–∏—Ç–∞—Ü–∏—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏</b>
<i>5 –º–∏–Ω—É—Ç –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –¥—ã—Ö–∞–Ω–∏–µ–º.</i>
–£—á–∏—Ç –æ—Ç–¥–µ–ª—è—Ç—å —Å–µ–±—è –æ—Ç –º—ã—Å–ª–µ–π –∏ –∂–µ–ª–∞–Ω–∏–π."""
]

# ==================== –°–¢–ê–î–ò–ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø ====================
RECOVERY_STAGES = [
    """üìÖ <b>–î–ù–ò 1-3: –û–°–¢–†–ê–Ø –§–ê–ó–ê</b>

<code>‚ö° –ü–∏–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤</code>

<i>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</i>
‚Ä¢ üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –ø–æ—Ç–ª–∏–≤–æ—Å—Ç—å
‚Ä¢ üò∞ –¢—Ä–µ–≤–æ–≥–∞ 8-10/10
‚Ä¢ üò† –†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ üõå –ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –∫–æ—à–º–∞—Ä—ã
‚Ä¢ üî• –°–∏–ª—å–Ω–∞—è —Ç—è–≥–∞ –∫–∞–∂–¥—ã–µ 1-2 —á–∞—Å–∞

<code>‚ö†Ô∏è –≠—Ç–æ —Å–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ –≤—Ä–µ–º—è. –î–µ—Ä–∂–∏—Å—å.</code>""",
    
    """üìÖ <b>–î–ù–ò 4-7: –ü–û–î–û–°–¢–†–ê–Ø –§–ê–ó–ê</b>

<code>‚ö° –°–∏–º–ø—Ç–æ–º—ã —Å–Ω–∏–∂–∞—é—Ç—Å—è –Ω–∞ 40%</code>

<i>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</i>
‚Ä¢ üìâ –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Å–∏–º–ø—Ç–æ–º—ã —Å–ª–∞–±–µ—é—Ç
‚Ä¢ ‚ö° –ü–æ—è–≤–ª—è—é—Ç—Å—è –æ–∫–Ω–∞ —è—Å–Ω–æ—Å—Ç–∏
‚Ä¢ üîã –≠–Ω–µ—Ä–≥–∏—è –≤—Å—ë –µ—â—ë –Ω–∏–∑–∫–∞—è
‚Ä¢ ‚è±Ô∏è –¢—è–≥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ä–µ–∂–µ
‚Ä¢ üé¢ –≠–º–æ—Ü–∏–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã

<code>üéØ –ú–æ–∑–≥ —É—á–∏—Ç—Å—è –∂–∏—Ç—å –ø–æ-–Ω–æ–≤–æ–º—É.</code>""",
    
    """üìÖ <b>–î–ù–ò 8-14: –ê–î–ê–ü–¢–ê–¶–ò–Ø</b>

<code>‚ö° –†–µ—Ü–µ–ø—Ç–æ—Ä—ã –æ–∂–∏–≤–∞—é—Ç</code>

<i>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</i>
‚Ä¢ üõå –°–æ–Ω –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è
‚Ä¢ üçé –ê–ø–ø–µ—Ç–∏—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ üìâ –¢—è–≥–∞ —Å–ª–∞–±–µ–µ—Ç
‚Ä¢ üòä –ü–æ—è–≤–ª—è–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–¥–æ—Å—Ç—å
‚Ä¢ üí° –ì–æ–ª–æ–≤–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Å–Ω–µ–µ

<code>üéØ –¢—ã —É–∂–µ —á—É–≤—Å—Ç–≤—É–µ—à—å —Ä–∞–∑–Ω–∏—Ü—É.</code>""",
    
    """üìÖ <b>–î–ù–ò 15-28: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï</b>

<code>‚ö° –ú–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∏—â–µ</code>

<i>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</i>
‚Ä¢ üîã –≠–Ω–µ—Ä–≥–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è
‚Ä¢ üòå –≠–º–æ—Ü–∏–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
‚Ä¢ üåà –†–∞–¥–æ—Å—Ç—å –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –≤–µ—â–µ–π
‚Ä¢ üß† –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ +25%
‚Ä¢ üìâ –¢—è–≥–∞ —Ä–µ–¥–∫–∞—è –∏ —Å–ª–∞–±–∞—è

<code>üéØ –¢—ã –¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫.</code>""",
    
    """üìÖ <b>–î–ù–ò 29-90: –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø</b>

<code>‚ö° –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π</code>

<i>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</i>
‚Ä¢ üî¨ CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
‚Ä¢ üß† –î–æ—Ñ–∞–º–∏–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
‚Ä¢ üïäÔ∏è –ñ–∏–∑–Ω—å –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚Ä¢ üìâ –¢—è–≥–∞ –ø–æ—á—Ç–∏ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
‚Ä¢ ü¶Ö –¢—ã —Å–≤–æ–±–æ–¥–µ–Ω

<code>üéØ –≠—Ç–æ —Ç–≤–æ—è –Ω–æ–≤–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.</code>"""
]

# ==================== –ö–û–ì–ù–ò–¢–ò–í–ù–´–ï –ò–°–ö–ê–ñ–ï–ù–ò–Ø ====================
COGNITIVE_DISTORTIONS = [
    """ü§Ø <b>¬´–Ø –í–°–Å –ò–°–ü–û–†–¢–ò–õ¬ª</b>

<code>–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏–∑–∞—Ü–∏—è</code>

<u>–§–∞–∫—Ç:</u> –û–¥–∏–Ω —Å—Ä—ã–≤ ‚â† –∫–æ–Ω–µ—Ü –ø—É—Ç–∏.
–ú–æ–∑–≥ —É—á–∏—Ç—Å—è –º–µ—Ç–æ–¥–æ–º –ø—Ä–æ–± –∏ –æ—à–∏–±–æ–∫. –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏.

üìä <i>–°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ —Ä–µ–º–∏—Å—Å–∏–∏ ‚Äî 3-5 —Ä–∞–∑.</i>

üí° <b>–¢—ã –Ω–µ –∏—Å–ø–æ—Ä—Ç–∏–ª. –¢—ã —É—á–∏—à—å—Å—è.</b>""",
    
    """ü§Ø <b>¬´–ù–ò–ß–ï–ì–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢¬ª</b>

<code>–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: —á—ë—Ä–Ω–æ-–±–µ–ª–æ–µ –º—ã—à–ª–µ–Ω–∏–µ</code>

<u>–§–∞–∫—Ç:</u> –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ.
–ù–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏. CB1-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è 4-6 –Ω–µ–¥–µ–ª—å.

üß† <i>–ú–æ–∑–≥ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –Ω–æ —Ç—ã –Ω–µ –≤–∏–¥–∏—à—å —ç—Ç–æ–≥–æ.</i>

üí° <b>–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚â† –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.</b>""",
    
    """ü§Ø <b>¬´–Ø –°–õ–ê–ë–´–ô¬ª</b>

<code>–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</code>

<u>–§–∞–∫—Ç:</u> –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äî –±–æ–ª–µ–∑–Ω—å, –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å.
–¢—ã –±–æ—Ä–µ—à—å—Å—è —Å –Ω–µ–π—Ä–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–º –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º. –≠—Ç–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã.

üìà <i>85% –ª—é–¥–µ–π —Å—Ä—ã–≤–∞—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π.</i>

üí° <b>–¢—ã –Ω–µ —Å–ª–∞–±—ã–π. –¢—ã –±–æ—Ä–µ—à—å—Å—è —Å —Ö–∏–º–∏–µ–π –º–æ–∑–≥–∞.</b>""",
    
    """ü§Ø <b>¬´–í–°–Å –ë–ï–°–°–ú–´–°–õ–ï–ù–ù–û¬ª</b>

<code>–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ</code>

<u>–§–∞–∫—Ç:</u> –°–º—ã—Å–ª –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 2-3 –Ω–µ–¥–µ–ª–∏.
–°–µ–π—á–∞—Å –º–æ–∑–≥ –≤ —Ä–µ–∂–∏–º–µ –≤—ã–∂–∏–≤–∞–Ω–∏—è. –î–æ—Ñ–∞–º–∏–Ω–∞ –º–∞–ª–æ ‚Äî –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä—ã–º.

üåßÔ∏è <i>–≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.</i>

üí° <b>–ß—É–≤—Å—Ç–≤–æ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî —Å–∏–º–ø—Ç–æ–º –ª–æ–º–∫–∏, –∞ –Ω–µ –ø—Ä–∞–≤–¥–∞ –æ –∂–∏–∑–Ω–∏.</b>""",
    
    """ü§Ø <b>¬´–£ –î–†–£–ì–ò–• –ü–û–õ–£–ß–ê–ï–¢–°–Ø¬ª</b>

<code>–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</code>

<u>–§–∞–∫—Ç:</u> –£ –≤—Å–µ—Ö —Å–≤–æ–∏ —Å—Ä–æ–∫–∏.
–¢—ã –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –Ω–µ 5 –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –Ω–µ–≥–æ. –ù–µ 6 –º–µ—Å—è—Ü–µ–≤ –ª–æ–º–∫–∏. –ù–µ —Å—Ä—ã–≤—ã.

üõ£Ô∏è <i>–ö–∞–∂–¥—ã–π –ø—É—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω.</i>

üí° <b>–°—Ä–∞–≤–Ω–∏–≤–∞–π —Å–µ–±—è —Ç–æ–ª—å–∫–æ —Å —Å–æ–±–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–º.</b>""",
    
    """ü§Ø <b>¬´–û–î–ò–ù –†–ê–ó –ù–ï –°–ß–ò–¢–ê–ï–¢–°–Ø¬ª</b>

<code>–û—à–∏–±–∫–∞ –º—ã—à–ª–µ–Ω–∏—è: –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è</code>

<u>–§–∞–∫—Ç:</u> –ö–∞–∂–¥—ã–π ¬´–æ–¥–∏–Ω —Ä–∞–∑¬ª —Å—á–∏—Ç–∞–µ—Ç—Å—è.
–ú–æ–∑–≥ –Ω–µ –¥–µ–ª–∏—Ç –Ω–∞ ¬´—Ä–∞–∑—ã¬ª. –î–æ—Ñ–∞–º–∏–Ω–æ–≤—ã–π –≤—Å–ø–ª–µ—Å–∫ = —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–≤—è–∑–∏.

‚Ü©Ô∏è <i>–û–¥–∏–Ω —Ä–∞–∑ = –æ—Ç–∫–∞—Ç –Ω–∞–∑–∞–¥ –Ω–∞ –Ω–µ–¥–µ–ª—é.</i>

üí° <b>–ï—Å–ª–∏ ¬´–Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è¬ª ‚Äî –∑–∞—á–µ–º —Ç–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è?</b>"""
]

# ==================== –¢–†–ò–ì–ì–ï–†–´ ====================
TRIGGERS_INFO = [
    """‚ö†Ô∏è <b>–ú–´–°–õ–¨ ¬´–•–û–ß–£¬ª</b>

<code>–ú—ã—Å–ª—å ‚â† –∫–æ–º–∞–Ω–¥–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—é</code>

<u>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</u>
‚Ä¢ üëÅÔ∏è –ù–∞–±–ª—é–¥–∞–π –∑–∞ –º—ã—Å–ª—å—é –∫–∞–∫ –∑–∞ –æ–±–ª–∞–∫–æ–º
‚Ä¢ ü§ê –ù–µ —Å–ø–æ—Ä—å —Å –Ω–µ–π, –Ω–µ —É–±–µ–∂–¥–∞–π —Å–µ–±—è
‚Ä¢ üí≠ –ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ—Ç—å: ¬´–û, —ç—Ç–æ —Å–Ω–æ–≤–∞ –º—ã—Å–ª—å¬ª
‚Ä¢ ‚è±Ô∏è –ß–µ—Ä–µ–∑ 3-7 –º–∏–Ω—É—Ç –æ–Ω–∞ –ø—Ä–æ–π–¥—ë—Ç —Å–∞–º–∞

üí° <b>–¢—ã –Ω–µ –æ–±—è–∑–∞–Ω —Å–ª—É—à–∞—Ç—å—Å—è –∫–∞–∂–¥–æ–π –º—ã—Å–ª–∏.</b>""",
    
    """‚ö†Ô∏è <b>–°–ò–õ–¨–ù–ê–Ø –≠–ú–û–¶–ò–Ø</b>

<code>–ó–ª–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, —Ç—Ä–µ–≤–æ–≥–∞ ‚Äî –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –∂–µ–ª–∞–Ω–∏–µ —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å</code>

<u>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</u>
‚Ä¢ üé≠ –ù–∞–∑–æ–≤–∏ —ç–º–æ—Ü–∏—é –≤—Å–ª—É—Ö: ¬´–≠—Ç–æ –∑–ª–æ—Å—Ç—å¬ª
‚Ä¢ üåä –≠–º–æ—Ü–∏–∏ –∫–∞–∫ –≤–æ–ª–Ω—ã ‚Äî –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –∏ —Å–ø–∞–¥–∞—é—Ç
‚Ä¢ üèÉ –ù–µ –Ω–∞–¥–æ —É–±–µ–≥–∞—Ç—å –æ—Ç —ç–º–æ—Ü–∏–∏ –≤ –≤–µ—â–µ—Å—Ç–≤–æ
‚Ä¢ üí™ –ü—Ä–æ–∂–∏—Ç—å —ç–º–æ—Ü–∏—é = —Å—Ç–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ

üí° <b>–≠—Ç–æ –ø—Ä–æ–π–¥—ë—Ç. –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç.</b>""",
    
    """‚ö†Ô∏è <b>–°–ö–£–ö–ê / –ë–ï–ó–î–ï–õ–¨–ï</b>

<code>–ú–æ–∑–≥ –ø—É—Ç–∞–µ—Ç —Å–∫—É–∫—É —Å –∂–µ–ª–∞–Ω–∏–µ–º —É–ø–æ—Ç—Ä–µ–±–∏—Ç—å</code>

<u>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</u>
‚Ä¢ üéØ –°–∫—É–∫–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç—è–≥–∞, —ç—Ç–æ —Å–∏–≥–Ω–∞–ª ¬´–∑–∞–π–º–∏—Å—å —á–µ–º-—Ç–æ¬ª
‚Ä¢ ‚è±Ô∏è 10 –º–∏–Ω—É—Ç –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ üö∂ –ü—Ä–æ–≥—É–ª–∫–∞, —É–±–æ—Ä–∫–∞, –∑–≤–æ–Ω–æ–∫ –¥—Ä—É–≥—É
‚Ä¢ üß† –ù–æ–≤—ã–π –¥–æ—Ñ–∞–º–∏–Ω –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞

üí° <b>–°–∫—É–∫–∞ –ª–µ—á–∏—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ–º, –∞ –Ω–µ –≤–µ—â–µ—Å—Ç–≤–æ–º.</b>""",
    
    """‚ö†Ô∏è <b>–°–¢–†–ï–°–° / –¢–†–ï–í–û–ì–ê</b>

<code>–¢—Ä–µ–≤–æ–≥–∞ –≥–æ–≤–æ—Ä–∏—Ç: ¬´–£–±–µ–≥–∏!¬ª –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞–µ—Ç: ¬´–ó–Ω–∞—é –∫–∞–∫¬ª</code>

<u>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</u>
‚Ä¢ ‚è±Ô∏è –¢—Ä–µ–≤–æ–≥–∞ –ø—Ä–æ–π–¥—ë—Ç —á–µ—Ä–µ–∑ 15-20 –º–∏–Ω—É—Ç
‚Ä¢ üå¨Ô∏è –î—ã—Ö–∞–Ω–∏–µ 4-7-8: –≤–¥–æ—Ö 4, –∑–∞–¥–µ—Ä–∂–∫–∞ 7, –≤—ã–¥–æ—Ö 8
‚Ä¢ üíß –•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞ –Ω–∞ –ª–∏—Ü–æ
‚Ä¢ üõ°Ô∏è –°–∫–∞–∂–∏ –≤—Å–ª—É—Ö: ¬´–Ø –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ–π—á–∞—Å¬ª

üí° <b>–¢—Ä–µ–≤–æ–≥–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è. –°—Ä—ã–≤ ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π.</b>""",
    
    """‚ö†Ô∏è <b>–ö–û–ú–ü–ê–ù–ò–Ø / –û–ö–†–£–ñ–ï–ù–ò–ï</b>

<code>–°–∞–º—ã–π —Å–∏–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä</code>

<u>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</u>
‚Ä¢ üö´ –ò–∑–±–µ–≥–∞–π –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π
‚Ä¢ üé≠ –ï—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏–∑–±–µ–∂–∞—Ç—å ‚Äî –∑–∞—Ä–∞–Ω–µ–µ —Ä–µ–ø–µ—Ç–∏—Ä—É–π –æ—Ç–∫–∞–∑
‚Ä¢ üó£Ô∏è ¬´–ó–∞–≤—è–∑–∞–ª¬ª, ¬´–ù–µ —Ö–æ—á—É¬ª, ¬´–ú–Ω–µ –Ω–µ–ª—å–∑—è¬ª
‚Ä¢ üö∂ –í—ã—Ö–æ–¥–∏ –∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏

üí° <b>–¢–≤–æ—è —Ç—Ä–µ–∑–≤–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —á—É–∂–æ–≥–æ –º–Ω–µ–Ω–∏—è.</b>""",
    
    """‚ö†Ô∏è <b>–£–°–¢–ê–õ–û–°–¢–¨ / –ù–ï–î–û–°–´–ü</b>

<code>–°–∏–ª–∞ –≤–æ–ª–∏ –∏—Å—Ç–æ—â–∞–µ—Ç—Å—è –∫ –≤–µ—á–µ—Ä—É</code>

<u>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</u>
‚Ä¢ üõå –°–ø–∏ 7-8 —á–∞—Å–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
‚Ä¢ üçé –ï—à—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ, –Ω–µ –¥–æ–ø—É—Å–∫–∞–π –≥–æ–ª–æ–¥–∞
‚Ä¢ üßò 15 –º–∏–Ω—É—Ç –æ—Ç–¥—ã—Ö–∞ –≤ —Ç–∏—à–∏–Ω–µ
‚Ä¢ üìµ –í—ã–∫–ª—é—á–∏ –≥–∞–¥–∂–µ—Ç—ã –∑–∞ —á–∞—Å –¥–æ —Å–Ω–∞

üí° <b>–£—Å—Ç–∞–≤—à–∏–π –º–æ–∑–≥ –∏—â–µ—Ç –ª—ë–≥–∫–∏–π –¥–æ—Ñ–∞–º–∏–Ω.</b>"""
]

# ==================== –ù–ê–£–ß–ù–´–ï –§–ê–ö–¢–´ ====================
SCIENCE_FACTS = [
    """üî¨ <b>CB1-–†–ï–¶–ï–ü–¢–û–†–´</b>

<code>–ö–∞–Ω–Ω–∞–±–∏–Ω–æ–∏–¥–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤ –º–æ–∑–≥–µ</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ üìà –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è: +28% –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
‚Ä¢ üìà –î–≤–µ –Ω–µ–¥–µ–ª–∏: +50%
‚Ä¢ üìà 4 –Ω–µ–¥–µ–ª–∏: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚Ä¢ ‚úÖ 6 –Ω–µ–¥–µ–ª—å: 100% –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

üí° <b>–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ ‚Äî —Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.</b>""",
    
    """üî¨ <b>–î–û–§–ê–ú–ò–ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê</b>

<code>–¢–ì–ö –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω –≤ 2-3 —Ä–∞–∑–∞</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ üìâ –ù–µ–¥–µ–ª—è: –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤—Å—ë –µ—â—ë –Ω–∏–∑–∫–æ–µ
‚Ä¢ üìà –î–≤–µ –Ω–µ–¥–µ–ª–∏: –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
‚Ä¢ üìà –ú–µ—Å—è—Ü: –¥–æ—Ñ–∞–º–∏–Ω –ø–æ—á—Ç–∏ –≤ –Ω–æ—Ä–º–µ
‚Ä¢ ‚úÖ 2-4 –º–µ—Å—è—Ü–∞: –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

üí° <b>–ú–æ–∑–≥ —É—á–∏—Ç—Å—è —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è —Å–∞–º.</b>""",
    
    """üî¨ <b>–°–û–ù –ò –ú–ï–õ–ê–¢–û–ù–ò–ù</b>

<code>–¢–ì–ö –Ω–∞—Ä—É—à–∞–µ—Ç REM-—Ñ–∞–∑—É —Å–Ω–∞</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ üò¥ –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è: –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞, –∫–æ—à–º–∞—Ä—ã
‚Ä¢ üõå 10-14 –¥–Ω–µ–π: —Å–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–ª—É–±–∂–µ
‚Ä¢ üí§ 21 –¥–µ–Ω—å: REM-—Ñ–∞–∑–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
‚Ä¢ ‚úÖ –ú–µ—Å—è—Ü: —Å–æ–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π

üí° <b>–ì–ª—É–±–æ–∫–∏–π —Å–æ–Ω = –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∑–≥–∞.</b>""",
    
    """üî¨ <b>–ü–ê–ú–Ø–¢–¨ –ò –ì–ò–ü–ü–û–ö–ê–ú–ü</b>

<code>–¢–ì–ö –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç –≥–∏–ø–ø–æ–∫–∞–º–ø ‚Äî —Ü–µ–Ω—Ç—Ä –ø–∞–º—è—Ç–∏</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ üß† –î–≤–µ –Ω–µ–¥–µ–ª–∏: –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å —É–ª—É—á—à–∞–µ—Ç—Å—è
‚Ä¢ üß† –ú–µ—Å—è—Ü: –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ +25%
‚Ä¢ üß† –¢—Ä–∏ –º–µ—Å—è—Ü–∞: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚Ä¢ ‚úÖ 6-12 –º–µ—Å—è—Ü–µ–≤: –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤—ã–π

üí° <b>–¢—ã —Å—Ç–∞–Ω–µ—à—å —É–º–Ω–µ–µ. –ë—É–∫–≤–∞–ª—å–Ω–æ.</b>""",
    
    """üî¨ <b>–°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–†–´–í–û–í</b>

<code>–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –ø–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º</code>

<u>–§–∞–∫—Ç—ã:</u>
‚Ä¢ üìä 85% —Å—Ä—ã–≤–∞—é—Ç—Å—è –≤ –ø–µ—Ä–≤—ã–µ 30 –¥–Ω–µ–π
‚Ä¢ üìä 60% ‚Äî –≤ –ø–µ—Ä–≤—É—é –Ω–µ–¥–µ–ª—é
‚Ä¢ üìä –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫: 3-5 —Ä–∞–∑
‚Ä¢ üìä –ü–æ—Å–ª–µ 90 –¥–Ω–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å—Ä—ã–≤–∞ –ø–∞–¥–∞–µ—Ç –¥–æ 15%

üí° <b>–ï—Å–ª–∏ —Å–æ—Ä–≤–∞–ª—Å—è ‚Äî —Ç—ã –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è.</b>""",
    
    """üî¨ <b>–ü–†–ï–§–†–û–ù–¢–ê–õ–¨–ù–ê–Ø –ö–û–†–ê</b>

<code>–¶–µ–Ω—Ç—Ä –≤–æ–ª–∏ –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π</code>

<u>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</u>
‚Ä¢ üòë –ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è: –Ω–æ–ª—å –º–æ—Ç–∏–≤–∞—Ü–∏–∏
‚Ä¢ ‚ö° –î–≤–µ –Ω–µ–¥–µ–ª–∏: –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤—Å–ø–ª–µ—Å–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ üí™ –ú–µ—Å—è—Ü: –≤–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
‚Ä¢ ‚úÖ –¢—Ä–∏ –º–µ—Å—è—Ü–∞: —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è

üí° <b>–ê–ø–∞—Ç–∏—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è. –≠—Ç–æ –Ω–µ —Ç—ã ‚Äî —ç—Ç–æ —Ö–∏–º–∏—è.</b>""",
    
    """üî¨ <b>BDNF (Brain-Derived Neurotrophic Factor)</b>

<code>–ë–µ–ª–æ–∫ —Ä–æ—Å—Ç–∞ –º–æ–∑–≥–∞</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ üìâ –ü–µ—Ä–≤—ã–µ –¥–Ω–∏: BDNF –Ω–∞ –º–∏–Ω–∏–º—É–º–µ
‚Ä¢ üìà 1-2 –Ω–µ–¥–µ–ª–∏: –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Ç–∏
‚Ä¢ üìà –ú–µ—Å—è—Ü: —É—Ä–æ–≤–µ–Ω—å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è
‚Ä¢ ‚úÖ 3 –º–µ—Å—è—Ü–∞: –º–æ–∑–≥ —Å—Ç—Ä–æ–∏—Ç –Ω–æ–≤—ã–µ —Å–≤—è–∑–∏

üí° <b>–≠—Ç–æ—Ç –±–µ–ª–æ–∫ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —É–º–Ω–µ–µ –∏ —É—Å—Ç–æ–π—á–∏–≤–µ–µ.</b>""",
    
    """üî¨ <b>–°–ï–†–î–ï–ß–ù–û-–°–û–°–£–î–ò–°–¢–ê–Ø –°–ò–°–¢–ï–ú–ê</b>

<code>–¢–ì–ö —É—Å–∫–æ—Ä—è–µ—Ç –ø—É–ª—å—Å –Ω–∞ 20-50%</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ ‚ù§Ô∏è –ü–µ—Ä–≤—ã–µ 72 —á–∞—Å–∞: –ø—É–ª—å—Å –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è
‚Ä¢ ‚ù§Ô∏è –ù–µ–¥–µ–ª—è: –¥–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
‚Ä¢ ‚ù§Ô∏è –ú–µ—Å—è—Ü: —Å–µ—Ä–¥–µ—á–Ω—ã–π —Ä–∏—Ç–º –∑–¥–æ—Ä–æ–≤—ã–π
‚Ä¢ ‚úÖ 3 –º–µ—Å—è—Ü–∞: —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

üí° <b>–¢–≤–æ—ë —Å–µ—Ä–¥—Ü–µ —Å–∫–∞–∂–µ—Ç —Å–ø–∞—Å–∏–±–æ.</b>""",
    
    """üî¨ <b>–ú–û–¢–ò–í–ê–¶–ò–Ø –ò –ê–ù–ì–ï–î–û–ù–ò–Ø</b>

<code>–ù–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ</code>

<u>–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</u>
‚Ä¢ üå´Ô∏è –î–Ω–∏ 1-7: –≤—Å—ë –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä—ã–º
‚Ä¢ üå§Ô∏è –ù–µ–¥–µ–ª—è 2: –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–æ–º–µ–Ω—Ç—ã —Ä–∞–¥–æ—Å—Ç–∏
‚Ä¢ üåà –ú–µ—Å—è—Ü: –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
‚Ä¢ ‚úÖ 2-3 –º–µ—Å—è—Ü–∞: –∂–∏–∑–Ω—å —Å–Ω–æ–≤–∞ —è—Ä–∫–∞—è

üí° <b>–≠—Ç–æ –Ω–µ –¥–µ–ø—Ä–µ—Å—Å–∏—è. –≠—Ç–æ –º–æ–∑–≥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è.</b>""",
    
    """üî¨ <b>–ù–ï–ô–†–û–ü–õ–ê–°–¢–ò–ß–ù–û–°–¢–¨</b>

<code>–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ –º–µ–Ω—è—Ç—å—Å—è</code>

<u>–§–∞–∫—Ç—ã:</u>
‚Ä¢ üß† –í –ª—é–±–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ –º–æ–∑–≥ –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
‚Ä¢ üîó –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø—É—Ç–∏
‚Ä¢ üï∞Ô∏è –ú–æ–∑–≥ –ø–æ–º–Ω–∏—Ç —Å—Ç–∞—Ä—ã–µ —Å–≤—è–∑–∏ 6-12 –º–µ—Å—è—Ü–µ–≤
‚Ä¢ üìÖ –ù–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∑–∞ 21-90 –¥–Ω–µ–π

üí° <b>–¢–≤–æ–π –º–æ–∑–≥ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —Ç—ã –¥—É–º–∞–µ—à—å.</b>""",
    
    """üî¨ <b>–ì–û–†–ú–û–ù–ê–õ–¨–ù–´–ô –ë–ê–õ–ê–ù–°</b>

<code>–ö–∞–Ω–Ω–∞–±–∏—Å –Ω–∞—Ä—É—à–∞–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É –≥–æ—Ä–º–æ–Ω–æ–≤</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ ü¶∏‚Äç‚ôÇÔ∏è –¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω: 2-4 –Ω–µ–¥–µ–ª–∏ –¥–æ –Ω–æ—Ä–º—ã
‚Ä¢ üò´ –ö–æ—Ä—Ç–∏–∑–æ–ª (—Å—Ç—Ä–µ—Å—Å): 3-6 –Ω–µ–¥–µ–ª—å
‚Ä¢ üåô –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω (—Å–æ–Ω): 2-3 –Ω–µ–¥–µ–ª–∏
‚Ä¢ üòä –°–µ—Ä–æ—Ç–æ–Ω–∏–Ω (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ): 4-8 –Ω–µ–¥–µ–ª—å

üí° <b>–ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é.</b>""",
    
    """üî¨ <b>–ò–ú–ú–£–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê</b>

<code>–í–ª–∏—è–Ω–∏–µ –¢–ì–ö –Ω–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç</code>

<u>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</u>
‚Ä¢ üõ°Ô∏è 2-4 –Ω–µ–¥–µ–ª–∏: —É–ª—É—á—à–∞–µ—Ç—Å—è —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–µ–º–æ—Å—Ç—å
‚Ä¢ üõ°Ô∏è 1-2 –º–µ—Å—è—Ü–∞: –º–µ–Ω—å—à–µ –ø—Ä–æ—Å—Ç—É–¥ –∏ –∏–Ω—Ñ–µ–∫—Ü–∏–π
‚Ä¢ üõ°Ô∏è 3 –º–µ—Å—è—Ü–∞: –∏–º–º—É–Ω–∏—Ç–µ—Ç —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è
‚Ä¢ ‚úÖ 6 –º–µ—Å—è—Ü–µ–≤: –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

üí° <b>–¢–≤–æ—ë —Ç–µ–ª–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–∏–ª—å–Ω–µ–µ –±–µ–∑ –≤–µ—â–µ—Å—Ç–≤–∞.</b>"""
]

# ==================== –ö–õ–ê–í–ò–ê–¢–£–†–´ ====================
def get_main_keyboard() -> ReplyKeyboardMarkup:
    """–û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞"""
    return ReplyKeyboardMarkup(
        [
            ["‚úä –î–µ—Ä–∂—É—Å—å", "üòî –¢—è–∂–µ–ª–æ"],
            ["üëã –¢—ã —Ç—É—Ç?", "üìä –î–Ω–∏"],
            ["‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ", "‚è∏ –ü–æ–º–æ–ª—á–∏"]
        ],
        resize_keyboard=True,
        input_field_placeholder="–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ..."
    )

def get_start_keyboard() -> ReplyKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞"""
    return ReplyKeyboardMarkup(
        [["‚ñ∂ –ù–∞—á–∞—Ç—å"]],
        resize_keyboard=True
    )

def get_heavy_keyboard() -> ReplyKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤"""
    return ReplyKeyboardMarkup(
        [
            ["üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è", "üß† –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"],
            ["üíî –°—Ä—ã–≤", "‚Ü© –ù–∞–∑–∞–¥"]
        ],
        resize_keyboard=True
    )

def get_info_keyboard() -> ReplyKeyboardMarkup:
    """–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    return ReplyKeyboardMarkup(
        [
            ["üìÖ –°—Ç–∞–¥–∏–∏", "‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã"],
            ["ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è", "üî¨ –§–∞–∫—Ç—ã"],
            ["‚Ü© –ù–∞–∑–∞–¥"]
        ],
        resize_keyboard=True
    )

# ==================== –°–ò–°–¢–ï–ú–ê –•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• ====================
class DataManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
    
    def __init__(self):
        self._cache: Optional[Dict] = None
        self._lock = asyncio.Lock()
    
    def load_data(self) -> Dict:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞"""
        if self._cache is not None:
            return self._cache
        
        with FileLock(LOCK_FILE):
            if not os.path.exists(DATA_FILE):
                self._cache = {}
                return self._cache
            
            try:
                with open(DATA_FILE, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    self._cache = data
                    return data
            except (json.JSONDecodeError, IOError) as e:
                logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
                self._cache = {}
                return {}
    
    async def save_data(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª"""
        if self._cache is None:
            return
        
        async with self._lock:
            with FileLock(LOCK_FILE):
                try:
                    with open(DATA_FILE, "w", encoding="utf-8") as f:
                        json.dump(self._cache, f, ensure_ascii=False, indent=2)
                except IOError as e:
                    logger.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    def get_user(self, user_id: int) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        data = self.load_data()
        uid = str(user_id)
        
        if uid not in data:
            data[uid] = self._get_default_user_data()
            asyncio.create_task(self.save_data())
        
        return data[uid]
    
    async def save_user(self, user_id: int, updates: Dict[str, Any] = None):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        data = self.load_data()
        uid = str(user_id)
        
        if updates:
            if uid not in data:
                data[uid] = self._get_default_user_data()
            data[uid].update(updates)
        
        await self.save_data()
    
    def get_active_users(self) -> list:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"""
        data = self.load_data()
        return [int(uid) for uid, user in data.items() if user.get("active", False)]
    
    @staticmethod
    def _get_default_user_data() -> Dict[str, Any]:
        """–®–∞–±–ª–æ–Ω –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        return {
            "start_date": None,
            "active": False,
            "best_streak": 0,
            "hold_count_today": 0,
            "last_hold_date": None,
            "last_hold_time": None,
            "last_stage_index": 0,
            "used_tips": [],
            "used_triggers": [],
            "used_distortions": [],
            "used_facts": []
        }

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
data_manager = DataManager()

# ==================== –£–¢–ò–õ–ò–¢–´ ====================
def get_current_time() -> datetime:
    """–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–π —Ç–∞–π–º–∑–æ–Ω–µ"""
    return datetime.now(MOSCOW_TZ)

def get_current_date() -> date:
    """–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞"""
    return get_current_time().date()

def get_days_since_start(user_id: int) -> int:
    """–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Å –Ω–∞—á–∞–ª–∞"""
    user = data_manager.get_user(user_id)
    if not user["start_date"]:
        return 0
    
    try:
        start = date.fromisoformat(user["start_date"])
        current = get_current_date()
        days = (current - start).days
        return max(days, 0)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –¥–Ω–µ–π –¥–ª—è {user_id}: {e}")
        return 0

def format_days(days: int) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω–µ–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–∫–ª–æ–Ω–µ–Ω–∏–µ–º"""
    if 11 <= days % 100 <= 19:
        return f"{days} –¥–Ω–µ–π"
    if days % 10 == 1:
        return f"{days} –¥–µ–Ω—å"
    if days % 10 in [2, 3, 4]:
        return f"{days} –¥–Ω—è"
    return f"{days} –¥–Ω–µ–π"

def get_next_item(user_id: int, items_list: list, used_key: str) -> str:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–µ–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞"""
    user = data_manager.get_user(user_id)
    used = user.get(used_key, [])
    
    if len(used) >= len(items_list):
        used = []
    
    available = [i for i in range(len(items_list)) if i not in used]
    if not available:
        available = list(range(len(items_list)))
        used = []
    
    choice = random.choice(available)
    used.append(choice)
    
    asyncio.create_task(data_manager.save_user(user_id, {used_key: used}))
    
    return items_list[choice]

# ==================== –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –î–ê–ù–ù–´–ú–ò ====================
async def reset_streak(user_id: int) -> int:
    """–°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞"""
    current = get_days_since_start(user_id)
    user = data_manager.get_user(user_id)
    
    if current > user.get("best_streak", 0):
        await data_manager.save_user(user_id, {"best_streak": current})
    
    await data_manager.save_user(user_id, {
        "start_date": get_current_date().isoformat(),
        "last_stage_index": 0,
        "hold_count_today": 0,
        "last_hold_date": None,
        "last_hold_time": None,
        "used_tips": [],
        "used_triggers": [],
        "used_distortions": [],
        "used_facts": []
    })
    
    return current

# ==================== –°–ò–°–¢–ï–ú–ê –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–Ø –ó–ê–î–ê–ß ====================
def remove_user_jobs(chat_id: int, job_queue) -> int:
    """–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    removed = 0
    for name in [f"morning_{chat_id}", f"evening_{chat_id}", f"night_{chat_id}"]:
        jobs = job_queue.get_jobs_by_name(name)
        for job in jobs:
            job.schedule_removal()
            removed += 1
    return removed

def schedule_jobs(chat_id: int, job_queue):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    existing_jobs = []
    for name in [f"morning_{chat_id}", f"evening_{chat_id}", f"night_{chat_id}"]:
        if job_queue.get_jobs_by_name(name):
            existing_jobs.extend(job_queue.get_jobs_by_name(name))
    
    if existing_jobs:
        remove_user_jobs(chat_id, job_queue)
    
    job_queue.run_daily(
        send_morning,
        time(9, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"morning_{chat_id}"
    )
    job_queue.run_daily(
        send_evening,
        time(18, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"evening_{chat_id}"
    )
    job_queue.run_daily(
        send_night,
        time(23, 0, tzinfo=MOSCOW_TZ),
        data={'chat_id': chat_id},
        name=f"night_{chat_id}"
    )

# ==================== –ï–ñ–ï–î–ù–ï–í–ù–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
async def send_morning(context: ContextTypes.DEFAULT_TYPE):
    """–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    chat_id = context.job.data['chat_id']
    user = data_manager.get_user(chat_id)
    
    if not user.get("active"):
        return
    
    days = get_days_since_start(chat_id)
    msg = random.choice(MORNING_MESSAGES)
    
    if days in MILESTONES:
        msg += f"\n\n{MILESTONES[days]}"
    
    await context.bot.send_message(
        chat_id, 
        msg,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

async def send_evening(context: ContextTypes.DEFAULT_TYPE):
    """–í–µ—á–µ—Ä–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    chat_id = context.job.data['chat_id']
    user = data_manager.get_user(chat_id)
    
    if not user.get("active"):
        return
    
    await context.bot.send_message(
        chat_id,
        random.choice(EVENING_MESSAGES),
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

async def send_night(context: ContextTypes.DEFAULT_TYPE):
    """–ù–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    chat_id = context.job.data['chat_id']
    user = data_manager.get_user(chat_id)
    
    if not user.get("active"):
        return
    
    await context.bot.send_message(
        chat_id,
        random.choice(NIGHT_MESSAGES),
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

# ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î ====================
async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    chat_id = update.effective_chat.id
    user = data_manager.get_user(chat_id)
    
    was_active = user.get("active", False)
    
    await data_manager.save_user(chat_id, {
        "active": True,
        "start_date": get_current_date().isoformat(),
        "last_stage_index": 0,
        "used_tips": [],
        "used_triggers": [],
        "used_distortions": [],
        "used_facts": [],
        "hold_count_today": 0,
        "last_hold_date": None,
        "last_hold_time": None
    })
    
    if not was_active:
        schedule_jobs(chat_id, context.application.job_queue)
        logger.info(f"–°–æ–∑–¥–∞–Ω—ã –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {chat_id}")
    
    days = get_days_since_start(chat_id)
    
    if days == 0:
        msg = """üëã <b>–ü—Ä–∏–≤–µ—Ç, –±—Ä–∞—Ç!</b>

–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å —Ç—Ä–∏ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å: <i>—Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å—Ç–æ–∏—Ç.</i>

<b>–ö–æ–≥–¥–∞ —Ç—è–∂–µ–ª–æ ‚Äî –∂–º–∏ ¬´‚úä –î–µ—Ä–∂—É—Å—å¬ª.</b>
–í—Å–µ –ø–æ–ª—É—á–∞—Ç –ø—É—à. –¢–∞–∫ —Ç—ã –ø–æ–∫–∞–∂–µ—à—å, —á—Ç–æ –µ—â—ë –∑–¥–µ—Å—å.
–ú–æ–∂–Ω–æ –∂–∞—Ç—å –¥–æ 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º —Ç—è–∂–µ–ª–æ.

<i>–î–µ—Ä–∂–∏—Å—å, —è —Ä—è–¥–æ–º.</i> üí™"""
    else:
        msg = f"""üëã <b>–ü—Ä–∏–≤–µ—Ç.</b> –¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è {format_days(days)}. –Ø —Ä—è–¥–æ–º.

–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å —Ç—Ä–∏ —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–Ω–∏—Ç—å: <i>—Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å—Ç–æ–∏—Ç.</i>

<b>–ö–æ–≥–¥–∞ —Ç—è–∂–µ–ª–æ ‚Äî –∂–º–∏ ¬´‚úä –î–µ—Ä–∂—É—Å—å¬ª.</b>
–í—Å–µ –ø–æ–ª—É—á–∞—Ç –ø—É—à. –¢–∞–∫ —Ç—ã –ø–æ–∫–∞–∂–µ—à—å, —á—Ç–æ –µ—â—ë –∑–¥–µ—Å—å.
–ú–æ–∂–Ω–æ –∂–∞—Ç—å –¥–æ 5 —Ä–∞–∑ –≤ –¥–µ–Ω—å, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º —Ç—è–∂–µ–ª–æ.

<i>–î–µ—Ä–∂–∏—Å—å, —è —Ä—è–¥–æ–º.</i> üí™"""
    
    await update.message.reply_text(
        msg,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

async def stop_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    chat_id = update.effective_chat.id
    
    await data_manager.save_user(chat_id, {"active": False})
    removed = remove_user_jobs(chat_id, context.application.job_queue)
    logger.info(f"–£–¥–∞–ª–µ–Ω–æ {removed} –∑–∞–¥–∞—á –¥–ª—è {chat_id}")
    
    await update.message.reply_text(
        "üîï <b>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.</b>\n–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ ‚Äî –∂–º–∏ ‚ñ∂ –ù–∞—á–∞—Ç—å",
        parse_mode=ParseMode.HTML,
        reply_markup=get_start_keyboard()
    )

async def handle_hold(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ '–î–µ—Ä–∂—É—Å—å'"""
    chat_id = update.effective_chat.id
    user = data_manager.get_user(chat_id)
    
    if not user.get("active"):
        await update.message.reply_text(
            "‚è∏Ô∏è <b>–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ ‚ñ∂ –ù–∞—á–∞—Ç—å</b>",
            parse_mode=ParseMode.HTML,
            reply_markup=get_start_keyboard()
        )
        return
    
    current_time = get_current_time()
    today_str = current_time.date().isoformat()
    
    if user.get("last_hold_date") != today_str:
        await data_manager.save_user(chat_id, {
            "hold_count_today": 0,
            "last_hold_date": today_str
        })
    
    if user.get("last_hold_time"):
        try:
            last_time_str = user["last_hold_time"]
            
            try:
                if 'T' in last_time_str:
                    last_time = datetime.fromisoformat(last_time_str)
                else:
                    last_time = datetime.strptime(last_time_str, "%Y-%m-%d %H:%M:%S").replace(tzinfo=MOSCOW_TZ)
            except ValueError:
                last_time = current_time - timedelta(minutes=31)
            
            if last_time.tzinfo is None:
                last_time = last_time.replace(tzinfo=MOSCOW_TZ)
            
            diff = (current_time - last_time).total_seconds()
            if diff < 1800:
                mins = int((1800 - diff) / 60) + 1
                await update.message.reply_text(
                    f"‚è≥ <b>–ü–æ–¥–æ–∂–¥–∏ –µ—â—ë {mins} {'–º–∏–Ω—É—Ç—É' if mins == 1 else '–º–∏–Ω—É—Ç'}.</b>",
                    parse_mode=ParseMode.HTML,
                    reply_markup=get_main_keyboard()
                )
                return
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–∞—É—Ç–∞: {e}")
    
    if user.get("hold_count_today", 0) >= 5:
        await update.message.reply_text(
            "‚ö†Ô∏è <b>–°–µ–≥–æ–¥–Ω—è —É–∂–µ 5 —Ä–∞–∑.</b>\n–ó–∞–≤—Ç—Ä–∞ —Å–Ω–æ–≤–∞ —Å–º–æ–∂–µ—à—å.",
            parse_mode=ParseMode.HTML,
            reply_markup=get_main_keyboard()
        )
        return
    
    await data_manager.save_user(chat_id, {
        "last_hold_time": current_time.isoformat(),
        "last_hold_date": today_str,
        "hold_count_today": user.get("hold_count_today", 0) + 1
    })
    
    await update.message.reply_text(
        random.choice(HOLD_RESPONSES),
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )
    
    active_users = data_manager.get_active_users()
    for uid in active_users:
        if uid != chat_id:
            try:
                await context.bot.send_message(uid, "‚úä")
                await asyncio.sleep(0.05)
            except Exception as e:
                error_str = str(e).lower()
                if "blocked" in error_str or "chat not found" in error_str or "forbidden" in error_str:
                    await data_manager.save_user(uid, {"active": False})
                    remove_user_jobs(uid, context.application.job_queue)
                    logger.info(f"–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω {uid}: –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞")

async def handle_heavy(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ '–¢—è–∂–µ–ª–æ'"""
    await update.message.reply_text(
        "ü§î <b>–ß—Ç–æ –Ω—É–∂–Ω–æ?</b>",
        parse_mode=ParseMode.HTML,
        reply_markup=get_heavy_keyboard()
    )

async def handle_exercise(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π"""
    user_id = update.effective_chat.id
    tip = get_next_item(user_id, HELP_TECHNIQUES, "used_tips")
    
    await update.message.reply_text(
        tip,
        parse_mode=ParseMode.HTML,
        reply_markup=get_heavy_keyboard()
    )

async def handle_info_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ú–µ–Ω—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    await update.message.reply_text(
        "üìö <b>–í—ã–±–µ—Ä–∏ —Ä–∞–∑–¥–µ–ª:</b>",
        parse_mode=ParseMode.HTML,
        reply_markup=get_info_keyboard()
    )

async def handle_stages(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–°—Ç–∞–¥–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"""
    chat_id = update.effective_chat.id
    user = data_manager.get_user(chat_id)
    last_index = user.get("last_stage_index", 0)
    
    stage_text = RECOVERY_STAGES[last_index]
    next_index = (last_index + 1) % len(RECOVERY_STAGES)
    
    if next_index == 0:
        stage_text += "\n\n‚ú® <b>–≠—Ç–æ –±—ã–ª–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–¥–∏—è. –ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞.</b>"
    else:
        stage_num = next_index + 1
        stage_text += f"\n\nüìå <b>–°—Ç–∞–¥–∏—è {stage_num}/{len(RECOVERY_STAGES)}. –ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π.</b>"
    
    await data_manager.save_user(chat_id, {"last_stage_index": next_index})
    
    await update.message.reply_text(
        stage_text,
        parse_mode=ParseMode.HTML,
        reply_markup=get_info_keyboard()
    )

async def handle_triggers(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤"""
    trigger = get_next_item(
        update.effective_chat.id, 
        TRIGGERS_INFO, 
        "used_triggers"
    )
    
    await update.message.reply_text(
        trigger,
        parse_mode=ParseMode.HTML,
        reply_markup=get_info_keyboard()
    )

async def handle_distortions(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è"""
    distortion = get_next_item(
        update.effective_chat.id,
        COGNITIVE_DISTORTIONS,
        "used_distortions"
    )
    
    await update.message.reply_text(
        distortion,
        parse_mode=ParseMode.HTML,
        reply_markup=get_info_keyboard()
    )

async def handle_facts(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ù–∞—É—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã"""
    fact = get_next_item(
        update.effective_chat.id,
        SCIENCE_FACTS,
        "used_facts"
    )
    
    await update.message.reply_text(
        fact,
        parse_mode=ParseMode.HTML,
        reply_markup=get_info_keyboard()
    )

async def handle_breakdown(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä—ã–≤–∞"""
    chat_id = update.effective_chat.id
    days_lost = await reset_streak(chat_id)
    
    msg = f"""üíî <b>–°—á—ë—Ç—á–∏–∫ —Å–±—Ä–æ—à–µ–Ω.</b> –¢—ã –ø—Ä–æ–¥–µ—Ä–∂–∞–ª—Å—è {format_days(days_lost)}.

<i>–≠—Ç–æ –Ω–µ –ø—Ä–æ–≤–∞–ª. –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏.</i>

üí™ <b>–ö–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞ ‚Äî –∂–º–∏ ‚ñ∂ –ù–∞—á–∞—Ç—å</b>"""
    
    await update.message.reply_text(
        msg,
        parse_mode=ParseMode.HTML,
        reply_markup=get_start_keyboard()
    )

async def handle_days(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π"""
    chat_id = update.effective_chat.id
    user = data_manager.get_user(chat_id)
    days = get_days_since_start(chat_id)
    best = user.get("best_streak", 0)
    
    if days == 0:
        msg = "üéØ <b>–¢—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å.</b> –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π."
    else:
        msg = f"üìÖ <b>–¢—ã –¥–µ—Ä–∂–∏—à—å—Å—è {format_days(days)}.</b>"
        if best > days:
            msg += f"\n\nü•á <b>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</b> {format_days(best)}"
        elif best > 0 and best == days:
            msg += f"\n\nüéñÔ∏è <b>–≠—Ç–æ —Ç–≤–æ–π –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</b>"
    
    await update.message.reply_text(
        msg,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )
    
    if days in MILESTONES:
        await update.message.reply_text(
            MILESTONES[days],
            parse_mode=ParseMode.HTML,
            reply_markup=get_main_keyboard()
        )

async def handle_are_you_here(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –±–æ—Ç–∞"""
    await asyncio.sleep(random.randint(2, 6))
    await update.message.reply_text(
        random.choice(TU_TUT_FIRST),
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )
    await asyncio.sleep(random.randint(2, 5))
    await update.message.reply_text(
        random.choice(TU_TUT_SECOND),
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

async def handle_thank_you(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å"""
    msg = """‚ù§Ô∏è <b>–°–ø–∞—Å–∏–±–æ —Ç–µ–±–µ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.</b>

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:
üè¶ <b>–°–±–µ—Ä:</b> 2202 2084 3481 5313

<i>–õ—é–±–∞—è —Å—É–º–º–∞ –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –±–æ—Ç–∞ –¥–∞–ª—å—à–µ.</i>

üí™ <b>–ì–ª–∞–≤–Ω–æ–µ ‚Äî –¥–µ—Ä–∂–∏—Å—å.</b>"""
    
    await update.message.reply_text(
        msg,
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

async def handle_back(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥"""
    await update.message.reply_text(
        "üëå <b>–û–∫–µ–π</b>",
        parse_mode=ParseMode.HTML,
        reply_markup=get_main_keyboard()
    )

async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞"""
    text = update.message.text
    
    if text == "‚ñ∂ –ù–∞—á–∞—Ç—å":
        await start_command(update, context)
    else:
        await update.message.reply_text(
            "ü§ñ <b>–ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</b>",
            parse_mode=ParseMode.HTML,
            reply_markup=get_main_keyboard()
        )

async def restore_jobs(application):
    """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ"""
    active_users = data_manager.get_active_users()
    logger.info(f"–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è {len(active_users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    
    existing_jobs = list(application.job_queue.jobs())
    
    for user_id in active_users:
        user_has_jobs = False
        for job in existing_jobs:
            if (hasattr(job, 'name') and str(user_id) in job.name) or \
               (job.data and job.data.get('chat_id') == user_id):
                user_has_jobs = True
                break
        
        if not user_has_jobs:
            schedule_jobs(user_id, application.job_queue)
            logger.info(f"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")

# ==================== –ó–ê–ü–£–°–ö –ë–û–¢–ê ====================
def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    application = Application.builder().token(TOKEN).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥
    application.add_handler(CommandHandler("start", start_command))
    application.add_handler(CommandHandler("stop", stop_command))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫
    application.add_handler(MessageHandler(filters.Regex("^‚úä –î–µ—Ä–∂—É—Å—å$"), handle_hold))
    application.add_handler(MessageHandler(filters.Regex("^üìä –î–Ω–∏$"), handle_days))
    application.add_handler(MessageHandler(filters.Regex("^üòî –¢—è–∂–µ–ª–æ$"), handle_heavy))
    application.add_handler(MessageHandler(filters.Regex("^üëã –¢—ã —Ç—É—Ç\?$"), handle_are_you_here))
    application.add_handler(MessageHandler(filters.Regex("^‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ$"), handle_thank_you))
    application.add_handler(MessageHandler(filters.Regex("^‚è∏ –ü–æ–º–æ–ª—á–∏$"), stop_command))
    
    application.add_handler(MessageHandler(filters.Regex("^üí™ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è$"), handle_exercise))
    application.add_handler(MessageHandler(filters.Regex("^üß† –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è$"), handle_info_menu))
    application.add_handler(MessageHandler(filters.Regex("^üíî –°—Ä—ã–≤$"), handle_breakdown))
    
    application.add_handler(MessageHandler(filters.Regex("^üìÖ –°—Ç–∞–¥–∏–∏$"), handle_stages))
    application.add_handler(MessageHandler(filters.Regex("^‚ö†Ô∏è –¢—Ä–∏–≥–≥–µ—Ä—ã$"), handle_triggers))
    application.add_handler(MessageHandler(filters.Regex("^ü§Ø –ò—Å–∫–∞–∂–µ–Ω–∏—è$"), handle_distortions))
    application.add_handler(MessageHandler(filters.Regex("^üî¨ –§–∞–∫—Ç—ã$"), handle_facts))
    
    application.add_handler(MessageHandler(filters.Regex("^‚Ü© –ù–∞–∑–∞–¥$"), handle_back))
    application.add_handler(MessageHandler(filters.Regex("^‚ñ∂ –ù–∞—á–∞—Ç—å$"), handle_text))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ª—é–±–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))
    
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    application.post_init = restore_jobs
    
    logger.info("üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    
    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    application.run_polling(
        allowed_updates=Update.ALL_TYPES,
        drop_pending_updates=True
    )

if __name__ == "__main__":
    main()
